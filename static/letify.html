<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>letify</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* ‚îÄ‚îÄ RESET ‚îÄ‚îÄ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
:root{
  --bg:#FAF7F2;--bg2:#fff;--bg3:rgba(0,0,0,.05);
  --text:#1C1608;--hint:#A89F90;--brd:rgba(0,0,0,.06);
  --sun:#FF6B35;--sun2:#FFAB40;--water:#4EAEE5;--cal:#F4814A;
  --sleep:#8B7FD4;--green:#52C177;--red:#F45C5C;
  --r:16px;--r-lg:20px;
  --st:0px;
  --sb:0px;
  --sh:0 2px 12px rgba(0,0,0,.07);
  --page-bot:calc(80px + var(--sb) + 20px);
  --page-top:calc(var(--st) + 18px);
}
html,body{height:100%;overflow:hidden;font-family:'Nunito',system-ui,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;overscroll-behavior:none;user-select:none}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
#root{position:fixed;inset:0}
#pages{position:absolute;inset:0}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{
  position:absolute;inset:0;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  touch-action:pan-y;
  scrollbar-width:none;
  padding-top:var(--page-top);
  padding-bottom:var(--page-bot);
  opacity:0;pointer-events:none;
  transform:translateY(14px);
  transition:opacity .24s cubic-bezier(.4,0,.2,1),transform .28s cubic-bezier(.4,0,.2,1);
  contain:layout style;
}
.page::-webkit-scrollbar{display:none}
.page.active{opacity:1;pointer-events:all;transform:none}

/* ‚îÄ‚îÄ SCREEN LAYER (full-screen input screens) ‚îÄ‚îÄ */
#slayer{position:fixed;inset:0;z-index:70;pointer-events:none}
.scr{
  position:absolute;inset:0;background:var(--bg);
  pointer-events:none;
  transform:translateY(100%);
  transition:transform .3s cubic-bezier(.4,0,.2,1);
  contain:layout style;
  display:flex;flex-direction:column;
  height:100%;
  overflow:hidden;
}
.scr.open{transform:none;pointer-events:all}
/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —ç–∫—Ä–∞–Ω–∞ */
.scr-hdr{
  flex-shrink:0;
  background:var(--bg);
  padding:calc(var(--st)+16px) 20px 14px;
  border-bottom:1px solid var(--brd);
}
.scr-title{font-size:22px;font-weight:900;letter-spacing:-.02em}
.scr-subtitle{font-size:13px;font-weight:600;color:var(--hint);margin-top:3px}
/* –°–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º–æ–µ —Ç–µ–ª–æ ‚Äî –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–∂–¥—É —Ö–µ–¥–µ—Ä–æ–º –∏ —Ñ—É—Ç–µ—Ä–æ–º */
.scr-body{
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
  padding:20px 16px 8px;
}
.scr-body::-webkit-scrollbar{display:none}
/* –ö–Ω–æ–ø–∫–∞ –ü–†–ò–ë–ò–¢–ê –ö –ù–ò–ó–£ –≠–ö–†–ê–ù–ê */
.scr-foot{
  flex-shrink:0;
  padding:12px 16px calc(var(--sb)+16px);
  background:var(--bg);
  border-top:1px solid var(--brd);
}
.scr-btn-wrap{display:none}

/* ‚îÄ‚îÄ ISLAND NAV ‚îÄ‚îÄ */
#nav{
  position:fixed;
  bottom:12px;
  left:0;right:0;
  margin:0 auto;
  width:fit-content;
  z-index:9999;
  display:flex;align-items:center;gap:4px;
  padding:6px;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(30px) saturate(2);
  -webkit-backdrop-filter:blur(30px) saturate(2);
  border:1px solid rgba(255,255,255,.9);
  border-radius:26px;
  box-shadow:0 8px 30px rgba(0,0,0,.13),0 2px 6px rgba(0,0,0,.06);
  transition:bottom .3s,opacity .3s;
  transform:none !important;
}
.tg-dark #nav{background:rgba(28,22,14,.92);border-color:rgba(255,255,255,.08)}
#nav.gone{bottom:calc(-100px - var(--sb));opacity:0;pointer-events:none}
.nt{
  width:52px;height:52px;border-radius:18px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;
  cursor:pointer;color:var(--hint);
  transition:color .18s,background .18s,transform .16s cubic-bezier(.34,1.56,.64,1);
  -webkit-tap-highlight-color:transparent;
}
.nt.on{color:var(--sun);background:rgba(255,107,53,.11)}
.nt:active{transform:scale(.8)!important}
.nt svg{width:22px;height:22px;flex-shrink:0}
.nt-dot{width:4px;height:4px;border-radius:50%;background:var(--sun);opacity:0;transition:opacity .18s;margin-top:-1px}
.nt.on .nt-dot{opacity:1}

/* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
.t1{font-size:25px;font-weight:900;line-height:1.1;letter-spacing:-.02em}
.t2{font-size:18px;font-weight:900;letter-spacing:-.015em}
.t3{font-size:14px;font-weight:800}
.t5{font-size:12px;font-weight:600;color:var(--hint)}
.tnum-sm{font-size:24px;font-weight:900;letter-spacing:-.02em}
.grad{background:linear-gradient(105deg,var(--sun),var(--sun2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--bg2);border-radius:var(--r-lg);padding:16px;box-shadow:var(--sh);position:relative;overflow:hidden}
.pad{padding:0 16px}
.gap{margin-top:10px}
.sec{font-size:11px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--hint);padding:16px 20px 8px}

/* ‚îÄ‚îÄ LIST TILE ‚îÄ‚îÄ */
.lt{
  display:flex;align-items:center;gap:12px;
  padding:11px 0;border-bottom:1px solid var(--brd);
  cursor:pointer;transition:opacity .12s;-webkit-tap-highlight-color:transparent;
}
.lt:last-child{border-bottom:none;padding-bottom:0}
.lt:first-child{padding-top:0}
.lt:active{opacity:.55}
.lt-ic{
  width:32px;height:32px;border-radius:10px;background:var(--bg3);
  display:flex;align-items:center;justify-content:center;color:var(--hint);flex-shrink:0;
}
.lt-lbl{flex:1;font-size:14px;font-weight:700}
.lt-val{font-size:12px;color:var(--hint);font-weight:600;flex-shrink:0}
.lt-chev{color:var(--hint);opacity:.45;flex-shrink:0}

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.pb{height:6px;background:rgba(0,0,0,.06);border-radius:99px;overflow:hidden;margin-top:10px}
.pbf{height:100%;border-radius:99px;transition:width 1.1s cubic-bezier(.34,1.1,.64,1)}
.pb-sun{background:linear-gradient(90deg,var(--sun),var(--sun2))}
.pb-water{background:var(--water)}
.pb-sleep{background:var(--sleep)}

/* ‚îÄ‚îÄ ARC ‚îÄ‚îÄ */
.aw{position:relative;display:inline-flex;align-items:center;justify-content:center}
.ai{position:absolute;text-align:center;pointer-events:none}

/* ‚îÄ‚îÄ STAT BOX ‚îÄ‚îÄ */
.sb-row{display:flex;gap:8px}
.sbox{flex:1;background:var(--bg2);border-radius:var(--r);padding:13px;box-shadow:var(--sh);text-align:center}
.sv{font-size:19px;font-weight:900;margin-bottom:2px}
.sl{font-size:10px;font-weight:700;color:var(--hint);text-transform:uppercase;letter-spacing:.06em}

/* ‚îÄ‚îÄ BANNER ‚îÄ‚îÄ */
.banner{background:linear-gradient(130deg,#FF6B35,#FFAB40);border-radius:var(--r-lg);padding:16px;color:#fff;position:relative;overflow:hidden}
.banner::after{content:'';position:absolute;right:-10px;top:-10px;width:90px;height:90px;border-radius:50%;background:rgba(255,255,255,.1);pointer-events:none}

/* ‚îÄ‚îÄ ACT CARD (plan) ‚îÄ‚îÄ */
.ac{background:var(--bg2);border-radius:var(--r);padding:12px 14px;display:flex;align-items:flex-start;gap:10px;box-shadow:var(--sh);margin-bottom:8px;transition:opacity .18s}
.ac.done{opacity:.42}
.ac-ico{width:42px;height:42px;border-radius:13px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.ac-body{flex:1;min-width:0}
.ac-name{font-size:14px;font-weight:800;margin-bottom:2px}
.ac-name.done-text{text-decoration:line-through;opacity:.6}
.ac-sub{font-size:11px;color:var(--hint);font-weight:600}
.pill{display:inline-flex;align-items:center;padding:3px 9px;border-radius:99px;font-size:10px;font-weight:800;white-space:nowrap;margin-top:5px}
.p-ok{background:rgba(82,193,119,.13);color:var(--green)}
.p-late{background:rgba(244,92,92,.1);color:var(--red)}
.p-soon{background:rgba(255,107,53,.1);color:var(--sun)}
.p-now{background:rgba(78,174,229,.12);color:var(--water)}
.p-later{background:rgba(0,0,0,.05);color:var(--hint)}
.ac-bar{margin-top:7px;height:4px;background:rgba(0,0,0,.06);border-radius:99px;overflow:hidden}
.ac-barf{height:100%;border-radius:99px;transition:width .4s ease}

/* ‚îÄ‚îÄ SLEEP DOTS ‚îÄ‚îÄ */
.sq{display:flex;gap:3px}
.sqd{width:15px;height:4px;border-radius:99px;background:rgba(0,0,0,.07);transition:background .3s}
.sqd.on{background:var(--sleep)}

/* ‚îÄ‚îÄ HISTORY ROW ‚îÄ‚îÄ */
.hr{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--brd);gap:10px}
.hr:last-child{border-bottom:none;padding-bottom:0}
.hr:first-child{padding-top:0}
.hr-d{font-size:11px;color:var(--hint);font-weight:700;min-width:46px}
.hr-v{font-size:15px;font-weight:900;flex:1}
.hr-diff{font-size:11px;font-weight:800}
.d-neg{color:var(--green)}.d-pos{color:var(--red)}

/* ‚îÄ‚îÄ MEAL ROW ‚îÄ‚îÄ */
.mr{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--brd)}
.mr:last-child{border-bottom:none;padding-bottom:0}
.mr:first-child{padding-top:0}
.mr-ico{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.mr-name{font-size:13px;font-weight:800}
.mr-kcal{font-size:13px;font-weight:900;flex-shrink:0}

/* ‚îÄ‚îÄ PROD ROW ‚îÄ‚îÄ */
.pr{display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--brd)}
.pr:last-child{border-bottom:none;padding-bottom:0}
.pr:first-child{padding-top:0}
.pr-name{font-size:13px;font-weight:800}
.pr-meta{font-size:10px;color:var(--hint);font-weight:600}
.pr-kcal{font-size:15px;font-weight:900;color:var(--cal)}

/* ‚îÄ‚îÄ BTNS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;border:none;cursor:pointer;font-family:inherit;font-weight:800;transition:transform .14s cubic-bezier(.34,1.56,.64,1),opacity .14s}
.btn:active{transform:scale(.87);opacity:.8}
.btn-p{background:linear-gradient(135deg,var(--sun),var(--sun2));color:#fff;padding:16px 24px;font-size:15px;font-weight:900;border-radius:18px;box-shadow:0 6px 24px rgba(255,107,53,.32),0 2px 8px rgba(255,107,53,.18);width:100%;letter-spacing:.01em}
.btn-g{background:var(--bg3);color:var(--text);padding:11px 16px;font-size:13px;border-radius:11px}
.btn-water{background:rgba(78,174,229,.11);color:var(--water);padding:13px 8px;font-size:13px;border-radius:11px;flex:1}

/* ‚îÄ‚îÄ TOGGLE ‚îÄ‚îÄ */
.tog{width:48px;height:26px;border-radius:99px;position:relative;cursor:pointer;flex-shrink:0;transition:background .22s}
.tog::after{content:'';position:absolute;width:20px;height:20px;border-radius:50%;background:#fff;top:3px;transition:left .24s cubic-bezier(.34,1.5,.64,1);box-shadow:0 1px 5px rgba(0,0,0,.16)}
.tog.on{background:var(--sun)}.tog.off{background:rgba(0,0,0,.16)}
.tog.on::after{left:25px}.tog.off::after{left:3px}

/* ‚îÄ‚îÄ TRACK TABS ‚îÄ‚îÄ */
.ttabs{display:flex;gap:3px;background:rgba(0,0,0,.05);border-radius:12px;padding:3px}
.ttab{flex:1;padding:8px 4px;font-size:12px;font-weight:800;border:none;border-radius:9px;cursor:pointer;font-family:inherit;background:transparent;color:var(--hint);transition:background .16s,color .16s,box-shadow .16s}
.ttab.on{background:var(--bg2);color:var(--text);box-shadow:0 1px 5px rgba(0,0,0,.08)}

/* ‚îÄ‚îÄ AVATAR ‚îÄ‚îÄ */
.pav{width:68px;height:68px;border-radius:20px;background:linear-gradient(135deg,var(--sun),var(--sun2));display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;color:#fff;box-shadow:0 6px 22px rgba(255,107,53,.28);flex-shrink:0}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast{
  position:fixed;bottom:calc(90px + var(--sb) + 14px);left:50%;
  transform:translateX(-50%) translateY(10px);
  background:rgba(28,22,14,.86);color:#fff;
  padding:9px 18px;border-radius:99px;font-size:13px;font-weight:800;
  white-space:nowrap;z-index:200;opacity:0;pointer-events:none;
  backdrop-filter:blur(12px);
  transition:opacity .2s,transform .2s cubic-bezier(.34,1.2,.64,1);
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* ‚îÄ‚îÄ WHEEL PICKER ‚îÄ‚îÄ */
.wp{position:relative;overflow:hidden;border-radius:14px;background:var(--bg3);cursor:grab;touch-action:none}
.wp:active{cursor:grabbing}
.wp-track{position:absolute;top:0;left:0;right:0;will-change:transform}
.wp-item{height:44px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:var(--hint);pointer-events:none;user-select:none}
.wp-item.sel{color:var(--text);font-size:24px}
.wp-sel{position:absolute;top:50%;left:6px;right:6px;height:44px;transform:translateY(-50%);background:rgba(255,107,53,.09);border-radius:9px;border:1.5px solid rgba(255,107,53,.18);pointer-events:none}
.wp-ft{position:absolute;left:0;right:0;height:88px;pointer-events:none;z-index:2}
.wp-ft-t{top:0;background:linear-gradient(to bottom,var(--bg2) 0%,transparent 100%)}
.wp-ft-b{bottom:0;background:linear-gradient(to top,var(--bg2) 0%,transparent 100%)}
.wp-row{display:flex;justify-content:center;gap:8px;padding:0 4px 8px;align-items:flex-start}
.wp-col{display:flex;flex-direction:column;align-items:stretch;gap:4px;flex:1;min-width:0}
.wp-lbl{font-size:10px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--hint);text-align:center}
.wp-sep{font-size:22px;font-weight:900;color:var(--hint);line-height:44px;align-self:center;padding-top:20px;flex:none}

/* ‚îÄ‚îÄ FORM FIELDS (screens) ‚îÄ‚îÄ */
.f-row{display:flex;align-items:center;justify-content:space-between;padding:0 0 14px}
.f-lbl{font-size:14px;font-weight:700}
.f-inp{border:none;outline:none;background:var(--bg3);border-radius:10px;padding:10px 13px;font-family:inherit;font-size:15px;font-weight:800;color:var(--text);text-align:right;width:130px;-webkit-appearance:none}
.f-inp-wide{width:100%;text-align:left;margin-top:8px;display:block}
.seg{display:flex;gap:3px;background:rgba(0,0,0,.05);border-radius:10px;padding:3px;margin-top:8px}
.seg-btn{flex:1;padding:8px 6px;font-size:13px;font-weight:800;border:none;border-radius:7px;cursor:pointer;font-family:inherit;background:transparent;color:var(--hint);transition:background .14s,color .14s;line-height:1.4;white-space:nowrap}
.seg-btn.on{background:var(--bg2);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,.09)}
/* –≠–º–æ–¥–∑–∏-–≤–µ—Ä—Å–∏—è —Å–µ–≥–º–µ–Ω—Ç–∞ */
#seg-sleepq .seg-btn{font-size:20px;padding:6px 4px}

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty{text-align:center;padding:44px 24px}
.empty svg{opacity:.25;margin-bottom:12px}
.empty-t{font-size:15px;font-weight:800;margin-bottom:5px}
.empty-s{font-size:12px;color:var(--hint);font-weight:600}

/* ‚îÄ‚îÄ DARK ‚îÄ‚îÄ */
.tg-dark .wp-ft-t{background:linear-gradient(to bottom,var(--bg2) 0%,transparent 100%)}
.tg-dark .wp-ft-b{background:linear-gradient(to top,var(--bg2) 0%,transparent 100%)}
.tg-dark .wp-ft-t,.tg-dark .wp-ft-b{opacity:1}

/* Dark: –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
.tg-dark{
  --bg3:rgba(255,255,255,.07);
  --brd:rgba(255,255,255,.09);
  --sh:0 2px 14px rgba(0,0,0,.45);
}
/* Dark: –∫–∞—Ä—Ç–æ—á–∫–∏ */
.tg-dark .card{
  background:rgba(255,255,255,.06) !important;
  border:1px solid rgba(255,255,255,.08);
  box-shadow:none;
}
.tg-dark .sbox{
  background:rgba(255,255,255,.06) !important;
  border:1px solid rgba(255,255,255,.08);
}
/* Dark: —Å–ø–∏—Å–æ–∫ */
.tg-dark .lt{border-bottom-color:rgba(255,255,255,.07)}
.tg-dark .lt-ic{background:rgba(255,255,255,.07)}
/* Dark: —Å–µ–≥–º–µ–Ω—Ç-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */
.tg-dark .seg{background:rgba(255,255,255,.08)}
.tg-dark .seg-btn{color:rgba(255,255,255,.45);font-size:13px}
.tg-dark .seg-btn.on{background:rgba(255,255,255,.16);color:#fff;box-shadow:0 1px 5px rgba(0,0,0,.5)}
/* Dark: track tabs */
.tg-dark .ttabs{background:rgba(255,255,255,.07)}
.tg-dark .ttab.on{background:rgba(255,255,255,.14);color:#fff}
.tg-dark .ttab{color:rgba(255,255,255,.4)}
/* Dark: input –ø–æ–ª—è */
.tg-dark .f-inp{background:rgba(255,255,255,.09);color:#fff;border:1px solid rgba(255,255,255,.1)}
/* Dark: toggle ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π! */
.tg-dark .tog.on{background:var(--sun) !important}
.tg-dark .tog.off{background:rgba(255,255,255,.22) !important}
.tg-dark .tog::after{background:#fff !important}
/* Dark: progress bar track */
.tg-dark .pb{background:rgba(255,255,255,.09)}
/* Dark: water btn */
.tg-dark .btn-water{background:rgba(78,174,229,.18);color:#7ecef5}
.tg-dark .btn-g{background:rgba(255,255,255,.09);color:#fff}
/* Dark: section header */
.tg-dark .sec{color:rgba(255,255,255,.35)}
/* Dark: hint text */
.tg-dark .t5{color:rgba(255,255,255,.4)}
/* Dark: picker highlight */
.tg-dark .wp{background:rgba(255,255,255,.07)}
.tg-dark .wp-item{color:rgba(255,255,255,.3)}
.tg-dark .wp-item.sel{color:#fff}
.tg-dark .wp-sel{background:rgba(255,107,53,.15);border-color:rgba(255,107,53,.3)}
/* Dark: scr body bg */
.tg-dark .scr{background:var(--bg)}
.tg-dark .scr-hdr{background:var(--bg);border-bottom-color:rgba(255,255,255,.08)}
.tg-dark .scr-foot{background:var(--bg);border-top-color:rgba(255,255,255,.08)}
/* Dark: banner –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ä–∞–Ω–∂–µ–≤—ã–º */
/* Dark: nav */
.tg-dark #nav{background:rgba(20,16,10,.94);border-color:rgba(255,255,255,.1)}
/* Dark: history rows */
.tg-dark .hr{border-bottom-color:rgba(255,255,255,.07)}
.tg-dark .mr{border-bottom-color:rgba(255,255,255,.07)}
.tg-dark .pr{border-bottom-color:rgba(255,255,255,.07)}
/* Dark: sleep dots */
.tg-dark .sqd{background:rgba(255,255,255,.15)}
/* Dark: avatar */
.tg-dark .scr-hdr{background:var(--bg);border-bottom-color:rgba(255,255,255,.08)}
/* Dark: activity card */
.tg-dark .ac{background:rgba(255,255,255,.06) !important;border:1px solid rgba(255,255,255,.07)}
/* Dark: –ø—É—Å—Ç–æ–π —ç–∫—Ä–∞–Ω */
.tg-dark .empty svg{opacity:.15}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes fu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.page.active .reveal{animation:fu .28s cubic-bezier(.4,0,.2,1) both}
@keyframes stepIn{from{opacity:0;transform:translateX(28px)}to{opacity:1;transform:none}}
@keyframes stepOut{from{opacity:1;transform:none}to{opacity:0;transform:translateX(-28px)}}

/* ‚îÄ‚îÄ MULTI-STEP ACTIVITY ‚îÄ‚îÄ */
.act-step{display:none}
.act-step.active{display:block;animation:stepIn .28s cubic-bezier(.4,0,.2,1) both}
.step-ind{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 0 20px}
.step-pip{width:8px;height:8px;border-radius:50%;background:var(--bg3);transition:all .3s}
.step-pip.on{width:22px;border-radius:4px;background:var(--sun)}
.step-pip.done{background:var(--green)}
.act-q{font-size:22px;font-weight:900;line-height:1.2;margin-bottom:4px;letter-spacing:-.02em}
.act-hint{font-size:13px;color:var(--hint);font-weight:600;margin-bottom:18px}
/* Type grid */
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:4px}
.type-card{
  padding:14px 12px;border-radius:14px;border:2px solid transparent;
  background:var(--bg3);cursor:pointer;text-align:center;
  transition:all .16s cubic-bezier(.34,1.3,.64,1);
}
.type-card:active{transform:scale(.93)}
.type-card.on{background:rgba(255,107,53,.08);border-color:var(--sun)}
.type-card-ico{font-size:28px;margin-bottom:4px;line-height:1}
.type-card-lbl{font-size:13px;font-weight:800;color:var(--text)}
.tg-dark .type-card{background:rgba(255,255,255,.07)}
.tg-dark .type-card.on{background:rgba(255,107,53,.15)}
</style>
</head>
<body>
<div id="root">
<div id="pages">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="p-home">
<div class="reveal">

<div class="pad" style="display:flex;align-items:flex-start;justify-content:space-between">
  <div>
    <div class="t1">–ü—Ä–∏–≤–µ—Ç, <span class="grad" id="h-name">‚Ä¶</span></div>
    <div class="t5" style="margin-top:3px" id="h-date">–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è‚Ä¶</div>
  </div>
  <div style="text-align:right;padding-top:3px">
    <div class="t5">–¥–æ –ª–µ—Ç–∞</div>
    <div style="font-size:22px;font-weight:900;color:var(--sun);line-height:1.1" id="h-days">‚Äî</div>
    <div class="t5" id="h-dunit">–¥–Ω–µ–π</div>
  </div>
</div>

<div class="pad gap">
  <div class="banner">
    <div style="font-size:13px;font-weight:800;opacity:.88;margin-bottom:2px">–ø—É—Ç—å –∫ –ª–µ—Ç—É</div>
    <div style="font-size:28px;font-weight:900;line-height:1.1"><span id="h-ddays">‚Äî</span> –¥–Ω–µ–π</div>
    <div style="font-size:11px;opacity:.72;font-weight:600;margin-top:3px">—Ç—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</div>
  </div>
</div>

<div class="pad gap">
<div class="card" style="padding:16px 6px 12px">
  <div style="display:flex;justify-content:space-around;align-items:center">
    <!-- water -->
    <div style="text-align:center;cursor:pointer" onclick="navTo('track')">
      <div class="aw">
        <svg width="72" height="72" viewBox="0 0 72 72">
          <circle cx="36" cy="36" r="28" fill="none" stroke="rgba(78,174,229,.15)" stroke-width="5.5"/>
          <circle cx="36" cy="36" r="28" fill="none" stroke="var(--water)" stroke-width="5.5"
            stroke-linecap="round" stroke-dasharray="175.9" id="arc-w" stroke-dashoffset="175.9"
            transform="rotate(-90 36 36)" style="transition:stroke-dashoffset 1s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="ai"><div style="font-size:14px;font-weight:900;color:var(--water)" id="arc-wpct">0%</div></div>
      </div>
      <div style="font-size:11px;font-weight:900;margin-top:4px" id="arc-wml">0</div>
      <div class="t5" style="font-size:10px">–º–ª</div>
    </div>
    <!-- cal -->
    <div style="text-align:center;cursor:pointer" onclick="navTo('track')">
      <div class="aw">
        <svg width="86" height="86" viewBox="0 0 86 86">
          <circle cx="43" cy="43" r="35" fill="none" stroke="rgba(244,129,74,.15)" stroke-width="6.5"/>
          <circle cx="43" cy="43" r="35" fill="none" stroke="var(--cal)" stroke-width="6.5"
            stroke-linecap="round" stroke-dasharray="219.9" id="arc-c" stroke-dashoffset="219.9"
            transform="rotate(-90 43 43)" style="transition:stroke-dashoffset 1s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="ai"><div style="font-size:16px;font-weight:900;color:var(--cal)" id="arc-cpct">0%</div></div>
      </div>
      <div style="font-size:13px;font-weight:900;margin-top:4px" id="arc-cval">0</div>
      <div class="t5" style="font-size:10px">–∫–∫–∞–ª</div>
    </div>
    <!-- sleep -->
    <div style="text-align:center;cursor:pointer" onclick="navTo('sleep')">
      <div class="aw">
        <svg width="72" height="72" viewBox="0 0 72 72">
          <circle cx="36" cy="36" r="28" fill="none" stroke="rgba(139,127,212,.15)" stroke-width="5.5"/>
          <circle cx="36" cy="36" r="28" fill="none" stroke="var(--sleep)" stroke-width="5.5"
            stroke-linecap="round" stroke-dasharray="175.9" id="arc-s" stroke-dashoffset="175.9"
            transform="rotate(-90 36 36)" style="transition:stroke-dashoffset 1s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="ai"><div style="font-size:14px;font-weight:900;color:var(--sleep)" id="arc-sh">‚Äî</div></div>
      </div>
      <div class="sq" id="arc-sq" style="justify-content:center;margin-top:4px"></div>
      <div class="t5" style="font-size:10px;margin-top:2px">—á–∞—Å–æ–≤</div>
    </div>
  </div>
</div>
</div>

<div class="pad gap">
<div class="card" style="cursor:pointer" onclick="navTo('progress')">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <div class="t5" style="margin-bottom:3px">–í–µ—Å</div>
      <div style="display:flex;align-items:baseline;gap:5px">
        <span class="tnum-sm" id="h-wcur">‚Äî</span>
        <span class="t5">‚Üí <b style="color:var(--text)" id="h-wgoal">‚Äî</b> –∫–≥</span>
      </div>
    </div>
    <div style="text-align:right">
      <div style="font-size:24px;font-weight:900;color:var(--sun)" id="h-wpct">‚Äî</div>
      <div class="t5">–∫ —Ü–µ–ª–∏</div>
    </div>
  </div>
  <div class="pb gap"><div class="pbf pb-sun" id="h-wbar" style="width:0%"></div></div>
</div>
</div>

<div id="h-plan-sec" style="display:none">
  <div class="sec">–°–µ–≥–æ–¥–Ω—è</div>
  <div class="pad" id="h-plan-list"></div>
</div>

<div class="pad" id="h-streak-w" style="margin-top:10px;display:none">
  <div style="background:linear-gradient(90deg,rgba(255,107,53,.08),rgba(255,171,64,.06));border-radius:var(--r);padding:12px 14px;display:flex;align-items:center;gap:10px">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="var(--sun)"><path d="M12 2c0 5.5-5 7-5 11a5 5 0 0 0 10 0c0-4-5-5.5-5-11z"/></svg>
    <div>
      <div style="font-size:13px;font-weight:900" id="h-sval">7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
      <div class="t5">—Å–µ—Ä–∏—è –≤–æ–¥—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è</div>
    </div>
  </div>
</div>
<div style="height:8px"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TRACK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-track">
<div style="position:sticky;top:0;background:var(--bg);z-index:10;padding:calc(var(--st)+14px) 16px 10px">
  <div class="ttabs">
    <button class="ttab on" id="tt-water" onclick="setTTab('water')">–í–æ–¥–∞</button>
    <button class="ttab" id="tt-cal" onclick="setTTab('cal')">–ö–∞–ª–æ—Ä–∏–∏</button>
    <button class="ttab" id="tt-prod" onclick="setTTab('prod')">–ö–ë–ñ–£</button>
  </div>
</div>

<div id="tt-water-body">
<div class="pad reveal">
<div class="card" style="margin-top:6px;text-align:center;padding:22px 16px;background:linear-gradient(160deg,rgba(78,174,229,.07),rgba(78,174,229,.02))">
  <div class="t5">–≤—ã–ø–∏—Ç–æ —Å–µ–≥–æ–¥–Ω—è</div>
  <div style="font-size:54px;font-weight:900;color:var(--water);line-height:1.1;margin:5px 0" id="w-total">0</div>
  <div class="t5">–∏–∑ <span id="w-goal">2000</span> –º–ª</div>
  <div class="pb" style="margin-top:12px;height:7px"><div class="pbf pb-water" id="w-bar" style="width:0%"></div></div>
  <div id="w-streak" style="margin-top:9px"></div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:9px">
  <button class="btn btn-water" onclick="addW(150)">+150 –º–ª</button>
  <button class="btn btn-water" onclick="addW(200)">+200 –º–ª</button>
  <button class="btn btn-water" onclick="addW(250)">+250 –º–ª</button>
  <button class="btn btn-water" onclick="addW(500)">+500 –º–ª</button>
</div>
<button class="btn btn-g" style="margin-top:7px;width:100%;padding:12px" onclick="undoW()">–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ</button>
<div style="margin-top:12px">
  <div class="t5" style="margin-bottom:6px;font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.08em">–ò—Å—Ç–æ—Ä–∏—è —Å–µ–≥–æ–¥–Ω—è</div>
  <div class="card" id="w-entries" style="padding:10px 12px"></div>
</div>
</div>
</div>

<div id="tt-cal-body" style="display:none">
<div class="pad reveal">
<div class="card" style="margin-top:6px;text-align:center;padding:20px 16px">
  <div class="t5">–∫–∞–ª–æ—Ä–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
  <div style="font-size:50px;font-weight:900;color:var(--cal);line-height:1.1;margin:5px 0" id="c-total">0</div>
  <div class="t5">–∏–∑ <span id="c-goal">2000</span> –∫–∫–∞–ª</div>
  <div class="pb" style="margin-top:12px;height:7px"><div class="pbf pb-sun" id="c-bar" style="width:0%"></div></div>
</div>
<div class="card gap" style="padding:12px 14px"><div id="c-meals"></div></div>
<button class="btn btn-p gap" onclick="openScr('scr-cal')">–î–æ–±–∞–≤–∏—Ç—å –µ–¥—É</button>
</div>
</div>

<div id="tt-prod-body" style="display:none">
<div class="pad reveal">
<div class="card" style="margin-top:6px;padding:10px 12px"><div id="prod-list"></div></div>
<button class="btn btn-p gap" onclick="openScr('scr-cal')">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</button>
</div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLAN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-plan">
<div class="reveal">
<div class="pad">
  <div class="t2" style="margin-bottom:1px">–ü–ª–∞–Ω</div>
  <div class="t5" id="pl-date">—Å–µ–≥–æ–¥–Ω—è</div>
</div>
<div class="pad gap">
<div class="card">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <div style="font-size:34px;font-weight:900;line-height:1" id="pl-cnt">0/0</div>
      <div class="t5" style="margin-top:2px">–∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
    </div>
    <svg width="52" height="52" viewBox="0 0 52 52">
      <circle cx="26" cy="26" r="20" fill="none" stroke="rgba(0,0,0,.06)" stroke-width="4.5"/>
      <circle cx="26" cy="26" r="20" fill="none" stroke="var(--sun)" stroke-width="4.5"
        stroke-linecap="round" stroke-dasharray="125.7"
        id="pl-ring" stroke-dashoffset="125.7"
        transform="rotate(-90 26 26)"
        style="transition:stroke-dashoffset .7s cubic-bezier(.34,1.1,.64,1)"/>
    </svg>
  </div>
</div>
</div>

<div id="pl-empty" class="empty" style="display:none">
  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="3"/><path d="M8 2v4M16 2v4M3 10h18M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01"/></svg>
  <div class="empty-t">–ù–µ—Ç –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
  <div class="empty-s">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
</div>

<div class="pad" id="pl-list" style="margin-top:4px"></div>

<div class="pad gap">
  <button class="btn btn-p" onclick="openScr('scr-act')">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
</div>
<div style="height:8px"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SLEEP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-sleep">
<div class="reveal">
<div class="pad">
  <div class="t2" style="margin-bottom:1px">–°–æ–Ω</div>
  <div class="t5">—Ö–æ—Ä–æ—à–∏–π —Å–æ–Ω ‚Äî –æ—Å–Ω–æ–≤–∞ –≤—Å–µ–≥–æ</div>
</div>
<div class="pad gap">
<div class="card">
  <div class="t5" style="margin-bottom:7px">–ü—Ä–æ—à–ª–∞—è –Ω–æ—á—å</div>
  <div style="display:flex;align-items:center;gap:16px">
    <div>
      <div style="font-size:48px;font-weight:900;line-height:1;color:var(--sleep)" id="sl-h">‚Äî</div>
      <div class="t5" style="margin-top:2px">—á–∞—Å–æ–≤</div>
    </div>
    <div>
      <div style="font-size:34px" id="sl-qico">‚Äî</div>
      <div class="sq" id="sl-dots" style="margin-top:4px"></div>
    </div>
  </div>
</div>
</div>
<button class="btn btn-p" style="margin:10px 16px 0;width:calc(100% - 32px)" onclick="openScr('scr-sleep')">–ó–∞–ø–∏—Å–∞—Ç—å —Å–æ–Ω</button>
<div class="sec">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –Ω–æ—á–µ–π</div>
<div class="pad"><div class="card" id="sl-hist" style="padding:10px 12px"></div></div>
<div class="sec">–°—Ä–µ–¥–Ω–µ–µ –∑–∞ –Ω–µ–¥–µ–ª—é</div>
<div class="pad sb-row">
  <div class="sbox"><div class="sv" id="sl-avg-h" style="color:var(--sleep)">‚Äî</div><div class="sl">—á–∞—Å–æ–≤</div></div>
  <div class="sbox"><div class="sv" id="sl-avg-q">‚Äî</div><div class="sl">–∫–∞—á–µ—Å—Ç–≤–æ</div></div>
</div>
<div style="height:8px"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-progress">
<div class="reveal">
<div class="pad">
  <div class="t2" style="margin-bottom:1px">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
  <div class="t5">—Ç–≤–æ–π –ø—É—Ç—å –∫ –ª–µ—Ç—É</div>
</div>
<div class="pad gap">
<div class="card">
  <div class="t5" style="margin-bottom:5px">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–µ—Å–∞</div>
  <div style="display:flex;align-items:flex-end;gap:7px;margin-bottom:3px">
    <span style="font-size:38px;font-weight:900;line-height:1" id="pr-wcur">‚Äî</span>
    <span class="t5" style="padding-bottom:4px">–∫–≥ ¬∑ —Ü–µ–ª—å <b style="color:var(--text)" id="pr-wgoal">‚Äî</b></span>
  </div>
  <div class="t5" id="pr-winfo" style="margin-bottom:8px"></div>
  <div class="pb" style="height:8px"><div class="pbf pb-sun" id="pr-wbar" style="width:0%;height:100%"></div></div>
  <div style="display:flex;justify-content:space-between;margin-top:4px">
    <span class="t5" id="pr-wstart">‚Äî</span>
    <span style="font-size:11px;font-weight:900;color:var(--sun)" id="pr-wpct">0%</span>
    <span class="t5" id="pr-wgoal2">‚Äî</span>
  </div>
  <div id="pr-forecast" style="margin-top:7px;font-size:11px;font-weight:800;color:var(--green)"></div>
</div>
</div>

<div class="pad gap">
<div class="card" style="padding:14px">
  <div class="t5" style="margin-bottom:8px">–î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞</div>
  <canvas id="wchart" height="90" style="width:100%;display:block"></canvas>
</div>
</div>

<div class="sec">–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</div>
<div class="pad sb-row">
  <div class="sbox"><div class="sv" style="color:var(--water)" id="pw-water">‚Äî</div><div class="sl">–≤–æ–¥–∞ –º–ª</div></div>
  <div class="sbox"><div class="sv" style="color:var(--cal)" id="pw-cal">‚Äî</div><div class="sl">–∫–∫–∞–ª</div></div>
  <div class="sbox"><div class="sv" style="color:var(--sleep)" id="pw-sleep">‚Äî</div><div class="sl">—Å–æ–Ω —á</div></div>
</div>

<button class="btn btn-p" style="margin:10px 16px 0;width:calc(100% - 32px)" onclick="openScr('scr-weight')">–ó–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å</button>
<button class="btn btn-g" style="margin:8px 16px 0;width:calc(100% - 32px);padding:14px;font-size:14px;font-weight:800;border-radius:18px" onclick="openScr('scr-whist')">üìä –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞</button>

<div class="sec">–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞</div>
<div class="pad"><div class="card" id="pr-whist" style="padding:10px 12px"></div></div>

<div class="sec">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</div>
<div class="pad sb-row">
  <div class="sbox"><div class="sv grad" id="at-t">0</div><div class="sl">—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div></div>
  <div class="sbox"><div class="sv grad" id="at-w">0</div><div class="sl">–≤–æ–¥—ã –ª</div></div>
  <div class="sbox"><div class="sv grad" id="at-s">0</div><div class="sl">—Å–µ—Ä–∏—è –¥–Ω</div></div>
</div>
<div style="height:8px"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-profile">
<div class="reveal">

<div style="display:flex;align-items:center;gap:14px;padding:4px 16px 0">
  <div class="pav" id="pf-av">–ê</div>
  <div>
    <div class="t2" id="pf-name">‚Äî</div>
    <div class="t5" id="pf-meta" style="margin-top:2px">‚Äî</div>
  </div>
</div>

<div id="pf-bmi-row" style="margin-top:12px;padding:0 16px;display:none">
  <div class="sb-row">
    <div class="sbox"><div class="sv" id="pf-bmi">‚Äî</div><div class="sl">–ò–ú–¢</div></div>
    <div class="sbox"><div class="sv" id="pf-ideal">‚Äî</div><div class="sl">–∏–¥–µ–∞–ª –∫–≥</div></div>
    <div class="sbox"><div class="sv" id="pf-bmr">‚Äî</div><div class="sl">BMR</div></div>
  </div>
</div>

<div class="sec">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
<div class="pad">
<div class="card">
  <div class="lt" onclick="openScr('scr-pdata')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg></div>
    <span class="lt-lbl">–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</span>
    <span class="lt-val" id="pf-pname">‚Äî</span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
  <div class="lt" onclick="openScr('scr-goals')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="4"/><path d="M12 3v2M12 19v2M3 12h2M19 12h2"/></svg></div>
    <span class="lt-lbl">–ú–æ–∏ —Ü–µ–ª–∏</span>
    <span class="lt-val"><span id="pf-gw">‚Äî</span></span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
  <div class="lt" style="padding-bottom:0;border:none" onclick="openScr('scr-appsett')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div>
    <span class="lt-lbl">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
</div>
</div>

<div class="sec">–§–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</div>
<div class="pad">
<div class="card">
  <div class="lt">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
    <span class="lt-lbl">–†–æ—Å—Ç</span>
    <span class="lt-val" id="pf-height">‚Äî</span>
  </div>
  <div class="lt">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM12 12h.01M8 12h.01M16 12h.01"/></svg></div>
    <span class="lt-lbl">–í–æ–∑—Ä–∞—Å—Ç</span>
    <span class="lt-val" id="pf-age">‚Äî</span>
  </div>
  <div class="lt" style="padding-bottom:0;border:none">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM8 12h8M12 8v8"/></svg></div>
    <span class="lt-lbl">–ù–æ—Ä–º–∞ –≤–æ–¥—ã</span>
    <span class="lt-val" id="pf-gwater">‚Äî</span>
  </div>
</div>
</div>

<div style="height:8px"></div>
</div>
</div>

</div><!-- /pages -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREEN LAYER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="slayer">

<!-- Scr: –í–µ—Å -->
<div class="scr" id="scr-weight">
  <div class="scr-hdr">
    <div class="scr-title">–ó–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å</div>
    <div class="scr-subtitle">–ø–æ—Ç—è–Ω–∏ –±–∞—Ä–∞–±–∞–Ω —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å</div>
  </div>
  <div class="scr-body">
    <div class="card" style="padding:20px 16px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;padding:0 4px">
        <span style="font-size:12px;font-weight:800;color:var(--hint);text-transform:uppercase;letter-spacing:.06em">–ö–ì</span>
        <span style="font-size:12px;font-weight:800;color:var(--hint);text-transform:uppercase;letter-spacing:.06em">.X</span>
      </div>
      <div class="wp-row" id="wp-weight-wrap"></div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitWeight()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Å</button>
  </div>
</div>

<!-- Scr: –°–æ–Ω -->
<div class="scr" id="scr-sleep">
  <div class="scr-hdr">
    <div class="scr-title">–ó–∞–ø–∏—Å–∞—Ç—å —Å–æ–Ω</div>
    <div class="scr-subtitle">—Å–∫–æ–ª—å–∫–æ —Å–ø–∞–ª –ø—Ä–æ—à–ª–æ–π –Ω–æ—á—å—é?</div>
  </div>
  <div class="scr-body">
    <div class="card" style="padding:20px 16px;margin-bottom:12px">
      <div class="wp-row" id="wp-sleep-wrap"></div>
    </div>
    <div class="card" style="padding:16px">
      <div class="f-lbl" style="margin-bottom:12px;font-size:15px">–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞</div>
      <div class="seg" id="seg-sleepq">
        <button class="seg-btn" onclick="setSleepQ(1)" data-q="1">üò´</button>
        <button class="seg-btn" onclick="setSleepQ(2)" data-q="2">üò¥</button>
        <button class="seg-btn on" onclick="setSleepQ(3)" data-q="3">üòë</button>
        <button class="seg-btn" onclick="setSleepQ(4)" data-q="4">üôÇ</button>
        <button class="seg-btn" onclick="setSleepQ(5)" data-q="5">üåü</button>
      </div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitSleep()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–Ω</button>
  </div>
</div>

<!-- Scr: –ö–∞–ª–æ—Ä–∏–∏ -->
<div class="scr" id="scr-cal">
  <div class="scr-hdr">
    <div class="scr-title">–î–æ–±–∞–≤–∏—Ç—å –µ–¥—É</div>
    <div class="scr-subtitle">–∑–∞–ø–∏—à–∏ —á—Ç–æ —Å—ä–µ–ª</div>
  </div>
  <div class="scr-body">
    <div class="card" style="padding:16px;margin-bottom:12px">
      <div class="f-lbl" style="margin-bottom:10px">–ü—Ä–∏—ë–º –ø–∏—â–∏</div>
      <div class="seg" id="seg-meal">
        <button class="seg-btn on" onclick="setMeal('breakfast')" data-m="breakfast">–ó–∞–≤—Ç—Ä–∞–∫</button>
        <button class="seg-btn" onclick="setMeal('lunch')" data-m="lunch">–û–±–µ–¥</button>
        <button class="seg-btn" onclick="setMeal('dinner')" data-m="dinner">–£–∂–∏–Ω</button>
        <button class="seg-btn" onclick="setMeal('snack')" data-m="snack">–ü–µ—Ä–µ–∫—É—Å</button>
      </div>
    </div>
    <div class="card" style="padding:16px">
      <div class="f-row">
        <span class="f-lbl">–ö–∞–ª–æ—Ä–∏–π, –∫–∫–∞–ª</span>
        <input class="f-inp" id="inp-cal" type="number" inputmode="numeric" step="10" min="0" max="3000" placeholder="500">
      </div>
      <div>
        <span class="f-lbl">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞</span>
        <input class="f-inp f-inp-wide" id="inp-cal-desc" type="text" placeholder="–≥—Ä–µ—á–∫–∞, –∫—É—Ä–∏—Ü–∞‚Ä¶">
      </div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitCal()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
</div>

<!-- Scr: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî MULTI-STEP -->
<div class="scr" id="scr-act">
  <div class="scr-hdr">
    <div class="step-ind">
      <div class="step-pip on" id="sp1"></div>
      <div class="step-pip" id="sp2"></div>
      <div class="step-pip" id="sp3"></div>
    </div>
    <div class="scr-title" id="act-step-title">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
    <div class="scr-subtitle" id="act-step-sub">–∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞?</div>
  </div>
  <div class="scr-body">

    <!-- –®–∞–≥ 1: –ù–∞–∑–≤–∞–Ω–∏–µ -->
    <div class="act-step active" id="act-s1">
      <input class="f-inp f-inp-wide" id="inp-aname" type="text" placeholder="–ü—Ä–æ–±–µ–∂–∫–∞, –π–æ–≥–∞, –∑–∞–ª‚Ä¶"
        style="font-size:18px;padding:16px;margin-top:4px" autocomplete="off">
      <div style="margin-top:16px">
        <div class="t5" style="margin-bottom:8px;text-transform:uppercase;letter-spacing:.06em">–∏–ª–∏ –≤—ã–±–µ—Ä–∏</div>
        <div class="type-grid" id="act-quick">
          <div class="type-card on" onclick="actQuick('–ü—Ä–æ–±–µ–∂–∫–∞','run')"><div class="type-card-ico">üèÉ</div><div class="type-card-lbl">–ü—Ä–æ–±–µ–∂–∫–∞</div></div>
          <div class="type-card" onclick="actQuick('–ó–∞–ª','gym')"><div class="type-card-ico">üí™</div><div class="type-card-lbl">–ó–∞–ª</div></div>
          <div class="type-card" onclick="actQuick('–ô–æ–≥–∞','yoga')"><div class="type-card-ico">üßò</div><div class="type-card-lbl">–ô–æ–≥–∞</div></div>
          <div class="type-card" onclick="actQuick('–•–æ–¥—å–±–∞','walk')"><div class="type-card-ico">üö∂</div><div class="type-card-lbl">–•–æ–¥—å–±–∞</div></div>
          <div class="type-card" onclick="actQuick('–í–µ–ª–æ—Å–∏–ø–µ–¥','bike')"><div class="type-card-ico">üö¥</div><div class="type-card-lbl">–í–µ–ª–æ—Å–∏–ø–µ–¥</div></div>
          <div class="type-card" onclick="actQuick('–ü–ª–∞–≤–∞–Ω–∏–µ','swim')"><div class="type-card-ico">üèä</div><div class="type-card-lbl">–ü–ª–∞–≤–∞–Ω–∏–µ</div></div>
        </div>
      </div>
    </div>

    <!-- –®–∞–≥ 2: –í—Ä–µ–º—è –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
    <div class="act-step" id="act-s2">
      <div class="t5" style="text-align:center;margin-bottom:4px;text-transform:uppercase;letter-spacing:.06em">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</div>
      <div class="card" style="padding:16px;margin-bottom:12px">
        <div class="wp-row" id="wp-time-wrap"></div>
      </div>
      <div class="t5" style="text-align:center;margin-bottom:4px;text-transform:uppercase;letter-spacing:.06em">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
      <div class="card" style="padding:16px">
        <div class="wp-row" id="wp-dur-wrap"></div>
      </div>
    </div>

    <!-- –®–∞–≥ 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ -->
    <div class="act-step" id="act-s3">
      <div style="text-align:center;padding:20px 0 10px">
        <div id="act-confirm-ico" style="font-size:56px;margin-bottom:12px">üèÉ</div>
        <div id="act-confirm-name" style="font-size:24px;font-weight:900;letter-spacing:-.02em;margin-bottom:6px">‚Äî</div>
        <div id="act-confirm-time" style="font-size:15px;color:var(--hint);font-weight:700">‚Äî</div>
      </div>
      <div class="card" style="padding:16px;margin-top:8px">
        <div class="f-row" style="padding-bottom:0">
          <span class="f-lbl">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</span>
          <div class="tog on" id="tog-act-rem" onclick="this.classList.toggle('on');this.classList.toggle('off')"></div>
        </div>
      </div>
    </div>

  </div>
  <div class="scr-foot" id="act-foot" style="padding:0 16px calc(var(--sb)+20px)">
    <button class="btn btn-p" id="act-next-btn" onclick="actStepNext()">–î–∞–ª–µ–µ ‚Üí</button>
  </div>
</div>

<!-- Scr: –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="scr" id="scr-pdata">
  <div class="scr-hdr">
    <div class="scr-title">–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</div>
  </div>
  <div class="scr-body">
    <div class="card" style="padding:16px;margin-bottom:12px">
      <div class="f-row"><span class="f-lbl">–ò–º—è</span><input class="f-inp" id="inp-pname" type="text" placeholder="–ê–ª–µ–∫—Å–µ–π" style="text-align:left"></div>
      <div class="f-row"><span class="f-lbl">–†–æ—Å—Ç, —Å–º</span><input class="f-inp" id="inp-height" type="number" inputmode="numeric" min="100" max="250" placeholder="175"></div>
      <div class="f-row" style="padding-bottom:0"><span class="f-lbl">–í–æ–∑—Ä–∞—Å—Ç</span><input class="f-inp" id="inp-age" type="number" inputmode="numeric" min="10" max="100" placeholder="25"></div>
    </div>
    <div class="card" style="padding:16px">
      <div class="f-lbl" style="margin-bottom:10px">–ü–æ–ª</div>
      <div class="seg" id="seg-gender">
        <button class="seg-btn on" onclick="setGender('male')" data-g="male">–ú—É–∂—Å–∫–æ–π</button>
        <button class="seg-btn" onclick="setGender('female')" data-g="female">–ñ–µ–Ω—Å–∫–∏–π</button>
      </div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<!-- Scr: –¶–µ–ª–∏ -->
<div class="scr" id="scr-goals">
  <div class="scr-hdr">
    <div class="scr-title">–ú–æ–∏ —Ü–µ–ª–∏</div>
  </div>
  <div class="scr-body">
    <div class="card" style="padding:16px">
      <div class="f-row"><span class="f-lbl">–¶–µ–ª–µ–≤–æ–π –≤–µ—Å, –∫–≥</span><input class="f-inp" id="inp-gw" type="number" inputmode="decimal" step="0.5" placeholder="70"></div>
      <div class="f-row"><span class="f-lbl">–ù–æ—Ä–º–∞ –≤–æ–¥—ã, –º–ª</span><input class="f-inp" id="inp-gwat" type="number" inputmode="numeric" step="100" placeholder="2000"></div>
      <div class="f-row" style="padding-bottom:0"><span class="f-lbl">–ù–æ—Ä–º–∞ –∫–∞–ª–æ—Ä–∏–π</span><input class="f-inp" id="inp-gcal" type="number" inputmode="numeric" step="50" placeholder="2000"></div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitGoals()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª–∏</button>
  </div>
</div>

<!-- Scr: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
<div class="scr" id="scr-appsett">
  <div class="scr-hdr">
    <div class="scr-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
  </div>
  <div class="scr-body">
    <div class="sec" style="padding-left:0;padding-top:4px">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
    <div class="card" style="margin-bottom:12px">
      <div class="lt"><div class="lt-ic">‚öñÔ∏è</div><span class="lt-lbl">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Å</span><div class="tog on" id="tog-w" onclick="toggleSett('w')"></div></div>
      <div class="lt"><div class="lt-ic">üíß</div><span class="lt-lbl">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–æ–¥—É</span><div class="tog on" id="tog-water" onclick="toggleSett('water')"></div></div>
      <div class="lt"><div class="lt-ic">üî•</div><span class="lt-lbl">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏</span><div class="tog on" id="tog-cal" onclick="toggleSett('cal')"></div></div>
      <div class="lt" style="padding-bottom:0;border:none"><div class="lt-ic">üåô</div><span class="lt-lbl">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–Ω</span><div class="tog on" id="tog-sleep" onclick="toggleSett('sleep')"></div></div>
    </div>
    <div class="sec" style="padding-left:0">–î–∞–Ω–Ω—ã–µ</div>
    <div class="card">
      <div class="lt" style="padding-bottom:0;border:none;color:var(--red);cursor:pointer" onclick="confirmReset()">
        <div class="lt-ic" style="background:rgba(244,92,92,.1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/></svg></div>
        <span class="lt-lbl" style="color:var(--red)">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</span>
      </div>
    </div>
    <div style="text-align:center;padding:24px 0 8px">
      <div class="t5">letify ¬∑ ver 3.0</div>
    </div>
  </div>
</div>
<!-- Scr: –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞ -->
<div class="scr" id="scr-whist">
  <div class="scr-hdr">
    <div class="scr-title">–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞</div>
    <div class="scr-subtitle">–≤—Å–µ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è</div>
  </div>
  <div class="scr-body">
    <div class="card" style="padding:10px 14px" id="scr-whist-list">
      <div style="text-align:center;padding:20px;color:var(--hint);font-size:13px;font-weight:600">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
    </div>
  </div>
</div>

</div><!-- /slayer -->

<div id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ISLAND NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav id="nav">
  <!-- Home -->
  <div class="nt on" id="nt-home" onclick="navTo('home')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9.5z"/><path d="M9 21V12h6v9"/></svg>
    <div class="nt-dot"></div>
  </div>
  <!-- Track -->
  <div class="nt" id="nt-track" onclick="navTo('track')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="3" width="16" height="18" rx="2"/><path d="M8 7h8M8 11h8M8 15h5"/></svg>
    <div class="nt-dot"></div>
  </div>
  <!-- Plan -->
  <div class="nt" id="nt-plan" onclick="navTo('plan')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18M9 16l2 2 4-4"/></svg>
    <div class="nt-dot"></div>
  </div>
  <!-- Sleep -->
  <div class="nt" id="nt-sleep" onclick="navTo('sleep')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    <div class="nt-dot"></div>
  </div>
  <!-- Progress -->
  <div class="nt" id="nt-progress" onclick="navTo('progress')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 16l4-4 4 4 4-6"/></svg>
    <div class="nt-dot"></div>
  </div>
  <!-- Profile -->
  <div class="nt" id="nt-profile" onclick="navTo('profile')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
    <div class="nt-dot"></div>
  </div>
</nav>

</div><!-- /root -->

<!-- nav moved outside root to avoid stacking context issues -->

<script>
/* ‚ïê‚ïê‚ïê‚ïê TG INIT ‚ïê‚ïê‚ïê‚ïê */
const tg=window.Telegram?.WebApp;
if(tg){
  tg.ready();tg.expand();
  if(typeof tg.requestFullscreen==='function')tg.requestFullscreen();
  if(typeof tg.disableVerticalSwipes==='function')tg.disableVerticalSwipes();
  if(typeof tg.setHeaderColor==='function')tg.setHeaderColor('bg_color');
  if(typeof tg.setBackgroundColor==='function')tg.setBackgroundColor('bg_color');
  tg.onEvent('themeChanged',applyTheme);
  tg.onEvent('viewportChanged',_applySA);
  tg.onEvent('safeAreaChanged',_applySA);
  tg.onEvent('fullscreenChanged',_applySA);
  setTimeout(_applySA,120);setTimeout(_applySA,600);
}
function _applySA(){
  const saTop=Math.max(tg?.safeAreaInset?.top??0,0);
  const csaTop=Math.max(tg?.contentSafeAreaInset?.top??0,0);
  const top=saTop+csaTop;
  const saBot=Math.max(tg?.safeAreaInset?.bottom??0,0);
  const csaBot=Math.max(tg?.contentSafeAreaInset?.bottom??0,0);
  const bot=saBot+csaBot;
  const st=Math.min(Math.max(top,0),120);
  const sb=Math.min(Math.max(bot,0),80);
  document.documentElement.style.setProperty('--st',st+'px');
  document.documentElement.style.setProperty('--sb',sb+'px');
  const nav=document.getElementById('nav');
  if(nav&&!nav.classList.contains('gone'))nav.style.bottom=(12+sb)+'px';
}
function applyTheme(){
  const p=tg?.themeParams||{};
  const dark=tg?.colorScheme==='dark'||window.matchMedia?.('(prefers-color-scheme:dark)').matches;
  document.body.classList.toggle('tg-dark',dark);
  if(dark){
    // –í —Ç—ë–º–Ω–æ–º —Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —á—ë—Ä–Ω–æ–≥–æ –Ω–∞ —á—ë—Ä–Ω–æ–º
    const bg=p.bg_color||'#17212b';
    document.documentElement.style.setProperty('--bg',bg);
    document.documentElement.style.setProperty('--bg2',bg);
    document.documentElement.style.setProperty('--text',p.text_color||'#ffffff');
    document.documentElement.style.setProperty('--hint',p.hint_color||'#708499');
  }else{
    // –°–≤–µ—Ç–ª—ã–π —Ä–µ–∂–∏–º ‚Äî –±–µ—Ä—ë–º —Ü–≤–µ—Ç–∞ –∏–∑ Telegram
    const m={'--bg':p.bg_color,'--bg2':p.secondary_bg_color||p.bg_color,'--text':p.text_color,'--hint':p.hint_color};
    for(const[k,v]of Object.entries(m))if(v)document.documentElement.style.setProperty(k,v);
  }
}
applyTheme();

/* ‚ïê‚ïê‚ïê‚ïê API ‚ïê‚ïê‚ïê‚ïê */
const API_BASE='https://letify-production.up.railway.app';
const tgUser=tg?.initDataUnsafe?.user;
const UID=tgUser?.id||null;
const TODAY=new Date().toLocaleDateString('en-CA');

let C={
  user:{name:'‚Ä¶',height:0,age:0,start_weight:0,goal_weight:0,water_goal:2000,cal_goal:2000,gender:'male'},
  settings:{show_weight:1,show_water:1,show_calories:1,show_sleep:1},
  water:{total:0,entries:[],streak:0},calories:{},
  weight_log:[],sleep_log:[],acts_today:[],products:[]
};

async function loadData(){
  if(!UID){_demo();return;}
  try{
    const r=await fetch(`${API_BASE}/api/data?uid=${UID}`);
    if(!r.ok)throw 0;
    const d=await r.json();
    C.user=d.user||C.user;C.settings=d.settings||C.settings;
    C.water=d.water||C.water;C.calories=d.calories||C.calories;
    C.weight_log=d.weight_log||C.weight_log;C.sleep_log=d.sleep_log||C.sleep_log;
    C.acts_today=d.acts_today||C.acts_today;C.products=d.products||C.products;
  }catch{_demo();}
}
function _demo(){
  const g=k=>{try{const r=localStorage.getItem('lf2_'+k);return r?JSON.parse(r):null}catch{return null}};
  const s=(k,v)=>{try{localStorage.setItem('lf2_'+k,JSON.stringify(v))}catch{}};
  if(!g('ds')){
    s('user',{name:tgUser?.first_name||'–ê–ª–µ–∫—Å',height:175,age:27,start_weight:85,goal_weight:75,water_goal:2500,cal_goal:2000,gender:'male'});
    const now=new Date(),wl=[],sl=[];
    for(let i=13;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);wl.push({weight:+(85-((13-i)*.25)+(Math.random()-.5)*.3).toFixed(1),logged_at:d.toLocaleDateString('en-CA')});}
    for(let i=6;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);sl.push({hours:+(6.5+Math.random()*2).toFixed(1),quality:3+Math.floor(Math.random()*3),logged_at:d.toLocaleDateString('en-CA')});}
    s('wlog',wl);s('slog',sl);s('wd_'+TODAY,{total:1350,entries:[250,200,150,250,200,150,150]});
    s('cd_'+TODAY,{breakfast:420,lunch:680,dinner:0,snack:185,other:0});s('streak',7);
    s('acts_'+TODAY,[{id:1,name:'–ü—Ä–æ–±–µ–∂–∫–∞',type:'run',scheduled_at:'2024-01-01T07:00',duration:30,completed:1},{id:2,name:'–ó–∞–ª',type:'gym',scheduled_at:'2024-01-01T18:30',duration:60,completed:0},{id:3,name:'–ô–æ–≥–∞',type:'yoga',scheduled_at:'2024-01-01T21:00',duration:25,completed:0}]);
    s('ds',1);
  }
  const u=g('user')||{},wd=g('wd_'+TODAY)||{total:0,entries:[]},cd=g('cd_'+TODAY)||{};
  C.user=u;C.settings={show_weight:1,show_water:1,show_calories:1,show_sleep:1};
  C.water={total:wd.total||0,entries:wd.entries||[],streak:g('streak')||0};
  C.calories=cd;C.weight_log=g('wlog')||[];C.sleep_log=g('slog')||[];
  C.acts_today=g('acts_'+TODAY)||[];
  C.products=[{id:1,name:'–±–∞–Ω–∞–Ω',calories:89,protein:1.1,fat:0.3,carbs:23},{id:2,name:'—è–±–ª–æ–∫–æ',calories:52,protein:0.3,fat:0.2,carbs:14},{id:3,name:'–∫—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞',calories:165,protein:31,fat:3.6,carbs:0},{id:4,name:'—è–π—Ü–æ',calories:155,protein:13,fat:11,carbs:1.1},{id:5,name:'—Ç–≤–æ—Ä–æ–≥ 5%',calories:121,protein:17,fat:5,carbs:3},{id:6,name:'–≥—Ä–µ—á–∫–∞',calories:92,protein:3.4,fat:1,carbs:20}];
}
async function apiPost(path,body){
  if(!UID)return;
  try{await fetch(`${API_BASE}${path}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid:UID,...body})});}
  catch{}
}
async function reload(){
  await loadData();
  const rMap={home:renderHome,track:()=>renderTrack(trackTab),plan:renderPlan,sleep:renderSleep,progress:renderProgress,profile:renderProfile};
  rMap[curTab]?.();
}
const gU=()=>C.user;
const gSS=()=>({w:!!C.settings?.show_weight,water:!!C.settings?.show_water,cal:!!C.settings?.show_calories,sleep:!!C.settings?.show_sleep});
const gWL=()=>C.weight_log.map(r=>({weight:r.weight,logged_at:(r.logged_at||'').slice(0,10)}));
const gSL=()=>C.sleep_log.map(r=>({hours:r.hours,quality:r.quality,logged_at:(r.logged_at||'').slice(0,10)}));
const gWD=()=>C.water;
const gCD=()=>C.calories;
const gActs=()=>C.acts_today.map(a=>({...a,time:(a.scheduled_at||'').slice(11,16)||'00:00',completed:!!a.completed}));
const gProds=()=>C.products;
const gStreak=()=>C.water.streak||0;
const totalCal=()=>Object.values(gCD()).reduce((a,b)=>a+b,0);

/* ‚ïê‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê */
const TABS=['home','track','plan','sleep','progress','profile'];
let curTab='home',trackTab='water',curScr=null;

function navTo(tab){
  if(tab===curTab&&!curScr)return;
  if(curScr)closeScr(false);
  curTab=tab;
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const pg=document.getElementById('p-'+tab);
  if(pg){pg.scrollTop=0;pg.classList.add('active');}
  TABS.forEach(t=>{const el=document.getElementById('nt-'+t);if(el)el.classList.toggle('on',t===tab);});
  const renders={home:renderHome,track:()=>renderTrack(trackTab),plan:renderPlan,sleep:renderSleep,progress:renderProgress,profile:renderProfile};
  renders[tab]?.();
  tg?.HapticFeedback?.selectionChanged();
}

function setTTab(t){
  trackTab=t;
  ['water','cal','prod'].forEach(k=>{
    document.getElementById('tt-'+k)?.classList.toggle('on',k===t);
    const b=document.getElementById('tt-'+k+'-body');if(b)b.style.display=k===t?'':'none';
  });
  renderTrack(t);
}

/* ‚ïê‚ïê‚ïê‚ïê SCREENS ‚ïê‚ïê‚ïê‚ïê */
function openScr(id){
  curScr=id;
  const nav=document.getElementById('nav');
  nav?.classList.add('gone');
  const navEl=document.getElementById('nav');
  if(navEl)navEl.style.bottom='-120px';
  _populateScr(id);
  const scr=document.getElementById(id);
  if(scr)scr.classList.add('open');
  if(tg?.BackButton){tg.BackButton.show();tg.BackButton.onClick(closeScr);}
  tg?.HapticFeedback?.impactOccurred('light');
  // Reset multi-step
  if(id==='scr-act'){actStep=1;_renderActStep();}
}
function closeScr(doNav=true){
  if(!curScr)return;
  const scr=document.getElementById(curScr);
  if(scr)scr.classList.remove('open');
  curScr=null;
  const navEl=document.getElementById('nav');
  navEl?.classList.remove('gone');
  const sb=Math.min(Math.max(tg?.safeAreaInset?.bottom??0,0),80);
  if(navEl)navEl.style.bottom=(12+sb)+'px';
  if(tg?.BackButton){tg.BackButton.hide();tg.BackButton.offClick(closeScr);}
}
function _populateScr(id){
  const u=gU(),ss=gSS();
  if(id==='scr-pdata'){
    const ni=document.getElementById('inp-pname');if(ni)ni.value=u.name||'';
    const hi=document.getElementById('inp-height');if(hi)hi.value=u.height||'';
    const ai=document.getElementById('inp-age');if(ai)ai.value=u.age||'';
    _gender=u.gender||'male';
    document.querySelectorAll('#seg-gender .seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.g===_gender));
  }
  if(id==='scr-goals'){
    const gi=document.getElementById('inp-gw');if(gi)gi.value=u.goal_weight||'';
    const wi=document.getElementById('inp-gwat');if(wi)wi.value=u.water_goal||2000;
    const ci=document.getElementById('inp-gcal');if(ci)ci.value=u.cal_goal||2000;
  }
  if(id==='scr-appsett'){
    ['w','water','cal','sleep'].forEach(k=>{
      const tog=document.getElementById('tog-'+k),on=ss[k]!==false;
      if(tog){tog.classList.toggle('on',on);tog.classList.toggle('off',!on);}
    });
  }
  if(id==='scr-act'){
    // Reset input
    const ni=document.getElementById('inp-aname');if(ni)ni.value='';
    _actType='run';
    document.querySelectorAll('#act-quick .type-card').forEach((c,i)=>c.classList.toggle('on',i===0));
  }
  // Init pickers after layout
  if(id==='scr-weight')requestAnimationFrame(()=>initWeightPicker());
  if(id==='scr-sleep')requestAnimationFrame(()=>initSleepPicker());
  if(id==='scr-whist'){
    const wl=gWL().slice().reverse();
    const el=document.getElementById('scr-whist-list');
    if(el){
      if(!wl.length){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--hint);font-size:13px;font-weight:600">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';}
      else{
        el.innerHTML=wl.map((e,i)=>{
          const prev=wl[i+1];
          const diff=prev?+(e.weight-prev.weight).toFixed(1):0;
          return`<div class="hr"><div class="hr-d">${fmtD(e.logged_at)}</div><div class="hr-v">${e.weight.toFixed(1)} –∫–≥</div>${diff?`<div class="hr-diff ${diff<0?'d-neg':'d-pos'}">${diff>0?'+':''}${diff}</div>`:'<div style="min-width:32px"></div>'}</div>`;
        }).join('');
      }
    }
  }
}

/* ‚ïê‚ïê‚ïê‚ïê WHEEL PICKER ‚ïê‚ïê‚ïê‚ïê */
const PKR={};
const ITEM_H=44;

function mkPicker(container,items,initVal){
  container.innerHTML='';
  container.className='wp';
  container.style.width='100%';container.style.height=(ITEM_H*5)+'px';

  let selIdx=Math.max(0,items.findIndex(it=>String(it.v)===String(initVal)));

  container.innerHTML=`<div class="wp-sel"></div>
    <div class="wp-ft wp-ft-t"></div>
    <div class="wp-ft wp-ft-b"></div>
    <div class="wp-track"></div>`;

  const track=container.querySelector('.wp-track');

  function render(){
    const pads=2;
    let h='';
    for(let i=0;i<pads;i++)h+=`<div class="wp-item"></div>`;
    items.forEach((it,i)=>h+=`<div class="wp-item${i===selIdx?' sel':''}">${it.l}</div>`);
    for(let i=0;i<pads;i++)h+=`<div class="wp-item"></div>`;
    track.innerHTML=h;
  }
  render();

  function setY(y,anim){
    track.style.transition=anim?'transform .25s cubic-bezier(.25,.46,.45,.94)':'none';
    track.style.transform=`translateY(${y}px)`;
  }
  function yFor(idx){return -idx*ITEM_H;}
  let curY=yFor(selIdx);
  setY(curY,false);

  function clampY(y){return Math.max(-( items.length-1)*ITEM_H,Math.min(0,y));}
  function updateHighlight(){
    track.querySelectorAll('.wp-item:not([class~="wp-item wp-item"])');//no-op
    Array.from(track.children).slice(2,items.length+2).forEach((el,i)=>el.classList.toggle('sel',i===selIdx));
  }

  let sy=null,so,ly,lt,vel=0;
  container.addEventListener('pointerdown',e=>{
    sy=e.clientY;so=curY;ly=e.clientY;lt=Date.now();vel=0;
    track.style.transition='none';
    container.setPointerCapture(e.pointerId);
    e.preventDefault();
  },{passive:false});
  container.addEventListener('pointermove',e=>{
    if(sy===null)return;
    const now=Date.now(),dt=Math.max(1,now-lt);
    vel=(e.clientY-ly)/dt*16;ly=e.clientY;lt=now;
    curY=clampY(so+(e.clientY-sy));
    track.style.transform=`translateY(${curY}px)`;
    const li=Math.max(0,Math.min(Math.round(-curY/ITEM_H),items.length-1));
    if(li!==selIdx){selIdx=li;updateHighlight();}
  },{passive:false});
  function snap(){
    if(sy===null)return;sy=null;
    selIdx=Math.max(0,Math.min(Math.round(-(curY+vel*4)/ITEM_H),items.length-1));
    curY=yFor(selIdx);setY(curY,true);updateHighlight();
    tg?.HapticFeedback?.selectionChanged();
  }
  container.addEventListener('pointerup',snap);
  container.addEventListener('pointercancel',snap);

  return{get:()=>items[selIdx],setIdx(i){selIdx=Math.max(0,Math.min(i,items.length-1));curY=yFor(selIdx);setY(curY,false);updateHighlight();}};
}

function initWeightPicker(){
  const wl=gWL();
  const iw=wl.length?wl[wl.length-1].weight:70;
  const ii=Math.floor(iw),id=Math.round((iw-ii)*10);
  const intItems=Array.from({length:171},(_,i)=>({l:String(30+i),v:30+i}));
  const decItems=Array.from({length:10},(_,i)=>({l:'.'+i,v:i/10}));
  const wrap=document.getElementById('wp-weight-wrap');
  wrap.innerHTML='<div class="wp-col" style="flex:3"><div class="wp-lbl">–∫–≥</div><div id="wpi-i"></div></div><div class="wp-sep"> </div><div class="wp-col" style="flex:1;min-width:80px"><div class="wp-lbl">.X</div><div id="wpi-d"></div></div>';
  PKR.wi=mkPicker(document.getElementById('wpi-i'),intItems,ii);
  PKR.wd=mkPicker(document.getElementById('wpi-d'),decItems,id/10);
  PKR.wi.setIdx(intItems.findIndex(x=>x.v===ii));
  PKR.wd.setIdx(id);
}
function initSleepPicker(){
  const sl=gSL();
  const ih=sl.length?sl[sl.length-1].hours:8;
  const ihh=Math.floor(ih),idd=ih-ihh>=0.5?1:0;
  const hItems=Array.from({length:14},(_,i)=>({l:String(1+i),v:1+i}));
  const dItems=[{l:'.0',v:0},{l:'.5',v:.5}];
  const wrap=document.getElementById('wp-sleep-wrap');
  wrap.innerHTML='<div class="wp-col" style="flex:3"><div class="wp-lbl">—á–∞—Å–æ–≤</div><div id="wps-h"></div></div><div class="wp-col" style="flex:1;min-width:70px"><div class="wp-lbl">.X</div><div id="wps-d"></div></div>';
  PKR.sh=mkPicker(document.getElementById('wps-h'),hItems,ihh);
  PKR.sd=mkPicker(document.getElementById('wps-d'),dItems,idd===1?.5:0);
  PKR.sh.setIdx(hItems.findIndex(x=>x.v===ihh));
  PKR.sd.setIdx(idd);
}
function initTimePicker(){
  const hItems=Array.from({length:24},(_,i)=>({l:String(i).padStart(2,'0'),v:i}));
  const mItems=Array.from({length:12},(_,i)=>({l:String(i*5).padStart(2,'0'),v:i*5}));
  const wrap=document.getElementById('wp-time-wrap');
  wrap.innerHTML='<div class="wp-col"><div class="wp-lbl">—á</div><div id="wpt-h"></div></div><div class="wp-sep">:</div><div class="wp-col"><div class="wp-lbl">–º–∏–Ω</div><div id="wpt-m"></div></div>';
  PKR.th=mkPicker(document.getElementById('wpt-h'),hItems,8);
  PKR.tm=mkPicker(document.getElementById('wpt-m'),mItems,0);
  PKR.th.setIdx(8);PKR.tm.setIdx(0);
}
function initDurPicker(){
  const dItems=[5,10,15,20,25,30,40,45,60,75,90,120].map(v=>({l:v+' –º–∏–Ω',v}));
  const wrap=document.getElementById('wp-dur-wrap');
  wrap.innerHTML='<div class="wp-col" style="width:100%"><div class="wp-lbl">–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div><div id="wpt-dur" style="width:100%"></div></div>';
  PKR.dur=mkPicker(document.getElementById('wpt-dur'),dItems,30);
  PKR.dur.setIdx(5);
}

/* ‚ïê‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê */
const $=id=>document.getElementById(id);
const T=(id,v)=>{const e=$(id);if(e)e.textContent=v;};
const H=(id,v)=>{const e=$(id);if(e)e.innerHTML=v;};
function dts(){const n=new Date(),y=n.getMonth()>=5?n.getFullYear()+1:n.getFullYear();return Math.ceil((new Date(y,5,1)-n)/86400000);}
function pD(n){const a=Math.abs(n)%100;if(a>=11&&a<=19)return'–¥–Ω–µ–π';if(a%10===1)return'–¥–µ–Ω—å';if(a%10>=2&&a%10<=4)return'–¥–Ω—è';return'–¥–Ω–µ–π';}
function fmtD(s){if(!s)return'‚Äî';try{const d=new Date(s+'T00:00:00');const m=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];return d.getDate()+' '+m[d.getMonth()];}catch{return s;}}
function fmtMD(s){try{const d=new Date(s+'T00:00:00');return(d.getMonth()+1)+'/'+(d.getDate());}catch{return'';}}
function qIco(q){return['','üò´','üò¥','üòë','üôÇ','üåü'][q]||'üòë';}

const ACT_ICO={run:'üèÉ',walk:'üö∂',bike:'üö¥',gym:'üí™',yoga:'üßò',swim:'üèä',other:'‚ú®'};
const ACT_COL={run:'#FF6B35',walk:'#52C177',bike:'#4EAEE5',gym:'#E91E63',yoga:'#8B7FD4',swim:'#00BCD4',other:'#FFAB40'};

/* ‚ïê‚ïê‚ïê‚ïê ACTIONS ‚ïê‚ïê‚ïê‚ïê */
async function addW(ml){
  C.water.total=(C.water.total||0)+ml;
  C.water.entries=[...(C.water.entries||[]),ml];
  renderTrack('water');renderHome();
  toast('+'+ml+' –º–ª');
  tg?.HapticFeedback?.impactOccurred('light');
  await apiPost('/api/water',{amount:ml});
  await reload();
}
async function undoW(){
  if(!C.water.entries?.length){toast('–ù–µ—á–µ–≥–æ –æ—Ç–º–µ–Ω—è—Ç—å');return;}
  const last=C.water.entries.pop();
  C.water.total=Math.max(0,(C.water.total||0)-last);
  renderTrack('water');renderHome();toast('–û—Ç–º–µ–Ω–µ–Ω–æ ‚àí'+last+' –º–ª');
  await apiPost('/api/water/undo',{});await reload();
}
async function completeAct(id){
  const a=gActs().find(x=>x.id===id);if(!a)return;
  const ns=!a.completed;
  C.acts_today=C.acts_today.map(x=>x.id===id?{...x,completed:ns?1:0}:x);
  renderPlan();renderHome();
  toast(ns?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–û—Ç–º–µ–Ω–µ–Ω–æ');
  tg?.HapticFeedback?.notificationOccurred(ns?'success':'warning');
  await apiPost(ns?'/api/activity/complete':'/api/activity/uncomplete',{act_id:id});
  await reload();
}
function toggleSett(key){
  const ss=gSS();const nv=!ss[key];
  const fm={w:'show_weight',water:'show_water',cal:'show_calories',sleep:'show_sleep'};
  if(fm[key])C.settings[fm[key]]=nv?1:0;
  const tog=$('tog-'+key);if(tog){tog.classList.toggle('on',nv);tog.classList.toggle('off',!nv);}
  toast(nv?'–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è':'–°–∫—Ä—ã—Ç–æ');
  apiPost('/api/settings',{[fm[key]]:nv?1:0});
}

let _sleepQ=3,_mealType='breakfast',_actType='run',_gender='male';
let actStep=1;
const ACT_STEPS_TITLE=['–ù–∞–∑–≤–∞–Ω–∏–µ','–ö–æ–≥–¥–∞?','–ì–æ—Ç–æ–≤–æ!'];
const ACT_STEPS_SUB=['–∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞?','–≤—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å','–ø—Ä–æ–≤–µ—Ä—å –∏ –¥–æ–±–∞–≤—å –≤ –ø–ª–∞–Ω'];

function _renderActStep(){
  [1,2,3].forEach(i=>{
    document.getElementById('act-s'+i)?.classList.toggle('active',i===actStep);
    const pip=document.getElementById('sp'+i);
    if(pip){pip.classList.toggle('on',i===actStep);pip.classList.toggle('done',i<actStep);}
  });
  const t=document.getElementById('act-step-title'),s=document.getElementById('act-step-sub');
  if(t)t.textContent=ACT_STEPS_TITLE[actStep-1];
  if(s)s.textContent=ACT_STEPS_SUB[actStep-1];
  const btn=document.getElementById('act-next-btn');
  if(btn)btn.textContent=actStep===3?'‚úì –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–∞–Ω':'–î–∞–ª–µ–µ ‚Üí';
  // Init pickers on step 2
  if(actStep===2)requestAnimationFrame(()=>{initTimePicker();initDurPicker();});
  // Update confirm on step 3
  if(actStep===3){
    const name=document.getElementById('inp-aname')?.value||'‚Äî';
    const hv=PKR.th?.get(),mv=PKR.tm?.get(),dv=PKR.dur?.get();
    const time=hv&&mv?String(hv.v).padStart(2,'0')+':'+String(mv.v).padStart(2,'0'):'‚Äî';
    const dur=dv?dv.v:30;
    const ico=ACT_ICO[_actType]||'‚ú®';
    document.getElementById('act-confirm-ico')&&(document.getElementById('act-confirm-ico').textContent=ico);
    document.getElementById('act-confirm-name')&&(document.getElementById('act-confirm-name').textContent=name);
    document.getElementById('act-confirm-time')&&(document.getElementById('act-confirm-time').textContent=time+' ¬∑ '+dur+' –º–∏–Ω');
  }
  tg?.HapticFeedback?.selectionChanged();
}
function actStepNext(){
  if(actStep===1){
    const name=document.getElementById('inp-aname')?.value?.trim();
    if(!name){toast('–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ');return;}
    actStep=2;_renderActStep();
  } else if(actStep===2){
    actStep=3;_renderActStep();
  } else {
    submitAct();
  }
}
function actQuick(name,type){
  _actType=type;
  document.querySelectorAll('#act-quick .type-card').forEach(c=>c.classList.remove('on'));
  event?.target?.closest('.type-card')?.classList.add('on');
  const inp=document.getElementById('inp-aname');if(inp)inp.value=name;
}
function setSleepQ(q){_sleepQ=q;document.querySelectorAll('#seg-sleepq .seg-btn').forEach(b=>b.classList.toggle('on',+b.dataset.q===q));}
function setMeal(m){_mealType=m;document.querySelectorAll('#seg-meal .seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.m===m));}
function setGender(g){_gender=g;document.querySelectorAll('#seg-gender .seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.g===g));}
function setActType(at){_actType=at;document.querySelectorAll('#seg-atype .seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.t===at));}

async function submitWeight(){
  const iv=PKR.wi?.get(),dv=PKR.wd?.get();
  const v=iv&&dv!=null?iv.v+dv.v:null;
  if(!v||v<30||v>300){toast('–í—ã–±–µ—Ä–∏ –≤–µ—Å');return;}
  closeScr();
  C.weight_log=[...(C.weight_log||[]),{weight:v,logged_at:TODAY}];
  if(!C.user.start_weight)C.user.start_weight=v;
  renderProgress();renderHome();
  toast('–í–µ—Å '+v.toFixed(1)+' –∫–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/weight',{weight:v});await reload();
}
async function submitSleep(){
  const hv=PKR.sh?.get(),dv=PKR.sd?.get();
  const hrs=hv&&dv!=null?hv.v+(dv?.v||0):null;
  if(!hrs||hrs<.5||hrs>20){toast('–í—ã–±–µ—Ä–∏ —á–∞—Å—ã —Å–Ω–∞');return;}
  closeScr();
  C.sleep_log=[...(C.sleep_log||[]),{hours:hrs,quality:_sleepQ,logged_at:TODAY}];
  renderSleep();renderHome();
  toast('–°–æ–Ω '+hrs+' —á —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/sleep',{hours:hrs,quality:_sleepQ});await reload();
}
async function submitCal(){
  const cal=parseInt($('inp-cal')?.value);
  const desc=$('inp-cal-desc')?.value||'';
  if(!cal||cal<1){toast('–í–≤–µ–¥–∏ –∫–∞–ª–æ—Ä–∏–∏');return;}
  closeScr();
  if(!C.calories)C.calories={};
  C.calories[_mealType]=(C.calories[_mealType]||0)+cal;
  renderTrack('cal');renderHome();
  toast('+'+cal+' –∫–∫–∞–ª');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/calories',{amount:cal,meal_type:_mealType,description:desc});await reload();
}
async function submitProfile(){
  const name=$('inp-pname')?.value?.trim();
  const height=parseInt($('inp-height')?.value);
  const age=parseInt($('inp-age')?.value);
  if(!name){toast('–í–≤–µ–¥–∏ –∏–º—è');return;}
  closeScr();
  C.user={...C.user,name,height:height||0,age:age||0,gender:_gender};
  renderProfile();renderHome();toast('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/profile',{name,height:height||0,age:age||0,gender:_gender});await reload();
}
async function submitGoals(){
  const gw=parseFloat($('inp-gw')?.value)||0;
  const gwat=parseInt($('inp-gwat')?.value)||2000;
  const gcal=parseInt($('inp-gcal')?.value)||2000;
  closeScr();
  C.user={...C.user,goal_weight:gw,water_goal:gwat,cal_goal:gcal};
  renderProfile();renderHome();toast('–¶–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/goals',{goal_weight:gw,water_goal:gwat,cal_goal:gcal});await reload();
}
async function submitAct(){
  const name=$('inp-aname')?.value?.trim();
  const hv=PKR.th?.get(),mv=PKR.tm?.get(),dv=PKR.dur?.get();
  const time=hv&&mv?String(hv.v).padStart(2,'0')+':'+String(mv.v).padStart(2,'0'):'08:00';
  const dur=dv?dv.v:30;
  if(!name){toast('–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ');return;}
  closeScr();
  const fid=Date.now();
  C.acts_today=[...(C.acts_today||[]),{id:fid,name,type:_actType,scheduled_at:`${TODAY}T${time}:00`,duration:dur,completed:0}];
  renderPlan();renderHome();toast(name+' –¥–æ–±–∞–≤–ª–µ–Ω–æ üéâ');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/activity/create',{name,type:_actType,time,duration:dur});await reload();
}
function confirmReset(){
  if(!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?'))return;
  localStorage.clear();
  C={user:{name:'‚Ä¶',water_goal:2000,cal_goal:2000},settings:{show_weight:1,show_water:1,show_calories:1,show_sleep:1},water:{total:0,entries:[],streak:0},calories:{},weight_log:[],sleep_log:[],acts_today:[],products:[]};
  renderHome();renderProfile();toast('–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
}

/* ‚ïê‚ïê‚ïê‚ïê ACTIVITY STATUS ‚ïê‚ïê‚ïê‚ïê */
function actStatus(a){
  const now=new Date(),[hh,mm]=(a.time||'00:00').split(':').map(Number);
  const st=new Date();st.setHours(hh,mm,0,0);
  const en=new Date(st.getTime()+(a.duration||30)*60000);
  if(a.completed)return{s:'done',l:'–í—ã–ø–æ–ª–Ω–µ–Ω–æ'};
  if(now>en)return{s:'late',l:'–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ'};
  if(now>=st&&now<=en){const r=Math.round((en-now)/60000);return{s:'now',l:'–ò–¥—ë—Ç ¬∑ –µ—â—ë '+r+' –º–∏–Ω',p:(now-st)/(en-st)};}
  const df=Math.round((st-now)/60000);
  if(df<=30)return{s:'soon',l:'–ß–µ—Ä–µ–∑ '+df+' –º–∏–Ω'};
  return{s:'later',l:'–í '+a.time};
}
function fmtRange(a){
  const[hh,mm]=(a.time||'00:00').split(':').map(Number);
  const eh=hh+Math.floor((mm+(a.duration||30))/60),em=(mm+(a.duration||30))%60;
  return`${a.time} ‚Äì ${String(eh%24).padStart(2,'0')}:${String(em).padStart(2,'0')}`;
}

/* ‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê */
let _tt;
function toast(msg){
  const el=$('toast');el.textContent=msg;el.classList.add('show');
  clearTimeout(_tt);_tt=setTimeout(()=>el.classList.remove('show'),2000);
}

/* ‚ïê‚ïê‚ïê‚ïê CHART (Canvas) ‚ïê‚ïê‚ïê‚ïê */
let _chartRaf=null;
function drawChart(data){
  const canvas=$('wchart');if(!canvas)return;
  cancelAnimationFrame(_chartRaf);
  _chartRaf=requestAnimationFrame(()=>{
    const dpr=window.devicePixelRatio||1;
    const W=canvas.parentElement.offsetWidth||280,H=90;
    canvas.width=W*dpr;canvas.height=H*dpr;
    canvas.style.width=W+'px';canvas.style.height=H+'px';
    const ctx=canvas.getContext('2d');
    ctx.scale(dpr,dpr);
    const cs=getComputedStyle(document.documentElement);
    const sun=cs.getPropertyValue('--sun').trim()||'#FF6B35';
    const hint=cs.getPropertyValue('--hint').trim()||'#A89F90';
    const bg2=cs.getPropertyValue('--bg2').trim()||'#fff';
    ctx.clearRect(0,0,W,H);
    if(!data||data.length<2){
      ctx.fillStyle=hint;ctx.font='600 11px Nunito,sans-serif';
      ctx.textAlign='center';ctx.fillText('–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',W/2,H/2);return;
    }
    const ws=data.map(d=>d.weight);
    const mn=Math.min(...ws)-.5,mx=Math.max(...ws)+.5,rng=mx-mn||1;
    const pl={l:10,r:10,t:18,b:20};
    const xs=(W-pl.l-pl.r)/(data.length-1);
    const yf=w=>pl.t+(1-(w-mn)/rng)*(H-pl.t-pl.b);
    const pts=data.map((d,i)=>[pl.l+i*xs,yf(d.weight)]);
    // area
    const grad=ctx.createLinearGradient(0,0,0,H);
    grad.addColorStop(0,'rgba(255,107,53,.18)');grad.addColorStop(1,'rgba(255,107,53,0)');
    ctx.beginPath();ctx.moveTo(pts[0][0],pts[0][1]);
    for(let i=0;i<pts.length-1;i++){const cx=(pts[i][0]+pts[i+1][0])/2;ctx.bezierCurveTo(cx,pts[i][1],cx,pts[i+1][1],pts[i+1][0],pts[i+1][1]);}
    ctx.lineTo(pts[pts.length-1][0],H);ctx.lineTo(pts[0][0],H);ctx.closePath();
    ctx.fillStyle=grad;ctx.fill();
    // line
    ctx.beginPath();ctx.moveTo(pts[0][0],pts[0][1]);
    for(let i=0;i<pts.length-1;i++){const cx=(pts[i][0]+pts[i+1][0])/2;ctx.bezierCurveTo(cx,pts[i][1],cx,pts[i+1][1],pts[i+1][0],pts[i+1][1]);}
    ctx.strokeStyle=sun;ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';ctx.stroke();
    // dots + labels
    pts.forEach((p,i)=>{
      ctx.beginPath();ctx.arc(p[0],p[1],4,0,Math.PI*2);
      ctx.fillStyle=sun;ctx.fill();
      ctx.beginPath();ctx.arc(p[0],p[1],2.5,0,Math.PI*2);
      ctx.fillStyle=bg2;ctx.fill();
      ctx.fillStyle=sun;ctx.font='700 9px Nunito,sans-serif';ctx.textAlign='center';
      ctx.fillText(data[i].weight,p[0],p[1]-8);
      ctx.fillStyle=hint;ctx.font='700 8px Nunito,sans-serif';
      ctx.fillText(fmtMD(data[i].logged_at),p[0],H-2);
    });
  });
}

/* ‚ïê‚ïê‚ïê‚ïê RENDER HOME ‚ïê‚ïê‚ïê‚ïê */
function renderHome(){
  const u=gU(),wl=gWL(),sl=gSL(),wd=gWD();
  T('h-name',u.name||'‚Äî');
  const now=new Date();
  const days=['–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ','–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–≤—Ç–æ—Ä–Ω–∏–∫','—Å—Ä–µ–¥–∞','—á–µ—Ç–≤–µ—Ä–≥','–ø—è—Ç–Ω–∏—Ü–∞','—Å—É–±–±–æ—Ç–∞'];
  const mons=['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è','–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];
  T('h-date',days[now.getDay()]+', '+now.getDate()+' '+mons[now.getMonth()]);
  const dsl=dts();T('h-days',dsl);T('h-dunit',pD(dsl));T('h-ddays',dsl);
  // water arc
  const wt=wd.total||0,wg=u.water_goal||2000,wp=Math.min(1,wt/wg);
  T('arc-wpct',Math.round(wp*100)+'%');T('arc-wml',wt);
  requestAnimationFrame(()=>{const a=$('arc-w');if(a)a.setAttribute('stroke-dashoffset',175.9*(1-wp));});
  // cal arc
  const ct=totalCal(),cg=u.cal_goal||2000,cp=Math.min(1,ct/cg);
  T('arc-cpct',Math.round(cp*100)+'%');T('arc-cval',ct);
  requestAnimationFrame(()=>{const a=$('arc-c');if(a)a.setAttribute('stroke-dashoffset',219.9*(1-cp));});
  // sleep arc
  if(sl.length){
    const last=sl[sl.length-1];
    const sqEl=$('arc-sq');
    if(sqEl)sqEl.innerHTML=Array.from({length:5},(_,i)=>`<div class="sqd${i<last.quality?' on':''}"></div>`).join('');
    const sp=Math.min(1,last.hours/9);
    requestAnimationFrame(()=>{const a=$('arc-s');if(a)a.setAttribute('stroke-dashoffset',175.9*(1-sp));});
    T('arc-sh',last.hours.toFixed(1));
  }
  // weight
  if(wl.length){
    const cw=wl[wl.length-1].weight,sw=u.start_weight||wl[0].weight||cw,gw=u.goal_weight;
    T('h-wcur',cw.toFixed(1));T('h-wgoal',gw?gw.toFixed(1):'‚Äî');
    const tot=Math.abs(sw-gw)||1,lost=sw-cw;
    const pct=gw?Math.min(100,Math.max(0,Math.round(lost/tot*100))):0;
    T('h-wpct',pct+'%');
    requestAnimationFrame(()=>{const b=$('h-wbar');if(b)b.style.width=pct+'%';});
  }
  // streak
  const streak=gStreak();
  const sw=$('h-streak-w');if(sw)sw.style.display=streak>=2?'':'none';
  T('h-sval',streak+' –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥');
  // plan preview
  const acts=gActs();
  const ps=$('h-plan-sec'),pl=$('h-plan-list');
  if(ps&&pl){
    if(!acts.length){ps.style.display='none';}
    else{
      ps.style.display='';
      const nt=new Date();
      pl.innerHTML=acts.map(a=>{
        const ico=ACT_ICO[a.type]||'‚ú®',col=ACT_COL[a.type]||'#FF9800',done=a.completed;
        const[hh,mm]=(a.time||'00:00').split(':').map(Number);
        const at=new Date();at.setHours(hh,mm,0,0);
        const et=new Date(at.getTime()+(a.duration||30)*60000);
        const ts=`${a.time}‚Äì${String(et.getHours()).padStart(2,'0')}:${String(et.getMinutes()).padStart(2,'0')}`;
        const late=!done&&nt>et;
        const badge=done?`<span class="pill p-ok">‚úì</span>`:late?`<span class="pill p-late">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>`:`<span class="pill p-soon">${a.time}</span>`;
        return`<div class="ac${done?' done':''}"><div class="ac-ico" style="background:${col}16">${done?'‚úÖ':ico}</div><div class="ac-body"><div class="ac-name">${a.name}</div><div class="ac-sub">${ts} ¬∑ ${a.duration} –º–∏–Ω</div></div>${badge}</div>`;
      }).join('');
    }
  }
}

/* ‚ïê‚ïê‚ïê‚ïê RENDER TRACK ‚ïê‚ïê‚ïê‚ïê */
function renderTrack(tab){
  if(tab==='water')renderWater();
  else if(tab==='cal')renderCal();
  else renderProds();
}
function renderWater(){
  const u=gU(),wd=gWD();
  const wt=wd.total||0,wg=u.water_goal||2000,wp=Math.min(100,Math.round(wt/wg*100));
  T('w-total',wt);T('w-goal',wg);
  requestAnimationFrame(()=>{const b=$('w-bar');if(b)b.style.width=wp+'%';});
  const st=gStreak();
  H('w-streak',st>=2?`<div style="display:inline-flex;align-items:center;gap:4px;background:rgba(255,107,53,.1);color:var(--sun);padding:4px 12px;border-radius:99px;font-size:11px;font-weight:800">üî• ${st} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>`:'');
  const entries=wd.entries||[];
  H('w-entries',entries.length?[...entries].reverse().slice(0,8).map((e,i)=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(0,0,0,.04)${i===0?';border-bottom:none':''}"><span style="font-size:12px;font-weight:700;color:var(--water)">+${e} –º–ª</span><span class="t5" style="font-size:11px">—Å—Ç–∞–∫–∞–Ω ${entries.length-i}</span></div>`).join(''):'<div style="text-align:center;padding:12px;color:var(--hint);font-size:12px;font-weight:600">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ</div>');
}
function renderCal(){
  const u=gU(),cd=gCD();
  const ct=totalCal(),cg=u.cal_goal||2000,cp=Math.min(100,Math.round(ct/cg*100));
  T('c-total',ct);T('c-goal',cg);
  requestAnimationFrame(()=>{const b=$('c-bar');if(b)b.style.width=cp+'%';});
  const MEALS=[{k:'breakfast',i:'üåÖ',n:'–ó–∞–≤—Ç—Ä–∞–∫',col:'#FF9800'},{k:'lunch',i:'‚òÄÔ∏è',n:'–û–±–µ–¥',col:'#FF6B35'},{k:'dinner',i:'üåô',n:'–£–∂–∏–Ω',col:'#8B7FD4'},{k:'snack',i:'üçë',n:'–ü–µ—Ä–µ–∫—É—Å',col:'#52C177'},{k:'other',i:'üåø',n:'–î—Ä—É–≥–æ–µ',col:'#607D8B'}];
  H('c-meals',MEALS.map(m=>`<div class="mr"><div class="mr-ico" style="background:${m.col}15;color:${m.col}">${m.i}</div><div style="flex:1"><div class="mr-name">${m.n}</div>${!cd[m.k]?`<div class="t5" style="font-size:10px">–Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ</div>`:''}</div><div class="mr-kcal" style="${cd[m.k]?'color:var(--cal)':'color:var(--hint)'}">${cd[m.k]||'‚Äî'} ${cd[m.k]?'–∫–∫–∞–ª':''}</div></div>`).join(''));
}
function renderProds(){
  H('prod-list',gProds().slice(0,10).map(p=>`<div class="pr"><div><div class="pr-name">${p.name}</div><div class="pr-meta">–ë${p.protein} ¬∑ –ñ${p.fat} ¬∑ –£${p.carbs}</div></div><div class="pr-kcal">${p.calories}</div></div>`).join(''));
}

/* ‚ïê‚ïê‚ïê‚ïê RENDER PLAN ‚ïê‚ïê‚ïê‚ïê */
function renderPlan(){
  const acts=gActs();
  const now=new Date();
  const mons=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];
  T('pl-date','—Å–µ–≥–æ–¥–Ω—è ¬∑ '+now.getDate()+' '+mons[now.getMonth()]);
  const done=acts.filter(a=>a.completed).length,total=acts.length;
  T('pl-cnt',total?`${done}/${total}`:'0/0');
  requestAnimationFrame(()=>{const r=$('pl-ring');if(r)r.setAttribute('stroke-dashoffset',125.7*(1-(total?done/total:0)));});
  const empty=$('pl-empty'),list=$('pl-list');
  if(!acts.length){if(empty)empty.style.display='';if(list){list.innerHTML='';list.style.display='none';}return;}
  if(empty)empty.style.display='none';if(list)list.style.display='';
  list.innerHTML=acts.map(a=>{
    const ico=ACT_ICO[a.type]||'‚ú®',col=ACT_COL[a.type]||'#FF9800';
    const st=actStatus(a);
    const pc={done:'p-ok',now:'p-now',soon:'p-soon',late:'p-late',later:'p-later'}[st.s]||'p-later';
    const pct=st.s==='now'?Math.round((st.p||0)*100):st.s==='done'?100:0;
    const bar=['done','now','soon'].includes(st.s);
    const en=a.name.replace(/'/g,"\\'");
    return`<div class="ac${a.completed?' done':''}">
      <div class="ac-ico" style="background:${col}16">${a.completed?'‚úÖ':ico}</div>
      <div class="ac-body">
        <div class="ac-name${a.completed?' done-text':''}">${a.name}</div>
        <div class="ac-sub">${fmtRange(a)} ¬∑ ${a.duration} –º–∏–Ω</div>
        <span class="pill ${pc}">${st.l}</span>
        ${bar?`<div class="ac-bar"><div class="ac-barf" style="width:${st.s==='soon'?80:pct}%;background:${st.s==='done'?'var(--green)':st.s==='now'?'var(--water)':'rgba(255,107,53,.35)'}"></div></div>`:''}
      </div>
      <div style="display:flex;flex-direction:column;gap:5px;flex-shrink:0">
        <button class="btn btn-g" style="padding:6px 10px;font-size:12px;border-radius:9px" onclick="completeAct(${a.id})">${a.completed?'‚Ü©':'‚úì'}</button>
      </div>
    </div>`;
  }).join('');
}
setInterval(()=>{if(curTab==='plan')renderPlan();},30000);

/* ‚ïê‚ïê‚ïê‚ïê RENDER SLEEP ‚ïê‚ïê‚ïê‚ïê */
function renderSleep(){
  const sl=gSL();
  if(sl.length){const last=sl[sl.length-1];T('sl-h',last.hours.toFixed(1));T('sl-qico',qIco(last.quality));H('sl-dots',Array.from({length:5},(_,i)=>`<div class="sqd${i<last.quality?' on':''}"></div>`).join(''));}
  else{T('sl-h','‚Äî');T('sl-qico','‚Äî');H('sl-dots','');}
  const l7=sl.slice(-7).reverse();
  H('sl-hist',l7.length?l7.map(e=>`<div class="hr"><div class="hr-d">${fmtD(e.logged_at)}</div><div style="display:flex;align-items:center;gap:7px;flex:1"><div class="hr-v">${e.hours.toFixed(1)} —á</div><div class="sq">${Array.from({length:5},(_,i)=>`<div class="sqd${i<e.quality?' on':''}"></div>`).join('')}</div></div><div style="font-size:16px">${qIco(e.quality)}</div></div>`).join(''):'<div style="text-align:center;padding:14px;color:var(--hint);font-size:12px;font-weight:600">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>');
  if(l7.length){
    const ah=+(l7.reduce((a,b)=>a+b.hours,0)/l7.length).toFixed(1);
    const aq=+(l7.reduce((a,b)=>a+(b.quality||3),0)/l7.length).toFixed(1);
    T('sl-avg-h',ah);T('sl-avg-q',qIco(Math.round(aq))+' '+aq);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê RENDER PROGRESS ‚ïê‚ïê‚ïê‚ïê */
function renderProgress(){
  const u=gU(),wl=gWL(),sl=gSL(),wd=gWD(),acts=gActs();
  if(wl.length){
    const cw=wl[wl.length-1].weight,sw=u.start_weight||wl[0].weight||cw,gw=u.goal_weight;
    T('pr-wcur',cw.toFixed(1));T('pr-wgoal',gw?gw.toFixed(1)+' –∫–≥':'‚Äî');
    T('pr-wgoal2',gw?gw.toFixed(1):'‚Äî');T('pr-wstart',sw.toFixed(1));
    const tot=Math.abs(sw-(gw||sw))||1,lost=sw-cw;
    const pct=gw?Math.min(100,Math.max(0,Math.round(lost/tot*100))):0;
    T('pr-wpct',pct+'%');T('pr-winfo',`–ø–æ—Ç–µ—Ä—è–Ω–æ ${Math.abs(lost).toFixed(1)} –∫–≥ ¬∑ –æ—Å—Ç–∞–ª–æ—Å—å ${Math.max(0,cw-(gw||cw)).toFixed(1)} –∫–≥`);
    requestAnimationFrame(()=>{const b=$('pr-wbar');if(b)b.style.width=pct+'%';});
    if(wl.length>=2&&gw&&cw>gw){try{
      const d1=new Date(wl[0].logged_at+'T00:00:00'),d2=new Date(wl[wl.length-1].logged_at+'T00:00:00');
      const dd=Math.max(1,(d2-d1)/86400000),rate=(wl[0].weight-wl[wl.length-1].weight)/dd*7;
      if(rate>.01){const dl=Math.ceil((cw-gw)/rate*7),eta=new Date();eta.setDate(eta.getDate()+dl);const mons=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];T('pr-forecast','–ü—Ä–æ–≥–Ω–æ–∑: '+eta.getDate()+' '+mons[eta.getMonth()]+' ¬∑ —Ç–µ–º–ø '+rate.toFixed(2)+' –∫–≥/–Ω–µ–¥');}
    }catch{}}
  }
  drawChart(wl.slice(-7));
  T('pw-water',wd.total||0);T('pw-cal',totalCal());
  if(sl.length)T('pw-sleep',+(sl.slice(-7).reduce((a,b)=>a+b.hours,0)/Math.min(7,sl.length)).toFixed(1));
  else T('pw-sleep','‚Äî');
  const l6=wl.slice(-6).reverse();
  H('pr-whist',l6.length?l6.map((e,i)=>{const prev=l6[i+1];const diff=prev?+(e.weight-prev.weight).toFixed(1):0;return`<div class="hr"><div class="hr-d">${fmtD(e.logged_at)}</div><div class="hr-v">${e.weight.toFixed(1)} –∫–≥</div>${diff?`<div class="hr-diff ${diff<0?'d-neg':'d-pos'}">${diff>0?'+':''}${diff}</div>`:'<div></div>'}</div>`;}).join(''):'<div style="text-align:center;padding:12px;color:var(--hint);font-size:12px;font-weight:600">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>');
  T('at-t',acts.filter(a=>a.completed).length);
  T('at-w',+((wd.total||0)/1000).toFixed(1));
  T('at-s',gStreak());
}

/* ‚ïê‚ïê‚ïê‚ïê RENDER PROFILE ‚ïê‚ïê‚ïê‚ïê */
function renderProfile(){
  const u=gU(),ss=gSS(),wl=gWL();
  const av=$('pf-av');if(av)av.textContent=(u.name||'?').charAt(0).toUpperCase();
  T('pf-name',u.name||'‚Äî');
  const meta=[];if(u.age)meta.push(u.age+' –ª–µ—Ç');if(u.height)meta.push(u.height+' —Å–º');if(u.gender)meta.push(u.gender==='male'?'‚ôÇ':'‚ôÄ');
  T('pf-meta',meta.join(' ¬∑ ')||'‚Äî');
  T('pf-gw',u.goal_weight?u.goal_weight+' –∫–≥':'‚Äî');
  T('pf-pname',u.name||'‚Äî');
  T('pf-height',u.height?u.height+' —Å–º':'‚Äî');
  T('pf-age',u.age?u.age+' –ª–µ—Ç':'‚Äî');
  T('pf-gwater',(u.water_goal||2000)+' –º–ª');
  const bmiRow=$('pf-bmi-row');
  if(u.height&&wl.length){
    const cw=wl[wl.length-1].weight,h2=u.height/100;
    const bmi=+(cw/h2/h2).toFixed(1);
    const ideal=+((u.height-100)*.9).toFixed(1);
    const bmr=Math.round(u.gender==='female'?10*cw+6.25*u.height-5*(u.age||25)-161:10*cw+6.25*u.height-5*(u.age||25)+5);
    if(bmiRow)bmiRow.style.display='';
    T('pf-bmi',bmi);T('pf-ideal',ideal);T('pf-bmr',bmr);
  }else if(bmiRow)bmiRow.style.display='none';
  ['w','water','cal','sleep'].forEach(k=>{
    const tog=$('tog-'+k),on=ss[k]!==false;
    if(tog){tog.classList.toggle('on',on);tog.classList.toggle('off',!on);}
  });
}

/* ‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('DOMContentLoaded',async()=>{
  const dark=tg?.colorScheme==='dark'||window.matchMedia?.('(prefers-color-scheme:dark)').matches;
  if(dark)document.body.classList.add('tg-dark');
  tg?.onEvent('themeChanged',()=>document.body.classList.toggle('tg-dark',tg?.colorScheme==='dark'));
  await loadData();
  renderHome();
  setTimeout(renderHome,150);
  setInterval(async()=>{if(curTab==='home'){await loadData();renderHome();}},30000);
});
</script>
</body>
</html>