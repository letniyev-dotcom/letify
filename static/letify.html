<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate">
<title>letify</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
:root{
  --bg:#FAF7F2;--bg2:#fff;--bg3:rgba(0,0,0,.05);--bg4:rgba(0,0,0,.04);
  --text:#1C1608;--hint:#A89F90;--brd:rgba(0,0,0,.07);
  --sun:#FF6B35;--sun2:#FFAB40;--water:#4EAEE5;--cal:#F4814A;
  --sleep:#8B7FD4;--green:#52C177;--red:#F45C5C;
  --r:14px;--r-lg:18px;
  --st:0px;--sb:0px;
  --sh:0 1px 8px rgba(0,0,0,.06),0 2px 4px rgba(0,0,0,.04);
  --page-bot:calc(76px + var(--sb) + 16px);
  --page-top:calc(var(--st) + 16px);
}
html,body{height:100%;overflow:hidden;font-family:'Onest',system-ui,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;overscroll-behavior:none;user-select:none}

#root{position:fixed;inset:0}
#pages{position:absolute;inset:0}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{
  position:absolute;inset:0;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  touch-action:pan-y;
  scrollbar-width:none;
  padding-top:var(--page-top);
  padding-bottom:var(--page-bot);
  opacity:0;pointer-events:none;
  transform:translateY(8px);
  transition:opacity .2s ease,transform .22s ease;
}
.page::-webkit-scrollbar{display:none}
.page.active{opacity:1;pointer-events:all;transform:none}

/* ‚îÄ‚îÄ PUSH SCREENS (slide from right) ‚îÄ‚îÄ */
.push-page{
  position:fixed;inset:0;z-index:60;
  background:var(--bg);
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
  padding-top:var(--page-top);
  padding-bottom:calc(var(--sb) + 100px);
  transform:translateX(100%);
  transition:transform .28s cubic-bezier(.4,0,.2,1);
  pointer-events:none;
}
.push-page::-webkit-scrollbar{display:none}
.push-page.open{transform:translateX(0);pointer-events:all}

/* ‚îÄ‚îÄ BOTTOM SHEETS ‚îÄ‚îÄ */
#scr-overlay{
  position:fixed;inset:0;z-index:69;
  background:rgba(0,0,0,.45);
  opacity:0;pointer-events:none;
  transition:opacity .2s ease;
}
#scr-overlay.show{opacity:1;pointer-events:all}

#slayer{position:fixed;inset:0;z-index:70;pointer-events:none}
.scr{
  position:absolute;bottom:0;left:0;right:0;
  max-height:88dvh;
  background:var(--bg);
  pointer-events:none;
  transform:translateY(100%);
  transition:transform .24s cubic-bezier(.32,.72,0,1);
  display:flex;flex-direction:column;
  border-radius:24px 24px 0 0;
  overflow:hidden;
}
.scr.open{transform:translateY(0);pointer-events:all}

.scr-handle{width:36px;height:4px;border-radius:99px;background:rgba(0,0,0,.1);margin:8px auto 0;flex-shrink:0}
.tg-dark .scr-handle{background:rgba(255,255,255,.18)}

.scr-hdr{
  flex-shrink:0;background:var(--bg);
  padding:8px 16px 10px;
  display:flex;align-items:center;gap:10px;
}
.scr-back{
  width:34px;height:34px;border-radius:10px;
  background:var(--bg3);display:flex;align-items:center;justify-content:center;
  cursor:pointer;border:none;color:var(--text);
  transition:transform .12s,background .12s;
}
.scr-back:active{transform:scale(.9)}
.scr-hdr-text{flex:1;min-width:0}
.scr-title{font-size:17px;font-weight:800;letter-spacing:-.02em;line-height:1.2}
.scr-subtitle{font-size:11px;font-weight:500;color:var(--hint);margin-top:1px}
.scr-body{overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding:4px 16px 8px;flex:1}
.scr-body::-webkit-scrollbar{display:none}
.scr-foot{flex-shrink:0;padding:8px 16px calc(max(var(--sb),env(safe-area-inset-bottom,0px))+12px);background:var(--bg)}

/* ‚îÄ‚îÄ PUSH PAGE HEADER ‚îÄ‚îÄ */
.pp-hdr{
  position:sticky;top:0;z-index:5;
  background:var(--bg);
  padding:calc(var(--page-top) - 8px) 16px 10px;
  display:flex;align-items:center;gap:10px;
  margin-top:calc(0px - var(--page-top) + 8px);
  border-bottom:1px solid var(--brd);
  margin-bottom:0;
}
.pp-title{font-size:17px;font-weight:800;letter-spacing:-.02em}

/* ‚îÄ‚îÄ MD3 –ü–û–õ–Ø ‚îÄ‚îÄ */
.m3-field{
  position:relative;margin-bottom:8px;
}
.m3-field:last-child{margin-bottom:0}
.m3-input{
  width:100%;min-height:52px;
  padding:18px 14px 6px;
  font-family:inherit;font-size:15px;font-weight:700;
  color:var(--text);background:var(--bg3);
  border:none;outline:none;border-radius:12px;
  -webkit-appearance:none;
  transition:background .15s,box-shadow .15s;
}
.m3-input:focus{background:rgba(255,107,53,.07);box-shadow:0 0 0 2px rgba(255,107,53,.3)}
.tg-dark .m3-input:focus{background:rgba(255,107,53,.14)}
.m3-label{
  position:absolute;top:7px;left:14px;
  font-size:10px;font-weight:700;color:var(--hint);
  letter-spacing:.05em;text-transform:uppercase;
  pointer-events:none;
}
.m3-input.num{text-align:right}
.m3-input::placeholder{color:var(--hint);font-size:14px;font-weight:500}

/* ‚îÄ‚îÄ MD3 CARD ‚îÄ‚îÄ */
.m3-card{
  background:var(--bg2);
  border-radius:16px;
  padding:12px;
  box-shadow:var(--sh);
  margin-bottom:10px;
}
.tg-dark .m3-card{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.09);box-shadow:none}

/* ‚îÄ‚îÄ MD3 SECTION LABEL ‚îÄ‚îÄ */
.m3-sec{
  font-size:11px;font-weight:700;
  letter-spacing:.06em;text-transform:uppercase;
  color:var(--hint);
  padding:12px 2px 6px;
}

/* ‚îÄ‚îÄ MD3 SEGMENT ‚îÄ‚îÄ */
.m3-seg{
  display:flex;gap:4px;background:var(--bg3);
  border-radius:12px;padding:3px;margin-bottom:10px;
}
.m3-seg-btn{
  flex:1;padding:9px 6px;
  font-size:12px;font-weight:700;
  border:none;border-radius:9px;cursor:pointer;
  font-family:inherit;background:transparent;color:var(--hint);
  transition:background .12s,color .12s,box-shadow .12s;
  white-space:nowrap;
}
.m3-seg-btn:active{transform:scale(.97)}
.m3-seg-btn.on{background:var(--bg2);color:var(--text);box-shadow:0 1px 5px rgba(0,0,0,.09)}
.tg-dark .m3-seg-btn.on{background:rgba(255,255,255,.16)}
.m3-seg-emoji .m3-seg-btn{font-size:22px;padding:7px 4px}

/* ‚îÄ‚îÄ ISLAND NAV ‚îÄ‚îÄ */
#nav{
  position:fixed;bottom:12px;
  left:0;right:0;margin:0 auto;
  width:fit-content;z-index:9999;
  display:flex;align-items:center;gap:3px;padding:5px;
  background:rgba(255,255,255,.94);
  border:1px solid rgba(255,255,255,.9);
  border-radius:24px;
  box-shadow:0 6px 24px rgba(0,0,0,.12),0 2px 6px rgba(0,0,0,.06);
  transition:bottom .28s ease,opacity .2s ease;
}
.tg-dark #nav{background:rgba(24,18,10,.95);border-color:rgba(255,255,255,.1)}
#nav.gone{bottom:calc(-100px - var(--sb));opacity:0;pointer-events:none}
.nt{
  width:50px;height:50px;border-radius:16px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;
  cursor:pointer;color:var(--hint);
  transition:color .16s,background .16s,transform .14s cubic-bezier(.34,1.4,.64,1);
}
.nt.on{color:var(--sun);background:rgba(255,107,53,.1)}
.nt:active{transform:scale(.87)}
.nt svg{width:22px;height:22px;flex-shrink:0}
.nt-dot{width:4px;height:4px;border-radius:50%;background:var(--sun);opacity:0;transition:opacity .16s}
.nt.on .nt-dot{opacity:1}

/* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
.t1{font-size:26px;font-weight:900;line-height:1.1;letter-spacing:-.02em}
.t2{font-size:20px;font-weight:900;letter-spacing:-.02em}
.t3{font-size:14px;font-weight:800}
.t5{font-size:12px;font-weight:600;color:var(--hint)}
.grad{background:linear-gradient(105deg,var(--sun),var(--sun2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--bg2);border-radius:var(--r-lg);padding:16px;box-shadow:var(--sh);position:relative;overflow:hidden}
.tg-dark .card{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.09);box-shadow:none}
.pad{padding:0 16px}
.gap{margin-top:10px}
.sec{font-size:11px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--hint);padding:14px 20px 6px}

/* ‚îÄ‚îÄ LIST TILE ‚îÄ‚îÄ */
.lt{display:flex;align-items:center;gap:12px;padding:11px 0;border-bottom:1px solid var(--brd);cursor:pointer;transition:opacity .12s}
.lt:last-child{border-bottom:none;padding-bottom:0}
.lt:first-child{padding-top:0}
.lt:active{opacity:.55}
.lt-ic{width:32px;height:32px;border-radius:10px;background:var(--bg3);display:flex;align-items:center;justify-content:center;color:var(--hint);flex-shrink:0}
.lt-lbl{flex:1;font-size:14px;font-weight:700}
.lt-val{font-size:12px;color:var(--hint);font-weight:600;flex-shrink:0}
.lt-chev{color:var(--hint);opacity:.4;flex-shrink:0}
.tg-dark .lt{border-bottom-color:rgba(255,255,255,.08)}

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.pb{height:6px;background:rgba(0,0,0,.06);border-radius:99px;overflow:hidden;margin-top:10px}
.pbf{height:100%;border-radius:99px;transition:width .8s cubic-bezier(.34,1.1,.64,1)}
.pb-sun{background:linear-gradient(90deg,var(--sun),var(--sun2))}
.pb-water{background:var(--water)}
.pb-sleep{background:var(--sleep)}
.tg-dark .pb{background:rgba(255,255,255,.1)}

/* ‚îÄ‚îÄ ARC ‚îÄ‚îÄ */
.aw{position:relative;display:inline-flex;align-items:center;justify-content:center}
.ai{position:absolute;text-align:center;pointer-events:none}

/* ‚îÄ‚îÄ STAT BOX ‚îÄ‚îÄ */
.sb-row{display:flex;gap:8px}
.sbox{flex:1;background:var(--bg2);border-radius:var(--r);padding:12px;box-shadow:var(--sh);text-align:center}
.tg-dark .sbox{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.09);box-shadow:none}
.sv{font-size:19px;font-weight:900;margin-bottom:2px}
.sl{font-size:10px;font-weight:700;color:var(--hint);text-transform:uppercase;letter-spacing:.06em}

/* ‚îÄ‚îÄ BANNER ‚îÄ‚îÄ */
.banner{background:linear-gradient(130deg,#FF6B35,#FFAB40);border-radius:var(--r-lg);padding:16px;color:#fff;position:relative;overflow:hidden}
.banner::after{content:'';position:absolute;right:-10px;top:-10px;width:80px;height:80px;border-radius:50%;background:rgba(255,255,255,.1);pointer-events:none}

/* ‚îÄ‚îÄ ACT CARD ‚îÄ‚îÄ */
.ac{background:var(--bg2);border-radius:var(--r);padding:12px;display:flex;align-items:flex-start;gap:10px;box-shadow:var(--sh);margin-bottom:8px;transition:opacity .16s}
.tg-dark .ac{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.08);box-shadow:none}
.ac.done{opacity:.42}
.ac-ico{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.ac-body{flex:1;min-width:0}
.ac-name{font-size:14px;font-weight:800;margin-bottom:2px}
.ac-name.done-text{text-decoration:line-through;opacity:.6}
.ac-sub{font-size:11px;color:var(--hint);font-weight:600}
.pill{display:inline-flex;align-items:center;padding:3px 9px;border-radius:99px;font-size:10px;font-weight:800;white-space:nowrap;margin-top:5px}
.p-ok{background:rgba(82,193,119,.12);color:var(--green)}
.p-late{background:rgba(244,92,92,.1);color:var(--red)}
.p-soon{background:rgba(255,107,53,.1);color:var(--sun)}
.p-now{background:rgba(78,174,229,.12);color:var(--water)}
.p-later{background:rgba(0,0,0,.05);color:var(--hint)}
.ac-bar{margin-top:7px;height:4px;background:rgba(0,0,0,.06);border-radius:99px;overflow:hidden}
.ac-barf{height:100%;border-radius:99px;transition:width .4s ease}

/* ‚îÄ‚îÄ SLEEP DOTS ‚îÄ‚îÄ */
.sq{display:flex;gap:3px}
.sqd{width:14px;height:4px;border-radius:99px;background:rgba(0,0,0,.07);transition:background .3s}
.sqd.on{background:var(--sleep)}
.tg-dark .sqd{background:rgba(255,255,255,.14)}

/* ‚îÄ‚îÄ HISTORY ROW ‚îÄ‚îÄ */
.hr{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--brd);gap:10px}
.hr:last-child{border-bottom:none;padding-bottom:0}
.hr:first-child{padding-top:0}
.hr-d{font-size:11px;color:var(--hint);font-weight:700;min-width:46px}
.hr-v{font-size:15px;font-weight:900;flex:1}
.hr-diff{font-size:11px;font-weight:800}
.d-neg{color:var(--green)}.d-pos{color:var(--red)}
.tg-dark .hr{border-bottom-color:rgba(255,255,255,.08)}

/* ‚îÄ‚îÄ MEAL ROW ‚îÄ‚îÄ */
.mr{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--brd)}
.mr:last-child{border-bottom:none;padding-bottom:0}
.mr:first-child{padding-top:0}
.mr-ico{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.mr-name{font-size:13px;font-weight:800}
.mr-kcal{font-size:13px;font-weight:900;flex-shrink:0}
.tg-dark .mr{border-bottom-color:rgba(255,255,255,.08)}

/* ‚îÄ‚îÄ BTNS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;border:none;cursor:pointer;font-family:inherit;font-weight:800;transition:transform .1s ease,opacity .12s}
.btn:active{transform:scale(.96);opacity:.85}
.btn-p{background:linear-gradient(135deg,var(--sun),var(--sun2));color:#fff;padding:14px 20px;font-size:15px;border-radius:14px;box-shadow:0 4px 16px rgba(255,107,53,.28);width:100%;letter-spacing:.01em}
.btn-g{background:var(--bg3);color:var(--text);padding:11px 16px;font-size:13px;border-radius:11px}
.btn-water{background:rgba(78,174,229,.1);color:var(--water);padding:13px 8px;font-size:13px;border-radius:12px;flex:1;font-weight:800}
.tg-dark .btn-g{background:rgba(255,255,255,.1);color:#fff}
.tg-dark .btn-water{background:rgba(78,174,229,.18);color:#7ecef5}

/* ‚îÄ‚îÄ TOGGLE ‚îÄ‚îÄ */
.tog{width:46px;height:26px;border-radius:99px;position:relative;cursor:pointer;flex-shrink:0;transition:background .2s}
.tog::after{content:'';position:absolute;width:20px;height:20px;border-radius:50%;background:#fff;top:3px;transition:left .22s cubic-bezier(.34,1.5,.64,1);box-shadow:0 1px 5px rgba(0,0,0,.16)}
.tog.on{background:var(--sun)}.tog.off{background:rgba(0,0,0,.16)}
.tog.on::after{left:23px}.tog.off::after{left:3px}
.tg-dark .tog.off{background:rgba(255,255,255,.22)}

/* ‚îÄ‚îÄ TRACK TABS ‚îÄ‚îÄ */
.ttabs{display:flex;gap:3px;background:rgba(0,0,0,.05);border-radius:12px;padding:3px}
.ttab{flex:1;padding:8px 4px;font-size:12px;font-weight:800;border:none;border-radius:9px;cursor:pointer;font-family:inherit;background:transparent;color:var(--hint);transition:background .14s,color .14s,box-shadow .14s}
.ttab.on{background:var(--bg2);color:var(--text);box-shadow:0 1px 5px rgba(0,0,0,.08)}
.tg-dark .ttabs{background:rgba(255,255,255,.08)}
.tg-dark .ttab.on{background:rgba(255,255,255,.16);color:#fff}
.tg-dark .ttab{color:rgba(255,255,255,.4)}

/* ‚îÄ‚îÄ AVATAR ‚îÄ‚îÄ */
.pav{width:64px;height:64px;border-radius:20px;background:linear-gradient(135deg,var(--sun),var(--sun2));display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:900;color:#fff;box-shadow:0 5px 18px rgba(255,107,53,.25);flex-shrink:0}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast{
  position:fixed;bottom:calc(86px + var(--sb) + 12px);left:50%;
  transform:translateX(-50%) translateY(8px);
  background:rgba(28,22,14,.88);color:#fff;
  padding:9px 18px;border-radius:99px;font-size:13px;font-weight:800;
  white-space:nowrap;z-index:200;opacity:0;pointer-events:none;
  transition:opacity .18s,transform .18s cubic-bezier(.34,1.2,.64,1);
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* ‚îÄ‚îÄ WHEEL PICKER ‚îÄ‚îÄ */
.wp{position:relative;overflow:hidden;border-radius:12px;background:var(--bg3);cursor:grab;touch-action:none}
.wp:active{cursor:grabbing}
.wp-track{position:absolute;top:0;left:0;right:0;will-change:transform}
.wp-item{height:40px;display:flex;align-items:center;justify-content:center;font-size:17px;font-weight:700;color:var(--hint);pointer-events:none;user-select:none;transition:color .08s}
.wp-item.sel{color:var(--text);font-size:22px;font-weight:800}
.wp-sel{position:absolute;top:50%;left:5px;right:5px;height:40px;transform:translateY(-50%);background:rgba(255,107,53,.08);border-radius:8px;border:1.5px solid rgba(255,107,53,.2);pointer-events:none}
.wp-ft{position:absolute;left:0;right:0;height:80px;pointer-events:none;z-index:2}
.wp-ft-t{top:0;background:linear-gradient(to bottom,var(--bg3) 0%,transparent 100%)}
.wp-ft-b{bottom:0;background:linear-gradient(to top,var(--bg3) 0%,transparent 100%)}
.wp-row{display:flex;justify-content:center;gap:6px;padding:0 2px 6px;align-items:flex-start}
.wp-col{display:flex;flex-direction:column;align-items:stretch;gap:3px;flex:1;min-width:0}
.wp-lbl{font-size:9px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:var(--hint);text-align:center;margin-bottom:2px}
.wp-sep{font-size:20px;font-weight:800;color:var(--hint);line-height:40px;align-self:center;padding-top:18px;flex:none}
.tg-dark .wp-ft-t{background:linear-gradient(to bottom,var(--bg3) 0%,transparent 100%)}
.tg-dark .wp-ft-b{background:linear-gradient(to top,var(--bg3) 0%,transparent 100%)}
.tg-dark .wp-item{color:rgba(255,255,255,.3)}
.tg-dark .wp-item.sel{color:#fff}
.tg-dark .wp-sel{background:rgba(255,107,53,.15);border-color:rgba(255,107,53,.3)}

/* ‚îÄ‚îÄ TYPE GRID (activity) ‚îÄ‚îÄ */
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:4px}
.type-card{
  padding:14px 10px;border-radius:14px;border:2px solid transparent;
  background:var(--bg3);cursor:pointer;text-align:center;
  transition:all .14s ease;
}
.type-card:active{transform:scale(.97)}
.type-card.on{background:rgba(255,107,53,.08);border-color:var(--sun)}
.type-card-ico{font-size:28px;margin-bottom:4px;line-height:1}
.type-card-lbl{font-size:12px;font-weight:700;color:var(--text)}
.tg-dark .type-card{background:rgba(255,255,255,.07)}
.tg-dark .type-card.on{background:rgba(255,107,53,.16)}

/* ‚îÄ‚îÄ DURATION GRID ‚îÄ‚îÄ */
.dur-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:4px}
.dur-btn{
  padding:10px 6px;border-radius:10px;border:2px solid transparent;
  background:var(--bg3);cursor:pointer;text-align:center;
  font-size:12px;font-weight:800;color:var(--hint);
  font-family:inherit;
  transition:all .12s ease;
}
.dur-btn:active{transform:scale(.95)}
.dur-btn.on{background:rgba(255,107,53,.08);border-color:var(--sun);color:var(--sun)}
.tg-dark .dur-btn{background:rgba(255,255,255,.07)}
.tg-dark .dur-btn.on{background:rgba(255,107,53,.18)}

/* ‚îÄ‚îÄ TIME INPUT ‚îÄ‚îÄ */
.time-input-wrap{
  background:var(--bg3);border-radius:12px;
  padding:14px 16px;
  display:flex;align-items:center;justify-content:center;
}
.time-input{
  font-family:'Onest',sans-serif;
  font-size:32px;font-weight:900;letter-spacing:-.02em;
  color:var(--text);
  background:transparent;border:none;outline:none;
  -webkit-appearance:none;
  text-align:center;
  width:100%;
  cursor:pointer;
}
.time-input::-webkit-calendar-picker-indicator{opacity:0;position:absolute}

/* ‚îÄ‚îÄ STEP INDICATOR (activity) ‚îÄ‚îÄ */
.step-ind{display:flex;align-items:center;gap:6px;margin-bottom:20px}
.step-pip{width:8px;height:8px;border-radius:50%;background:var(--bg3);transition:all .25s ease}
.step-pip.on{width:22px;border-radius:4px;background:var(--sun)}
.step-pip.done{background:var(--green);width:8px;border-radius:50%}

/* ‚îÄ‚îÄ ACTIVITY STEPS ‚îÄ‚îÄ */
.act-step{display:none}
.act-step.active{display:block}
.act-q{font-size:19px;font-weight:800;line-height:1.2;margin-bottom:4px;letter-spacing:-.02em}
.act-hint{font-size:12px;color:var(--hint);font-weight:500;margin-bottom:16px}

/* ‚îÄ‚îÄ TOGGLE ROW ‚îÄ‚îÄ */
.m3-tog-row{
  display:flex;align-items:center;gap:12px;
  padding:13px 14px;background:var(--bg2);
  border-radius:14px;margin-bottom:6px;cursor:pointer;
  transition:opacity .12s;
}
.m3-tog-row:active{opacity:.7}
.m3-tog-ic{font-size:20px;flex-shrink:0;width:26px;text-align:center}
.m3-tog-lbl{flex:1;font-size:14px;font-weight:700}
.tg-dark .m3-tog-row{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.08)}

/* ‚îÄ‚îÄ CHART SCROLL ‚îÄ‚îÄ */
.chart-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;margin:0 -4px;padding:0 4px}
.chart-scroll::-webkit-scrollbar{display:none}

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty{text-align:center;padding:40px 20px}
.empty svg{opacity:.22;margin-bottom:12px}
.empty-t{font-size:15px;font-weight:800;margin-bottom:5px}
.empty-s{font-size:12px;color:var(--hint);font-weight:600}

/* ‚îÄ‚îÄ DARK OVERRIDES ‚îÄ‚îÄ */
.tg-dark{
  --bg3:rgba(255,255,255,.07);
  --bg4:rgba(255,255,255,.05);
  --brd:rgba(255,255,255,.09);
  --sh:0 2px 12px rgba(0,0,0,.4);
}
.tg-dark .push-page{background:var(--bg)}
.tg-dark .scr{background:var(--bg)}
.tg-dark .scr-hdr,.tg-dark .scr-foot{background:var(--bg)}
.tg-dark .pb{background:rgba(255,255,255,.1)}
.tg-dark .wp{background:rgba(255,255,255,.08)}
.tg-dark .sec{color:rgba(255,255,255,.35)}
.tg-dark .t5{color:rgba(255,255,255,.4)}
.tg-dark #nav{background:rgba(20,14,8,.96);border-color:rgba(255,255,255,.1)}
.tg-dark .empty svg{opacity:.15}
.tg-dark .lt-ic{background:rgba(255,255,255,.08)}
.tg-dark .time-input{color:#fff}
.tg-dark .ac-bar{background:rgba(255,255,255,.1)}
.tg-dark .pp-hdr{background:var(--bg);border-bottom-color:rgba(255,255,255,.08)}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.page.active .card,.page.active .sbox,.page.active .banner,.page.active .ac{animation:fadeUp .22s ease both}
@keyframes stepIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:none}}
.act-step.active{animation:stepIn .2s ease both}
</style>
</head>
<body>
<div id="root">
<div id="pages">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="p-home">
<div class="pad" style="display:flex;align-items:flex-start;justify-content:space-between;padding-top:2px">
  <div>
    <div class="t1">–ø—Ä–∏–≤–µ—Ç, <span class="grad" id="h-name">‚Ä¶</span></div>
    <div class="t5" style="margin-top:3px" id="h-date">–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è‚Ä¶</div>
  </div>
  <div style="text-align:right;padding-top:3px">
    <div class="t5">–¥–æ –ª–µ—Ç–∞</div>
    <div style="font-size:22px;font-weight:900;color:var(--sun);line-height:1.1" id="h-days">‚Äî</div>
    <div class="t5" id="h-dunit">–¥–Ω–µ–π</div>
  </div>
</div>

<div class="pad gap">
  <div class="banner">
    <div style="font-size:13px;font-weight:800;opacity:.88;margin-bottom:2px">–ø—É—Ç—å –∫ –ª–µ—Ç—É</div>
    <div style="font-size:28px;font-weight:900;line-height:1.1"><span id="h-ddays">‚Äî</span> –¥–Ω–µ–π</div>
    <div style="font-size:11px;opacity:.72;font-weight:600;margin-top:3px">—Ç—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</div>
  </div>
</div>

<div class="pad gap">
<div class="card" style="padding:16px 6px 12px">
  <div style="display:flex;justify-content:space-around;align-items:center">
    <div style="text-align:center;cursor:pointer" onclick="navTo('track')">
      <div class="aw">
        <svg width="68" height="68" viewBox="0 0 68 68">
          <circle cx="34" cy="34" r="26" fill="none" stroke="rgba(78,174,229,.15)" stroke-width="5"/>
          <circle cx="34" cy="34" r="26" fill="none" stroke="var(--water)" stroke-width="5"
            stroke-linecap="round" stroke-dasharray="163.4" id="arc-w" stroke-dashoffset="163.4"
            transform="rotate(-90 34 34)" style="transition:stroke-dashoffset .9s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="ai"><div style="font-size:13px;font-weight:900;color:var(--water)" id="arc-wpct">0%</div></div>
      </div>
      <div style="font-size:11px;font-weight:900;margin-top:4px" id="arc-wml">0</div>
      <div class="t5" style="font-size:10px">–º–ª</div>
    </div>
    <div style="text-align:center;cursor:pointer" onclick="navTo('track')">
      <div class="aw">
        <svg width="82" height="82" viewBox="0 0 82 82">
          <circle cx="41" cy="41" r="33" fill="none" stroke="rgba(244,129,74,.15)" stroke-width="6"/>
          <circle cx="41" cy="41" r="33" fill="none" stroke="var(--cal)" stroke-width="6"
            stroke-linecap="round" stroke-dasharray="207.3" id="arc-c" stroke-dashoffset="207.3"
            transform="rotate(-90 41 41)" style="transition:stroke-dashoffset .9s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="ai"><div style="font-size:15px;font-weight:900;color:var(--cal)" id="arc-cpct">0%</div></div>
      </div>
      <div style="font-size:13px;font-weight:900;margin-top:4px" id="arc-cval">0</div>
      <div class="t5" style="font-size:10px">–∫–∫–∞–ª</div>
    </div>
    <div style="text-align:center;cursor:pointer" onclick="navTo('sleep')">
      <div class="aw">
        <svg width="68" height="68" viewBox="0 0 68 68">
          <circle cx="34" cy="34" r="26" fill="none" stroke="rgba(139,127,212,.15)" stroke-width="5"/>
          <circle cx="34" cy="34" r="26" fill="none" stroke="var(--sleep)" stroke-width="5"
            stroke-linecap="round" stroke-dasharray="163.4" id="arc-s" stroke-dashoffset="163.4"
            transform="rotate(-90 34 34)" style="transition:stroke-dashoffset .9s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="ai"><div style="font-size:13px;font-weight:900;color:var(--sleep)" id="arc-sh">‚Äî</div></div>
      </div>
      <div class="sq" id="arc-sq" style="justify-content:center;margin-top:4px"></div>
      <div class="t5" style="font-size:10px;margin-top:2px">—á–∞—Å–æ–≤</div>
    </div>
  </div>
</div>
</div>

<div class="pad gap">
<div class="card" style="cursor:pointer" onclick="navTo('progress')">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <div class="t5" style="margin-bottom:3px">–≤–µ—Å</div>
      <div style="display:flex;align-items:baseline;gap:5px">
        <span style="font-size:26px;font-weight:900;letter-spacing:-.02em" id="h-wcur">‚Äî</span>
        <span class="t5">‚Üí <b style="color:var(--text)" id="h-wgoal">‚Äî</b> –∫–≥</span>
      </div>
    </div>
    <div style="text-align:right">
      <div style="font-size:24px;font-weight:900;color:var(--sun)" id="h-wpct">‚Äî</div>
      <div class="t5">–∫ —Ü–µ–ª–∏</div>
    </div>
  </div>
  <div class="pb gap"><div class="pbf pb-sun" id="h-wbar" style="width:0%"></div></div>
</div>
</div>

<div id="h-plan-sec" style="display:none">
  <div class="sec">—Å–µ–≥–æ–¥–Ω—è</div>
  <div class="pad" id="h-plan-list"></div>
</div>

<div class="pad" id="h-streak-w" style="margin-top:10px;display:none">
  <div style="background:linear-gradient(90deg,rgba(255,107,53,.07),rgba(255,171,64,.05));border-radius:var(--r);padding:12px 14px;display:flex;align-items:center;gap:10px">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="var(--sun)"><path d="M12 2c0 5.5-5 7-5 11a5 5 0 0 0 10 0c0-4-5-5.5-5-11z"/></svg>
    <div>
      <div style="font-size:13px;font-weight:900" id="h-sval">7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
      <div class="t5">—Å–µ—Ä–∏—è –≤–æ–¥—ã</div>
    </div>
  </div>
</div>
<div style="height:8px"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TRACK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-track">
<div style="position:sticky;top:0;background:var(--bg);z-index:10;padding:calc(var(--st)+12px) 16px 10px">
  <div class="ttabs">
    <button class="ttab on" id="tt-water" onclick="setTTab('water')">–≤–æ–¥–∞</button>
    <button class="ttab" id="tt-cal" onclick="setTTab('cal')">–∫–∞–ª–æ—Ä–∏–∏</button>
  </div>
</div>

<div id="tt-water-body">
<div class="pad">
<div class="card" style="margin-top:4px;text-align:center;padding:20px 16px;background:linear-gradient(160deg,rgba(78,174,229,.06),rgba(78,174,229,.02))">
  <div class="t5">–≤—ã–ø–∏—Ç–æ —Å–µ–≥–æ–¥–Ω—è</div>
  <div style="font-size:52px;font-weight:900;color:var(--water);line-height:1.1;margin:6px 0" id="w-total">0</div>
  <div class="t5">–∏–∑ <span id="w-goal">2000</span> –º–ª</div>
  <div class="pb" style="margin-top:12px;height:7px"><div class="pbf pb-water" id="w-bar" style="width:0%"></div></div>
  <div id="w-streak" style="margin-top:9px"></div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:10px">
  <button class="btn btn-water" onclick="addW(150)">+150 –º–ª</button>
  <button class="btn btn-water" onclick="addW(200)">+200 –º–ª</button>
  <button class="btn btn-water" onclick="addW(250)">+250 –º–ª</button>
  <button class="btn btn-water" onclick="addW(500)">+500 –º–ª</button>
</div>
<button class="btn btn-g" style="margin-top:7px;width:100%;padding:12px" onclick="undoW()">–æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ</button>
<div style="margin-top:12px">
  <div class="t5" style="margin-bottom:6px;font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.08em">–∏—Å—Ç–æ—Ä–∏—è —Å–µ–≥–æ–¥–Ω—è</div>
  <div class="card" id="w-entries" style="padding:10px 12px"></div>
</div>
</div>
</div>

<div id="tt-cal-body" style="display:none">
<div class="pad">
<div class="card" style="margin-top:4px;text-align:center;padding:20px 16px">
  <div class="t5">–∫–∞–ª–æ—Ä–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
  <div style="font-size:48px;font-weight:900;color:var(--cal);line-height:1.1;margin:6px 0" id="c-total">0</div>
  <div class="t5">–∏–∑ <span id="c-goal">2000</span> –∫–∫–∞–ª</div>
  <div class="pb" style="margin-top:12px;height:7px"><div class="pbf pb-sun" id="c-bar" style="width:0%"></div></div>
</div>
<div class="card gap" style="padding:12px 14px"><div id="c-meals"></div></div>
<button class="btn btn-p gap" onclick="openScr('scr-cal')">–¥–æ–±–∞–≤–∏—Ç—å –µ–¥—É</button>
</div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLAN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-plan">
<div class="pad">
  <div class="t2" style="margin-bottom:1px">–ø–ª–∞–Ω</div>
  <div class="t5" id="pl-date">—Å–µ–≥–æ–¥–Ω—è</div>
</div>
<div class="pad gap">
<div class="card">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <div style="font-size:34px;font-weight:900;line-height:1" id="pl-cnt">0/0</div>
      <div class="t5" style="margin-top:2px">–∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
    </div>
    <svg width="52" height="52" viewBox="0 0 52 52">
      <circle cx="26" cy="26" r="20" fill="none" stroke="rgba(0,0,0,.06)" stroke-width="4.5"/>
      <circle cx="26" cy="26" r="20" fill="none" stroke="var(--sun)" stroke-width="4.5"
        stroke-linecap="round" stroke-dasharray="125.7"
        id="pl-ring" stroke-dashoffset="125.7"
        transform="rotate(-90 26 26)"
        style="transition:stroke-dashoffset .6s cubic-bezier(.34,1.1,.64,1)"/>
    </svg>
  </div>
</div>
</div>
<div id="pl-empty" class="empty" style="display:none">
  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="3"/><path d="M8 2v4M16 2v4M3 10h18M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01"/></svg>
  <div class="empty-t">–Ω–µ—Ç –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
  <div class="empty-s">–Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
</div>
<div class="pad" id="pl-list" style="margin-top:4px"></div>
<div class="pad gap">
  <button class="btn btn-p" onclick="pushPage('pp-act')">–¥–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
</div>
<div style="height:8px"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SLEEP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-sleep">
<div class="pad">
  <div class="t2" style="margin-bottom:1px">—Å–æ–Ω</div>
  <div class="t5">—Ö–æ—Ä–æ—à–∏–π —Å–æ–Ω ‚Äî –æ—Å–Ω–æ–≤–∞ –≤—Å–µ–≥–æ</div>
</div>
<div class="pad gap">
<div class="card">
  <div class="t5" style="margin-bottom:7px">–ø—Ä–æ—à–ª–∞—è –Ω–æ—á—å</div>
  <div style="display:flex;align-items:center;gap:16px">
    <div>
      <div style="font-size:48px;font-weight:900;line-height:1;color:var(--sleep)" id="sl-h">‚Äî</div>
      <div class="t5" style="margin-top:2px">—á–∞—Å–æ–≤</div>
    </div>
    <div>
      <div style="font-size:34px" id="sl-qico">‚Äî</div>
      <div class="sq" id="sl-dots" style="margin-top:4px"></div>
    </div>
  </div>
</div>
</div>
<button class="btn btn-p" style="margin:10px 16px 0;width:calc(100% - 32px)" onclick="openScr('scr-sleep')">–∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–Ω</button>
<div class="sec">–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –Ω–æ—á–µ–π</div>
<div class="pad"><div class="card" id="sl-hist" style="padding:10px 12px"></div></div>
<div class="sec">—Å—Ä–µ–¥–Ω–µ–µ –∑–∞ –Ω–µ–¥–µ–ª—é</div>
<div class="pad sb-row">
  <div class="sbox"><div class="sv" id="sl-avg-h" style="color:var(--sleep)">‚Äî</div><div class="sl">—á–∞—Å–æ–≤</div></div>
  <div class="sbox"><div class="sv" id="sl-avg-q">‚Äî</div><div class="sl">–∫–∞—á–µ—Å—Ç–≤–æ</div></div>
</div>
<div style="height:8px"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-progress">
<div class="pad">
  <div class="t2" style="margin-bottom:1px">–ø—Ä–æ–≥—Ä–µ—Å—Å</div>
  <div class="t5">—Ç–≤–æ–π –ø—É—Ç—å –∫ –ª–µ—Ç—É</div>
</div>
<div class="pad gap">
<div class="card">
  <div class="t5" style="margin-bottom:5px">–ø—Ä–æ–≥—Ä–µ—Å—Å –≤–µ—Å–∞</div>
  <div style="display:flex;align-items:flex-end;gap:7px;margin-bottom:3px">
    <span style="font-size:38px;font-weight:900;line-height:1" id="pr-wcur">‚Äî</span>
    <span class="t5" style="padding-bottom:4px">–∫–≥ ¬∑ —Ü–µ–ª—å <b style="color:var(--text)" id="pr-wgoal">‚Äî</b></span>
  </div>
  <div class="t5" id="pr-winfo" style="margin-bottom:8px"></div>
  <div class="pb" style="height:8px"><div class="pbf pb-sun" id="pr-wbar" style="width:0%;height:100%"></div></div>
  <div style="display:flex;justify-content:space-between;margin-top:4px">
    <span class="t5" id="pr-wstart">‚Äî</span>
    <span style="font-size:11px;font-weight:900;color:var(--sun)" id="pr-wpct">0%</span>
    <span class="t5" id="pr-wgoal2">‚Äî</span>
  </div>
  <div id="pr-forecast" style="margin-top:7px;font-size:11px;font-weight:800;color:var(--green)"></div>
</div>
</div>

<div class="pad gap">
<div class="card" style="padding:14px">
  <div class="t5" style="margin-bottom:8px">–¥–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞</div>
  <div class="chart-scroll">
    <canvas id="wchart" height="90" style="display:block"></canvas>
  </div>
</div>
</div>

<div class="sec">—ç—Ç–∞ –Ω–µ–¥–µ–ª—è</div>
<div class="pad sb-row">
  <div class="sbox"><div class="sv" style="color:var(--water)" id="pw-water">‚Äî</div><div class="sl">–≤–æ–¥–∞ –º–ª</div></div>
  <div class="sbox"><div class="sv" style="color:var(--cal)" id="pw-cal">‚Äî</div><div class="sl">–∫–∫–∞–ª</div></div>
  <div class="sbox"><div class="sv" style="color:var(--sleep)" id="pw-sleep">‚Äî</div><div class="sl">—Å–æ–Ω —á</div></div>
</div>

<button class="btn btn-p" style="margin:10px 16px 0;width:calc(100% - 32px)" onclick="openScr('scr-weight')">–∑–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å</button>

<div class="sec">–∏—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞</div>
<div class="pad"><div class="card" id="pr-whist" style="padding:10px 12px"></div></div>

<div class="sec">–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è</div>
<div class="pad sb-row">
  <div class="sbox"><div class="sv grad" id="at-t">0</div><div class="sl">—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div></div>
  <div class="sbox"><div class="sv grad" id="at-w">0</div><div class="sl">–≤–æ–¥—ã –ª</div></div>
  <div class="sbox"><div class="sv grad" id="at-s">0</div><div class="sl">—Å–µ—Ä–∏—è –¥–Ω</div></div>
</div>
<div style="height:8px"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="p-profile">
<div style="display:flex;align-items:center;gap:14px;padding:4px 16px 0">
  <div class="pav" id="pf-av">–ê</div>
  <div>
    <div class="t2" id="pf-name">‚Äî</div>
    <div class="t5" id="pf-meta" style="margin-top:2px">‚Äî</div>
  </div>
</div>

<div id="pf-bmi-row" style="margin-top:12px;padding:0 16px;display:none">
  <div class="sb-row">
    <div class="sbox"><div class="sv" id="pf-bmi">‚Äî</div><div class="sl">–ò–ú–¢</div></div>
    <div class="sbox"><div class="sv" id="pf-ideal">‚Äî</div><div class="sl">–∏–¥–µ–∞–ª –∫–≥</div></div>
    <div class="sbox"><div class="sv" id="pf-bmr">‚Äî</div><div class="sl">BMR</div></div>
  </div>
</div>

<div class="sec">–Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
<div class="pad">
<div class="card">
  <div class="lt" onclick="pushPage('pp-pdata')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg></div>
    <span class="lt-lbl">–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</span>
    <span class="lt-val" id="pf-pname">‚Äî</span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
  <div class="lt" style="padding-bottom:0;border:none" onclick="pushPage('pp-goals')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="4"/><path d="M12 3v2M12 19v2M3 12h2M19 12h2"/></svg></div>
    <span class="lt-lbl">–º–æ–∏ —Ü–µ–ª–∏</span>
    <span class="lt-val"><span id="pf-gw">‚Äî</span></span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
</div>
</div>

<div class="sec">—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</div>
<div class="pad">
<div class="card">
  <div class="lt">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
    <span class="lt-lbl">—Ä–æ—Å—Ç</span>
    <span class="lt-val" id="pf-height">‚Äî</span>
  </div>
  <div class="lt">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg></div>
    <span class="lt-lbl">–≤–æ–∑—Ä–∞—Å—Ç</span>
    <span class="lt-val" id="pf-age">‚Äî</span>
  </div>
  <div class="lt" style="padding-bottom:0;border:none">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a5 5 0 0 1 0 10M12 12c-5 0-8 2-8 6v2h16v-2c0-4-3-6-8-6z"/></svg></div>
    <span class="lt-lbl">–Ω–æ—Ä–º–∞ –≤–æ–¥—ã</span>
    <span class="lt-val" id="pf-gwater">‚Äî</span>
  </div>
</div>
</div>

<div class="sec">–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
<div class="pad">
<div class="card">
  <div class="lt" onclick="pushPage('pp-sett')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M2 12h3M19 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"/></svg></div>
    <span class="lt-lbl">–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
  <div class="lt" style="padding-bottom:0;border:none" onclick="openScr('scr-weight')">
    <div class="lt-ic"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zm-8 5h.01"/></svg></div>
    <span class="lt-lbl">–∑–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å</span>
    <svg class="lt-chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
  </div>
</div>
</div>
<div style="text-align:center;padding:16px 0 8px"><div class="t5">letify ¬∑ ver 4.0</div></div>
<div style="height:8px"></div>
</div>

</div><!-- /pages -->

<!-- ‚ïê‚ïê PUSH PAGES ‚ïê‚ïê -->

<!-- PP: –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="push-page" id="pp-pdata">
  <div class="pp-hdr">
    <button class="scr-back" onclick="popPage()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <span class="pp-title">–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</span>
  </div>
  <div style="padding:16px">
    <div class="m3-sec">–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
    <div class="m3-card">
      <div class="m3-field">
        <div class="m3-label">–∏–º—è</div>
        <input class="m3-input" id="inp-pname" type="text" placeholder="–ê–ª–µ–∫—Å–µ–π">
      </div>
      <div class="m3-field">
        <div class="m3-label">—Ä–æ—Å—Ç, —Å–º</div>
        <input class="m3-input num" id="inp-height" type="number" inputmode="numeric" min="100" max="250" placeholder="175">
      </div>
      <div class="m3-field">
        <div class="m3-label">–≤–æ–∑—Ä–∞—Å—Ç</div>
        <input class="m3-input num" id="inp-age" type="number" inputmode="numeric" min="10" max="100" placeholder="25">
      </div>
    </div>
    <div class="m3-sec">–ø–æ–ª</div>
    <div class="m3-seg" id="seg-gender">
      <button class="m3-seg-btn on" onclick="setGender('male')" data-g="male">‚ôÇ –º—É–∂—Å–∫–æ–π</button>
      <button class="m3-seg-btn" onclick="setGender('female')" data-g="female">‚ôÄ –∂–µ–Ω—Å–∫–∏–π</button>
    </div>
    <button class="btn btn-p" style="margin-top:16px" onclick="submitProfile()">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<!-- PP: –¶–µ–ª–∏ -->
<div class="push-page" id="pp-goals">
  <div class="pp-hdr">
    <button class="scr-back" onclick="popPage()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <span class="pp-title">–º–æ–∏ —Ü–µ–ª–∏</span>
  </div>
  <div style="padding:16px">
    <div class="m3-sec">–ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
    <div class="m3-card">
      <div class="m3-field">
        <div class="m3-label">—Ü–µ–ª–µ–≤–æ–π –≤–µ—Å, –∫–≥</div>
        <input class="m3-input num" id="inp-gw" type="number" inputmode="decimal" step="0.5" placeholder="70">
      </div>
      <div class="m3-field">
        <div class="m3-label">–Ω–æ—Ä–º–∞ –≤–æ–¥—ã, –º–ª</div>
        <input class="m3-input num" id="inp-gwat" type="number" inputmode="numeric" step="100" placeholder="2000">
      </div>
      <div class="m3-field">
        <div class="m3-label">–Ω–æ—Ä–º–∞ –∫–∞–ª–æ—Ä–∏–π</div>
        <input class="m3-input num" id="inp-gcal" type="number" inputmode="numeric" step="50" placeholder="2000">
      </div>
    </div>
    <button class="btn btn-p" style="margin-top:16px" onclick="submitGoals()">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª–∏</button>
  </div>
</div>

<!-- PP: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div class="push-page" id="pp-sett">
  <div class="pp-hdr">
    <button class="scr-back" onclick="popPage()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <span class="pp-title">–Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
  </div>
  <div style="padding:16px">
    <div class="m3-sec">–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
    <div class="m3-tog-row" onclick="toggleSett('w')">
      <div class="m3-tog-ic">‚öñÔ∏è</div>
      <div class="m3-tog-lbl">–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Å</div>
      <div class="tog on" id="tog-w"></div>
    </div>
    <div class="m3-tog-row" onclick="toggleSett('water')">
      <div class="m3-tog-ic">üíß</div>
      <div class="m3-tog-lbl">–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–æ–¥—É</div>
      <div class="tog on" id="tog-water"></div>
    </div>
    <div class="m3-tog-row" onclick="toggleSett('cal')">
      <div class="m3-tog-ic">üî•</div>
      <div class="m3-tog-lbl">–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏</div>
      <div class="tog on" id="tog-cal"></div>
    </div>
    <div class="m3-tog-row" onclick="toggleSett('sleep')">
      <div class="m3-tog-ic">üåô</div>
      <div class="m3-tog-lbl">–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–Ω</div>
      <div class="tog on" id="tog-sleep"></div>
    </div>
    <div class="m3-sec">–¥–∞–Ω–Ω—ã–µ</div>
    <div class="m3-tog-row" onclick="confirmReset()">
      <div class="m3-tog-ic">üóëÔ∏è</div>
      <div class="m3-tog-lbl" style="color:var(--red)">—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</div>
    </div>
  </div>
</div>

<!-- PP: –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (MULTI-STEP) -->
<div class="push-page" id="pp-act">
  <div class="pp-hdr">
    <button class="scr-back" id="pp-act-back" onclick="actBackOrPop()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <div style="flex:1">
      <div class="step-ind">
        <div class="step-pip on" id="sp1"></div>
        <div class="step-pip" id="sp2"></div>
        <div class="step-pip" id="sp3"></div>
      </div>
      <div class="pp-title" id="act-step-title">–Ω–∞–∑–≤–∞–Ω–∏–µ</div>
    </div>
  </div>
  <div style="padding:16px">

    <!-- –®–∞–≥ 1: –¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <div class="act-step active" id="act-s1">
      <div class="act-hint">–∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å?</div>
      <div class="m3-card" style="padding:12px">
        <div class="m3-field">
          <div class="m3-label">–Ω–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
          <input class="m3-input" id="inp-aname" type="text" placeholder="–ø—Ä–æ–±–µ–∂–∫–∞, –π–æ–≥–∞, –∑–∞–ª‚Ä¶" autocomplete="off">
        </div>
      </div>
      <div class="m3-sec">–∏–ª–∏ –≤—ã–±–µ—Ä–∏</div>
      <div class="type-grid" id="act-quick">
        <div class="type-card on" onclick="actQuick('–ø—Ä–æ–±–µ–∂–∫–∞','run',this)">
          <div class="type-card-ico">üèÉ</div><div class="type-card-lbl">–ø—Ä–æ–±–µ–∂–∫–∞</div>
        </div>
        <div class="type-card" onclick="actQuick('–∑–∞–ª','gym',this)">
          <div class="type-card-ico">üí™</div><div class="type-card-lbl">–∑–∞–ª</div>
        </div>
        <div class="type-card" onclick="actQuick('–π–æ–≥–∞','yoga',this)">
          <div class="type-card-ico">üßò</div><div class="type-card-lbl">–π–æ–≥–∞</div>
        </div>
        <div class="type-card" onclick="actQuick('—Ö–æ–¥—å–±–∞','walk',this)">
          <div class="type-card-ico">üö∂</div><div class="type-card-lbl">—Ö–æ–¥—å–±–∞</div>
        </div>
        <div class="type-card" onclick="actQuick('–≤–µ–ª–æ—Å–∏–ø–µ–¥','bike',this)">
          <div class="type-card-ico">üö¥</div><div class="type-card-lbl">–≤–µ–ª–æ—Å–∏–ø–µ–¥</div>
        </div>
        <div class="type-card" onclick="actQuick('–¥—Ä—É–≥–æ–µ','other',this)">
          <div class="type-card-ico">‚ú®</div><div class="type-card-lbl">–¥—Ä—É–≥–æ–µ</div>
        </div>
      </div>
    </div>

    <!-- –®–∞–≥ 2: –í—Ä–µ–º—è –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
    <div class="act-step" id="act-s2">
      <div class="act-hint">–≤—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
      <div class="m3-sec">–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</div>
      <div class="m3-card" style="padding:12px">
        <div class="time-input-wrap">
          <input type="time" class="time-input" id="inp-atime" value="08:00">
        </div>
      </div>
      <div class="m3-sec">–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
      <div class="m3-card" style="padding:12px">
        <div class="dur-grid" id="dur-grid">
          <button class="dur-btn" onclick="setDur(15,this)">15 –º–∏–Ω</button>
          <button class="dur-btn" onclick="setDur(20,this)">20 –º–∏–Ω</button>
          <button class="dur-btn" onclick="setDur(30,this)">30 –º–∏–Ω</button>
          <button class="dur-btn on" onclick="setDur(45,this)">45 –º–∏–Ω</button>
          <button class="dur-btn" onclick="setDur(60,this)">60 –º–∏–Ω</button>
          <button class="dur-btn" onclick="setDur(75,this)">75 –º–∏–Ω</button>
          <button class="dur-btn" onclick="setDur(90,this)">90 –º–∏–Ω</button>
          <button class="dur-btn" onclick="setDur(120,this)">2 —á–∞—Å–∞</button>
        </div>
      </div>
    </div>

    <!-- –®–∞–≥ 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ -->
    <div class="act-step" id="act-s3">
      <div class="act-hint">–ø—Ä–æ–≤–µ—Ä—å –∏ –¥–æ–±–∞–≤—å –≤ –ø–ª–∞–Ω</div>
      <div style="text-align:center;padding:16px 0 12px">
        <div id="act-confirm-ico" style="font-size:60px;margin-bottom:12px">üèÉ</div>
        <div id="act-confirm-name" style="font-size:24px;font-weight:900;letter-spacing:-.02em;margin-bottom:6px">‚Äî</div>
        <div id="act-confirm-time" style="font-size:15px;color:var(--hint);font-weight:700">‚Äî</div>
      </div>
      <div class="m3-card" style="padding:14px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <span style="font-size:14px;font-weight:700">–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</span>
          <div class="tog on" id="tog-act-rem" onclick="this.classList.toggle('on');this.classList.toggle('off')"></div>
        </div>
      </div>
    </div>

    <button class="btn btn-p" id="act-next-btn" onclick="actStepNext()" style="margin-top:20px">–¥–∞–ª–µ–µ ‚Üí</button>
  </div>
</div>

<!-- Scr overlays -->
<div id="scr-overlay" onclick="closeScr()"></div>

<div id="slayer">
<!-- Scr: –í–µ—Å -->
<div class="scr" id="scr-weight">
  <div class="scr-handle"></div>
  <div class="scr-hdr">
    <button class="scr-back" onclick="closeScr()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <div class="scr-hdr-text">
      <div class="scr-title">–∑–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å</div>
      <div class="scr-subtitle">–ø–æ—Ç—è–Ω–∏ –±–∞—Ä–∞–±–∞–Ω —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å</div>
    </div>
  </div>
  <div class="scr-body">
    <div class="m3-card" style="padding:16px">
      <div style="display:flex;justify-content:space-between;padding:0 8px;margin-bottom:8px">
        <span style="font-size:11px;font-weight:800;color:var(--hint);text-transform:uppercase;letter-spacing:.08em">–ö–ì</span>
        <span style="font-size:11px;font-weight:800;color:var(--hint);text-transform:uppercase;letter-spacing:.08em">.X</span>
      </div>
      <div class="wp-row" id="wp-weight-wrap"></div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitWeight()">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Å</button>
  </div>
</div>

<!-- Scr: –°–æ–Ω -->
<div class="scr" id="scr-sleep">
  <div class="scr-handle"></div>
  <div class="scr-hdr">
    <button class="scr-back" onclick="closeScr()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <div class="scr-hdr-text">
      <div class="scr-title">–∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–Ω</div>
      <div class="scr-subtitle">—Å–∫–æ–ª—å–∫–æ —Å–ø–∞–ª –ø—Ä–æ—à–ª–æ–π –Ω–æ—á—å—é?</div>
    </div>
  </div>
  <div class="scr-body">
    <div class="m3-card" style="padding:16px">
      <div class="wp-row" id="wp-sleep-wrap"></div>
    </div>
    <div class="m3-card" style="padding:14px">
      <div style="font-size:14px;font-weight:800;margin-bottom:12px">–∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞</div>
      <div class="m3-seg m3-seg-emoji" id="seg-sleepq">
        <button class="m3-seg-btn" onclick="setSleepQ(1)" data-q="1">üò´</button>
        <button class="m3-seg-btn" onclick="setSleepQ(2)" data-q="2">üò¥</button>
        <button class="m3-seg-btn on" onclick="setSleepQ(3)" data-q="3">üòë</button>
        <button class="m3-seg-btn" onclick="setSleepQ(4)" data-q="4">üôÇ</button>
        <button class="m3-seg-btn" onclick="setSleepQ(5)" data-q="5">üåü</button>
      </div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitSleep()">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–Ω</button>
  </div>
</div>

<!-- Scr: –ö–∞–ª–æ—Ä–∏–∏ -->
<div class="scr" id="scr-cal">
  <div class="scr-handle"></div>
  <div class="scr-hdr">
    <button class="scr-back" onclick="closeScr()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M11 6l-6 6 6 6"/></svg>
    </button>
    <div class="scr-hdr-text">
      <div class="scr-title">–¥–æ–±–∞–≤–∏—Ç—å –µ–¥—É</div>
      <div class="scr-subtitle">–∑–∞–ø–∏—à–∏ —á—Ç–æ —Å—ä–µ–ª</div>
    </div>
  </div>
  <div class="scr-body">
    <div class="m3-sec">–ø—Ä–∏—ë–º –ø–∏—â–∏</div>
    <div class="m3-seg" id="seg-meal" style="margin-bottom:12px">
      <button class="m3-seg-btn on" onclick="setMeal('breakfast')" data-m="breakfast">–∑–∞–≤—Ç—Ä–∞–∫</button>
      <button class="m3-seg-btn" onclick="setMeal('lunch')" data-m="lunch">–æ–±–µ–¥</button>
      <button class="m3-seg-btn" onclick="setMeal('dinner')" data-m="dinner">—É–∂–∏–Ω</button>
      <button class="m3-seg-btn" onclick="setMeal('snack')" data-m="snack">–ø–µ—Ä–µ–∫—É—Å</button>
    </div>
    <div class="m3-sec">–¥–∞–Ω–Ω—ã–µ</div>
    <div class="m3-card">
      <div class="m3-field">
        <div class="m3-label">–∫–∞–ª–æ—Ä–∏–π, –∫–∫–∞–ª</div>
        <input class="m3-input num" id="inp-cal" type="number" inputmode="numeric" step="10" min="0" max="3000" placeholder="500">
      </div>
      <div class="m3-field">
        <div class="m3-label">–Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞</div>
        <input class="m3-input" id="inp-cal-desc" type="text" placeholder="–≥—Ä–µ—á–∫–∞, –∫—É—Ä–∏—Ü–∞‚Ä¶">
      </div>
    </div>
  </div>
  <div class="scr-foot">
    <button class="btn btn-p" onclick="submitCal()">–¥–æ–±–∞–≤–∏—Ç—å</button>
  </div>
</div>
</div><!-- /slayer -->

<div id="toast"></div>

<!-- NAV -->
<nav id="nav">
  <div class="nt on" id="nt-home" onclick="navTo('home')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9.5z"/><path d="M9 21V12h6v9"/></svg>
    <div class="nt-dot"></div>
  </div>
  <div class="nt" id="nt-track" onclick="navTo('track')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="3" width="16" height="18" rx="2"/><path d="M8 7h8M8 11h8M8 15h5"/></svg>
    <div class="nt-dot"></div>
  </div>
  <div class="nt" id="nt-plan" onclick="navTo('plan')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18M9 16l2 2 4-4"/></svg>
    <div class="nt-dot"></div>
  </div>
  <div class="nt" id="nt-sleep" onclick="navTo('sleep')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    <div class="nt-dot"></div>
  </div>
  <div class="nt" id="nt-progress" onclick="navTo('progress')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 16l4-4 4 4 4-6"/></svg>
    <div class="nt-dot"></div>
  </div>
  <div class="nt" id="nt-profile" onclick="navTo('profile')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
    <div class="nt-dot"></div>
  </div>
</nav>

</div><!-- /root -->

<script>
/* ‚ïê‚ïê‚ïê‚ïê TG INIT ‚ïê‚ïê‚ïê‚ïê */
const tg=window.Telegram?.WebApp;
if(tg){
  tg.ready();tg.expand();
  if(typeof tg.requestFullscreen==='function')tg.requestFullscreen();
  if(typeof tg.disableVerticalSwipes==='function')tg.disableVerticalSwipes();
  if(typeof tg.setHeaderColor==='function')tg.setHeaderColor('bg_color');
  if(typeof tg.setBackgroundColor==='function')tg.setBackgroundColor('bg_color');
  tg.onEvent('themeChanged',applyTheme);
  tg.onEvent('viewportChanged',_applySA);
  tg.onEvent('safeAreaChanged',_applySA);
  tg.onEvent('fullscreenChanged',_applySA);
  setTimeout(_applySA,100);
  setTimeout(_applySA,500);
}
function _applySA(){
  const saTop=Math.max(tg?.safeAreaInset?.top??0,0);
  const csaTop=Math.max(tg?.contentSafeAreaInset?.top??0,0);
  const top=saTop+csaTop;
  const saBot=Math.max(tg?.safeAreaInset?.bottom??0,0);
  const csaBot=Math.max(tg?.contentSafeAreaInset?.bottom??0,0);
  const bot=saBot+csaBot;
  const st=Math.min(Math.max(top,0),120);
  const sb=Math.min(Math.max(bot,0),80);
  document.documentElement.style.setProperty('--st',st+'px');
  document.documentElement.style.setProperty('--sb',sb+'px');
  if(!navHidden)_setNavBot(sb);
}
function _setNavBot(sb){
  const nav=document.getElementById('nav');
  if(nav)nav.style.bottom=(12+(sb||0))+'px';
}
function applyTheme(){
  const p=tg?.themeParams||{};
  const dark=tg?.colorScheme==='dark'||window.matchMedia?.('(prefers-color-scheme:dark)').matches;
  document.body.classList.toggle('tg-dark',dark);
  if(dark){
    const bg=p.bg_color||'#17212b';
    document.documentElement.style.setProperty('--bg',bg);
    document.documentElement.style.setProperty('--bg2',bg);
    document.documentElement.style.setProperty('--text',p.text_color||'#ffffff');
    document.documentElement.style.setProperty('--hint',p.hint_color||'#708499');
  }else{
    const m={'--bg':p.bg_color,'--bg2':p.secondary_bg_color||p.bg_color,'--text':p.text_color,'--hint':p.hint_color};
    for(const[k,v]of Object.entries(m))if(v)document.documentElement.style.setProperty(k,v);
  }
}
applyTheme();

/* ‚ïê‚ïê‚ïê‚ïê API & DATA ‚ïê‚ïê‚ïê‚ïê */
const API_BASE='https://letify-production.up.railway.app';
const tgUser=tg?.initDataUnsafe?.user;
const UID=tgUser?.id||null;
const TODAY=new Date().toLocaleDateString('en-CA');

let C={
  user:{name:'‚Ä¶',height:0,age:0,start_weight:0,goal_weight:0,water_goal:2000,cal_goal:2000,gender:'male'},
  settings:{show_weight:1,show_water:1,show_calories:1,show_sleep:1},
  water:{total:0,entries:[],streak:0},calories:{},
  weight_log:[],sleep_log:[],acts_today:[],products:[]
};

async function loadData(){
  if(!UID){_demo();return;}
  try{
    const r=await fetch(`${API_BASE}/api/data?uid=${UID}`);
    if(!r.ok)throw 0;
    const d=await r.json();
    C.user=d.user||C.user;C.settings=d.settings||C.settings;
    C.water=d.water||C.water;C.calories=d.calories||C.calories;
    C.weight_log=d.weight_log||[];C.sleep_log=d.sleep_log||[];
    C.acts_today=d.acts_today||[];C.products=d.products||[];
  }catch{_demo();}
}
function _demo(){
  const g=k=>{try{const r=localStorage.getItem('lf2_'+k);return r?JSON.parse(r):null}catch{return null}};
  const s=(k,v)=>{try{localStorage.setItem('lf2_'+k,JSON.stringify(v))}catch{}};
  if(!g('ds')){
    s('user',{name:tgUser?.first_name||'–ê–ª–µ–∫—Å',height:175,age:27,start_weight:85,goal_weight:75,water_goal:2500,cal_goal:2000,gender:'male'});
    const now=new Date(),wl=[],sl=[];
    for(let i=13;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);wl.push({weight:+(85-((13-i)*.25)+(Math.random()-.5)*.3).toFixed(1),logged_at:d.toLocaleDateString('en-CA')});}
    for(let i=6;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);sl.push({hours:+(6.5+Math.random()*2).toFixed(1),quality:3+Math.floor(Math.random()*3),logged_at:d.toLocaleDateString('en-CA')});}
    s('wlog',wl);s('slog',sl);
    s('wd_'+TODAY,{total:1350,entries:[250,200,150,250,200,150,150]});
    s('cd_'+TODAY,{breakfast:420,lunch:680,dinner:0,snack:185,other:0});s('streak',7);
    s('acts_'+TODAY,[
      {id:1,name:'–ø—Ä–æ–±–µ–∂–∫–∞',type:'run',scheduled_at:'2024-01-01T07:00',duration:30,completed:1},
      {id:2,name:'–∑–∞–ª',type:'gym',scheduled_at:'2024-01-01T18:30',duration:60,completed:0},
      {id:3,name:'–π–æ–≥–∞',type:'yoga',scheduled_at:'2024-01-01T21:00',duration:25,completed:0}
    ]);
    s('ds',1);
  }
  const u=g('user')||{},wd=g('wd_'+TODAY)||{total:0,entries:[]},cd=g('cd_'+TODAY)||{};
  C.user=u;C.settings={show_weight:1,show_water:1,show_calories:1,show_sleep:1};
  C.water={total:wd.total||0,entries:wd.entries||[],streak:g('streak')||0};
  C.calories=cd;C.weight_log=g('wlog')||[];C.sleep_log=g('slog')||[];
  C.acts_today=g('acts_'+TODAY)||[];C.products=[];
}
async function apiPost(path,body){
  if(!UID)return;
  try{await fetch(`${API_BASE}${path}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid:UID,...body})});}catch{}
}
async function reload(){
  await loadData();
  const rMap={home:renderHome,track:()=>renderTrack(trackTab),plan:renderPlan,sleep:renderSleep,progress:renderProgress,profile:renderProfile};
  rMap[curTab]?.();
}
const gU=()=>C.user;
const gSS=()=>({w:!!C.settings?.show_weight,water:!!C.settings?.show_water,cal:!!C.settings?.show_calories,sleep:!!C.settings?.show_sleep});
const gWL=()=>C.weight_log.map(r=>({weight:r.weight,logged_at:(r.logged_at||'').slice(0,10)}));
const gSL=()=>C.sleep_log.map(r=>({hours:r.hours,quality:r.quality,logged_at:(r.logged_at||'').slice(0,10)}));
const gWD=()=>C.water;
const gCD=()=>C.calories;
const gActs=()=>C.acts_today.map(a=>({...a,time:(a.scheduled_at||'').slice(11,16)||'00:00',completed:!!a.completed}));
const gStreak=()=>C.water.streak||0;
const totalCal=()=>Object.values(gCD()).reduce((a,b)=>a+b,0);

/* ‚ïê‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê */
const TABS=['home','track','plan','sleep','progress','profile'];
let curTab='home',trackTab='water',curScr=null;
let navHidden=false;

function navTo(tab){
  if(tab===curTab&&!curScr&&!curPushPage)return;
  if(curScr)closeScr(false);
  if(curPushPage)popPage(false);
  curTab=tab;
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const pg=document.getElementById('p-'+tab);
  if(pg){pg.scrollTop=0;pg.classList.add('active');}
  TABS.forEach(t=>{const el=document.getElementById('nt-'+t);if(el)el.classList.toggle('on',t===tab);});
  const renders={home:renderHome,track:()=>renderTrack(trackTab),plan:renderPlan,sleep:renderSleep,progress:renderProgress,profile:renderProfile};
  renders[tab]?.();
  tg?.HapticFeedback?.selectionChanged();
}
function setTTab(t){
  trackTab=t;
  ['water','cal'].forEach(k=>{
    document.getElementById('tt-'+k)?.classList.toggle('on',k===t);
    const b=document.getElementById('tt-'+k+'-body');if(b)b.style.display=k===t?'':'none';
  });
  renderTrack(t);
}

/* ‚ïê‚ïê‚ïê‚ïê PUSH PAGES ‚ïê‚ïê‚ïê‚ïê */
let curPushPage=null;
function pushPage(id){
  curPushPage=id;
  navHidden=true;
  const nav=document.getElementById('nav');
  nav?.classList.add('gone');
  const pp=document.getElementById(id);
  if(pp){pp.classList.add('open');pp.scrollTop=0;}
  _populatePP(id);
  if(tg?.BackButton){tg.BackButton.show();tg.BackButton.onClick(popPage);}
  tg?.HapticFeedback?.impactOccurred('light');
}
function popPage(doRender=true){
  if(!curPushPage)return;
  const pp=document.getElementById(curPushPage);
  if(pp)pp.classList.remove('open');
  curPushPage=null;
  navHidden=false;
  const nav=document.getElementById('nav');
  nav?.classList.remove('gone');
  const sb=Math.min(Math.max(tg?.safeAreaInset?.bottom??0,0),80);
  _setNavBot(sb);
  if(tg?.BackButton){tg.BackButton.hide();tg.BackButton.offClick(popPage);}
  if(doRender){const renders={home:renderHome,track:()=>renderTrack(trackTab),plan:renderPlan,sleep:renderSleep,progress:renderProgress,profile:renderProfile};renders[curTab]?.();}
}
function _populatePP(id){
  const u=gU(),ss=gSS();
  if(id==='pp-pdata'){
    const ni=document.getElementById('inp-pname');if(ni)ni.value=u.name||'';
    const hi=document.getElementById('inp-height');if(hi)hi.value=u.height||'';
    const ai=document.getElementById('inp-age');if(ai)ai.value=u.age||'';
    _gender=u.gender||'male';
    document.querySelectorAll('#seg-gender .m3-seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.g===_gender));
  }
  if(id==='pp-goals'){
    const gi=document.getElementById('inp-gw');if(gi)gi.value=u.goal_weight||'';
    const wi=document.getElementById('inp-gwat');if(wi)wi.value=u.water_goal||2000;
    const ci=document.getElementById('inp-gcal');if(ci)ci.value=u.cal_goal||2000;
  }
  if(id==='pp-sett'){
    ['w','water','cal','sleep'].forEach(k=>{
      const tog=document.getElementById('tog-'+k),on=ss[k]!==false;
      if(tog){tog.classList.toggle('on',on);tog.classList.toggle('off',!on);}
    });
  }
  if(id==='pp-act'){
    actStep=1;_actType='run';_actDur=45;
    const ni=document.getElementById('inp-aname');if(ni)ni.value='–ø—Ä–æ–±–µ–∂–∫–∞';
    document.querySelectorAll('#act-quick .type-card').forEach((c,i)=>c.classList.toggle('on',i===0));
    document.querySelectorAll('#dur-grid .dur-btn').forEach(b=>b.classList.toggle('on',parseInt(b.textContent)===45||b.textContent==='45 –º–∏–Ω'));
    _renderActStep();
  }
}

/* ‚ïê‚ïê‚ïê‚ïê BOTTOM SHEETS ‚ïê‚ïê‚ïê‚ïê */
function openScr(id){
  curScr=id;
  navHidden=true;
  const nav=document.getElementById('nav');
  nav?.classList.add('gone');
  document.getElementById('scr-overlay')?.classList.add('show');
  const scr=document.getElementById(id);
  if(scr)scr.classList.add('open');
  setTimeout(()=>_populateScr(id),80);
  if(tg?.BackButton){tg.BackButton.show();tg.BackButton.onClick(closeScr);}
  tg?.HapticFeedback?.impactOccurred('light');
}
function closeScr(doNav=true){
  if(!curScr)return;
  document.getElementById(curScr)?.classList.remove('open');
  curScr=null;
  navHidden=false;
  document.getElementById('scr-overlay')?.classList.remove('show');
  const nav=document.getElementById('nav');
  nav?.classList.remove('gone');
  const sb=Math.min(Math.max(tg?.safeAreaInset?.bottom??0,0),80);
  _setNavBot(sb);
  if(tg?.BackButton){tg.BackButton.hide();tg.BackButton.offClick(closeScr);}
}
function _populateScr(id){
  if(id==='scr-weight')requestAnimationFrame(()=>initWeightPicker());
  if(id==='scr-sleep')requestAnimationFrame(()=>initSleepPicker());
}

/* ‚ïê‚ïê‚ïê‚ïê WHEEL PICKER ‚ïê‚ïê‚ïê‚ïê */
const PKR={};
const IH=40;
function mkPicker(container,items,initIdx){
  container.innerHTML='';
  container.className='wp';
  container.style.height=(IH*5)+'px';
  container.innerHTML=`<div class="wp-sel"></div><div class="wp-ft wp-ft-t"></div><div class="wp-ft wp-ft-b"></div><div class="wp-track"></div>`;
  const track=container.querySelector('.wp-track');
  let si=Math.max(0,Math.min(initIdx,items.length-1));
  function renderItems(){
    let h='<div class="wp-item"></div><div class="wp-item"></div>';
    items.forEach((it,i)=>h+=`<div class="wp-item${i===si?' sel':''}">${it.l}</div>`);
    h+='<div class="wp-item"></div><div class="wp-item"></div>';
    track.innerHTML=h;
  }
  renderItems();
  const yFor=i=>-i*IH;
  let cy=yFor(si);
  const setY=(y,anim)=>{track.style.transition=anim?'transform .22s cubic-bezier(.25,.46,.45,.94)':'none';track.style.transform=`translateY(${y}px)`;};
  setY(cy,false);
  const clampY=y=>Math.max(-(items.length-1)*IH,Math.min(0,y));
  const updHL=()=>{Array.from(track.children).slice(2,items.length+2).forEach((el,i)=>{el.classList.toggle('sel',i===si);el.style.fontSize=i===si?'22px':'17px';});};
  let sy=null,so,lv=0,lt=0;
  container.addEventListener('pointerdown',e=>{sy=e.clientY;so=cy;lv=0;lt=Date.now();track.style.transition='none';container.setPointerCapture(e.pointerId);e.preventDefault();},{passive:false});
  container.addEventListener('pointermove',e=>{if(sy===null)return;const now=Date.now(),dt=Math.max(1,now-lt);lv=(e.clientY-sy)/Math.max(1,dt);lt=now;cy=clampY(so+(e.clientY-sy));track.style.transform=`translateY(${cy}px)`;const ni=Math.max(0,Math.min(Math.round(-cy/IH),items.length-1));if(ni!==si){si=ni;updHL();}},{passive:false});
  function snap(){if(sy===null)return;sy=null;si=Math.max(0,Math.min(Math.round(-(cy+lv*60)/IH),items.length-1));cy=yFor(si);setY(cy,true);updHL();tg?.HapticFeedback?.selectionChanged();}
  container.addEventListener('pointerup',snap);container.addEventListener('pointercancel',snap);
  return{get:()=>items[si],setIdx(i){si=Math.max(0,Math.min(i,items.length-1));cy=yFor(si);setY(cy,false);updHL();}};
}

function initWeightPicker(){
  const wl=gWL();const iw=wl.length?wl[wl.length-1].weight:70;
  const ii=Math.floor(iw),id=Math.round((iw-ii)*10);
  const intItems=Array.from({length:171},(_,i)=>({l:String(30+i),v:30+i}));
  const decItems=Array.from({length:10},(_,i)=>({l:'.'+i,v:i/10}));
  const wrap=document.getElementById('wp-weight-wrap');
  wrap.innerHTML='<div class="wp-col" style="flex:3"><div class="wp-lbl">–∫–≥</div><div id="wpi-i"></div></div><div class="wp-sep"> </div><div class="wp-col" style="flex:1;min-width:80px"><div class="wp-lbl">.X</div><div id="wpi-d"></div></div>';
  PKR.wi=mkPicker(document.getElementById('wpi-i'),intItems,ii-30);
  PKR.wd=mkPicker(document.getElementById('wpi-d'),decItems,id);
}
function initSleepPicker(){
  const sl=gSL();const ih=sl.length?sl[sl.length-1].hours:8;
  const ihh=Math.floor(ih),idd=ih-ihh>=0.5?1:0;
  const hItems=Array.from({length:14},(_,i)=>({l:String(1+i),v:1+i}));
  const dItems=[{l:'.0',v:0},{l:'.5',v:.5}];
  const wrap=document.getElementById('wp-sleep-wrap');
  wrap.innerHTML='<div class="wp-col" style="flex:3"><div class="wp-lbl">—á–∞—Å–æ–≤</div><div id="wps-h"></div></div><div class="wp-col" style="flex:1;min-width:70px"><div class="wp-lbl">.X</div><div id="wps-d"></div></div>';
  PKR.sh=mkPicker(document.getElementById('wps-h'),hItems,Math.max(0,ihh-1));
  PKR.sd=mkPicker(document.getElementById('wps-d'),dItems,idd);
}

/* ‚ïê‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê */
const $=id=>document.getElementById(id);
const T=(id,v)=>{const e=$(id);if(e)e.textContent=v;};
const H=(id,v)=>{const e=$(id);if(e)e.innerHTML=v;};
function dts(){const n=new Date(),y=n.getMonth()>=5?n.getFullYear()+1:n.getFullYear();return Math.ceil((new Date(y,5,1)-n)/86400000);}
function pD(n){const a=Math.abs(n)%100;if(a>=11&&a<=19)return'–¥–Ω–µ–π';if(a%10===1)return'–¥–µ–Ω—å';if(a%10>=2&&a%10<=4)return'–¥–Ω—è';return'–¥–Ω–µ–π';}
function fmtD(s){if(!s)return'‚Äî';try{const d=new Date(s+'T00:00:00');const m=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];return d.getDate()+' '+m[d.getMonth()];}catch{return s;}}
function fmtMD(s){try{const d=new Date(s+'T00:00:00');return(d.getMonth()+1)+'/'+(d.getDate());}catch{return'';}}
function qIco(q){return['','üò´','üò¥','üòë','üôÇ','üåü'][q]||'üòë';}
const ACT_ICO={run:'üèÉ',walk:'üö∂',bike:'üö¥',gym:'üí™',yoga:'üßò',swim:'üèä',other:'‚ú®'};
const ACT_COL={run:'#FF6B35',walk:'#52C177',bike:'#4EAEE5',gym:'#E91E63',yoga:'#8B7FD4',swim:'#00BCD4',other:'#FFAB40'};

/* ‚ïê‚ïê‚ïê‚ïê ACTIVITY FORM ‚ïê‚ïê‚ïê‚ïê */
let actStep=1,_actType='run',_actDur=45;
const ACT_TITLES=['–Ω–∞–∑–≤–∞–Ω–∏–µ','–∫–æ–≥–¥–∞?','–≥–æ—Ç–æ–≤–æ!'];

function _renderActStep(){
  [1,2,3].forEach(i=>{
    document.getElementById('act-s'+i)?.classList.toggle('active',i===actStep);
    const pip=document.getElementById('sp'+i);
    if(pip){
      pip.classList.toggle('on',i===actStep);
      pip.classList.toggle('done',i<actStep);
      if(i<actStep)pip.classList.remove('on');
    }
  });
  T('act-step-title',ACT_TITLES[actStep-1]);
  const btn=$('act-next-btn');
  if(btn)btn.textContent=actStep===3?'‚úì –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–∞–Ω':'–¥–∞–ª–µ–µ ‚Üí';
  if(actStep===3)_updateActConfirm();
  tg?.HapticFeedback?.selectionChanged();
}
function _updateActConfirm(){
  const name=$('inp-aname')?.value||'‚Äî';
  const time=$('inp-atime')?.value||'08:00';
  const ico=ACT_ICO[_actType]||'‚ú®';
  if($('act-confirm-ico'))$('act-confirm-ico').textContent=ico;
  if($('act-confirm-name'))$('act-confirm-name').textContent=name;
  if($('act-confirm-time'))$('act-confirm-time').textContent=time+' ¬∑ '+_actDur+' –º–∏–Ω';
}
function actBackOrPop(){
  if(actStep>1){actStep--;_renderActStep();}
  else{popPage();}
}
function actStepNext(){
  if(actStep===1){
    const name=$('inp-aname')?.value?.trim();
    if(!name){toast('–≤–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ');return;}
    actStep=2;_renderActStep();
  }else if(actStep===2){
    actStep=3;_renderActStep();
  }else{
    submitAct();
  }
}
function actQuick(name,type,el){
  _actType=type;
  document.querySelectorAll('#act-quick .type-card').forEach(c=>c.classList.remove('on'));
  el?.classList.add('on');
  const inp=$('inp-aname');if(inp)inp.value=name;
}
function setDur(val,el){
  _actDur=val;
  document.querySelectorAll('#dur-grid .dur-btn').forEach(b=>b.classList.remove('on'));
  el?.classList.add('on');
}

/* ‚ïê‚ïê‚ïê‚ïê OTHER SETTERS ‚ïê‚ïê‚ïê‚ïê */
let _sleepQ=3,_mealType='breakfast',_gender='male';
function setSleepQ(q){_sleepQ=q;document.querySelectorAll('#seg-sleepq .m3-seg-btn').forEach(b=>b.classList.toggle('on',+b.dataset.q===q));}
function setMeal(m){_mealType=m;document.querySelectorAll('#seg-meal .m3-seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.m===m));}
function setGender(g){_gender=g;document.querySelectorAll('#seg-gender .m3-seg-btn').forEach(b=>b.classList.toggle('on',b.dataset.g===g));}
function toggleSett(key){
  const ss=gSS();const nv=!ss[key];
  const fm={w:'show_weight',water:'show_water',cal:'show_calories',sleep:'show_sleep'};
  if(fm[key])C.settings[fm[key]]=nv?1:0;
  const tog=$('tog-'+key);if(tog){tog.classList.toggle('on',nv);tog.classList.toggle('off',!nv);}
  toast(nv?'–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è':'—Å–∫—Ä—ã—Ç–æ');
  apiPost('/api/settings',{[fm[key]]:nv?1:0});
}

/* ‚ïê‚ïê‚ïê‚ïê SUBMIT ACTIONS ‚ïê‚ïê‚ïê‚ïê */
let _addWBusy=false;
async function addW(ml){
  if(_addWBusy)return;_addWBusy=true;
  C.water.total=(C.water.total||0)+ml;
  C.water.entries=[...(C.water.entries||[]),ml];
  renderTrack('water');renderHome();
  toast('+'+ml+' –º–ª');tg?.HapticFeedback?.impactOccurred('light');
  apiPost('/api/water',{amount:ml});
  setTimeout(()=>{_addWBusy=false;},250);
}
async function undoW(){
  if(!C.water.entries?.length){toast('–Ω–µ—á–µ–≥–æ –æ—Ç–º–µ–Ω—è—Ç—å');return;}
  const last=C.water.entries.pop();
  C.water.total=Math.max(0,(C.water.total||0)-last);
  renderTrack('water');renderHome();toast('–æ—Ç–º–µ–Ω–µ–Ω–æ ‚àí'+last+' –º–ª');
  apiPost('/api/water/undo',{});
}
async function completeAct(id){
  const a=gActs().find(x=>x.id===id);if(!a)return;
  const ns=!a.completed;
  C.acts_today=C.acts_today.map(x=>x.id===id?{...x,completed:ns?1:0}:x);
  renderPlan();renderHome();
  toast(ns?'–≤—ã–ø–æ–ª–Ω–µ–Ω–æ':'–æ—Ç–º–µ–Ω–µ–Ω–æ');
  tg?.HapticFeedback?.notificationOccurred(ns?'success':'warning');
  await apiPost(ns?'/api/activity/complete':'/api/activity/uncomplete',{act_id:id});
  await reload();
}
async function submitWeight(){
  const iv=PKR.wi?.get(),dv=PKR.wd?.get();
  const v=iv&&dv!=null?iv.v+dv.v:null;
  if(!v||v<30||v>300){toast('–≤—ã–±–µ—Ä–∏ –≤–µ—Å');return;}
  closeScr();
  C.weight_log=[...(C.weight_log||[]),{weight:v,logged_at:TODAY}];
  if(!C.user.start_weight)C.user.start_weight=v;
  renderProgress();renderHome();
  toast('–≤–µ—Å '+v.toFixed(1)+' –∫–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/weight',{weight:v});await reload();
}
async function submitSleep(){
  const hv=PKR.sh?.get(),dv=PKR.sd?.get();
  const hrs=hv&&dv!=null?hv.v+(dv?.v||0):null;
  if(!hrs||hrs<.5||hrs>20){toast('–≤—ã–±–µ—Ä–∏ —á–∞—Å—ã —Å–Ω–∞');return;}
  closeScr();
  C.sleep_log=[...(C.sleep_log||[]),{hours:hrs,quality:_sleepQ,logged_at:TODAY}];
  renderSleep();renderHome();
  toast('—Å–æ–Ω '+hrs+' —á —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/sleep',{hours:hrs,quality:_sleepQ});await reload();
}
async function submitCal(){
  const cal=parseInt($('inp-cal')?.value);
  const desc=$('inp-cal-desc')?.value||'';
  if(!cal||cal<1){toast('–≤–≤–µ–¥–∏ –∫–∞–ª–æ—Ä–∏–∏');return;}
  closeScr();
  if(!C.calories)C.calories={};
  C.calories[_mealType]=(C.calories[_mealType]||0)+cal;
  renderTrack('cal');renderHome();
  toast('+'+cal+' –∫–∫–∞–ª');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/calories',{amount:cal,meal_type:_mealType,description:desc});await reload();
}
async function submitProfile(){
  const name=$('inp-pname')?.value?.trim();
  const height=parseInt($('inp-height')?.value);
  const age=parseInt($('inp-age')?.value);
  if(!name){toast('–≤–≤–µ–¥–∏ –∏–º—è');return;}
  popPage();
  C.user={...C.user,name,height:height||0,age:age||0,gender:_gender};
  renderProfile();renderHome();toast('–ø—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/profile',{name,height:height||0,age:age||0,gender:_gender});await reload();
}
async function submitGoals(){
  const gw=parseFloat($('inp-gw')?.value)||0;
  const gwat=parseInt($('inp-gwat')?.value)||2000;
  const gcal=parseInt($('inp-gcal')?.value)||2000;
  popPage();
  C.user={...C.user,goal_weight:gw,water_goal:gwat,cal_goal:gcal};
  renderProfile();renderHome();toast('—Ü–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/goals',{goal_weight:gw,water_goal:gwat,cal_goal:gcal});await reload();
}
async function submitAct(){
  const name=$('inp-aname')?.value?.trim();
  const time=$('inp-atime')?.value||'08:00';
  if(!name){toast('–≤–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ');return;}
  popPage();
  const fid=Date.now();
  C.acts_today=[...(C.acts_today||[]),{id:fid,name,type:_actType,scheduled_at:`${TODAY}T${time}:00`,duration:_actDur,completed:0}];
  renderPlan();renderHome();toast(name+' –¥–æ–±–∞–≤–ª–µ–Ω–æ üéâ');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/activity/create',{name,type:_actType,time,duration:_actDur});await reload();
}
function confirmReset(){
  if(!confirm('—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?'))return;
  localStorage.clear();
  C={user:{name:'‚Ä¶',water_goal:2000,cal_goal:2000},settings:{show_weight:1,show_water:1,show_calories:1,show_sleep:1},water:{total:0,entries:[],streak:0},calories:{},weight_log:[],sleep_log:[],acts_today:[],products:[]};
  popPage();renderHome();renderProfile();toast('–¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
}

/* ‚ïê‚ïê‚ïê‚ïê ACTIVITY STATUS ‚ïê‚ïê‚ïê‚ïê */
function actStatus(a){
  const now=new Date(),[hh,mm]=(a.time||'00:00').split(':').map(Number);
  const st=new Date();st.setHours(hh,mm,0,0);
  const en=new Date(st.getTime()+(a.duration||30)*60000);
  if(a.completed)return{s:'done',l:'–≤—ã–ø–æ–ª–Ω–µ–Ω–æ'};
  if(now>en)return{s:'late',l:'–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ'};
  if(now>=st&&now<=en){const r=Math.round((en-now)/60000);return{s:'now',l:'–∏–¥—ë—Ç ¬∑ –µ—â—ë '+r+' –º–∏–Ω',p:(now-st)/(en-st)};}
  const df=Math.round((st-now)/60000);
  if(df<=30)return{s:'soon',l:'—á–µ—Ä–µ–∑ '+df+' –º–∏–Ω'};
  return{s:'later',l:'–≤ '+a.time};
}
function fmtRange(a){
  const[hh,mm]=(a.time||'00:00').split(':').map(Number);
  const eh=hh+Math.floor((mm+(a.duration||30))/60),em=(mm+(a.duration||30))%60;
  return`${a.time}‚Äì${String(eh%24).padStart(2,'0')}:${String(em).padStart(2,'0')}`;
}

/* ‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê */
let _tt;
function toast(msg){
  const el=$('toast');if(!el)return;
  el.textContent=msg;el.classList.add('show');
  clearTimeout(_tt);_tt=setTimeout(()=>el.classList.remove('show'),1800);
}

/* ‚ïê‚ïê‚ïê‚ïê CHART ‚ïê‚ïê‚ïê‚ïê */
let _chartRaf=null;
function drawChart(data){
  const canvas=$('wchart');if(!canvas)return;
  cancelAnimationFrame(_chartRaf);
  _chartRaf=requestAnimationFrame(()=>{
    const dpr=Math.min(window.devicePixelRatio||1,2);
    const containerW=canvas.parentElement.clientWidth||280;
    // Make chart wider if many data points
    const W=Math.max(containerW,data&&data.length>5?data.length*52:containerW);
    const H=90;
    canvas.width=W*dpr;canvas.height=H*dpr;
    canvas.style.width=W+'px';canvas.style.height=H+'px';
    const ctx=canvas.getContext('2d');
    ctx.scale(dpr,dpr);
    const cs=getComputedStyle(document.documentElement);
    const sun=cs.getPropertyValue('--sun').trim()||'#FF6B35';
    const hint=cs.getPropertyValue('--hint').trim()||'#A89F90';
    const bg=cs.getPropertyValue('--bg2').trim()||'#fff';
    ctx.clearRect(0,0,W,H);
    if(!data||data.length<2){
      ctx.fillStyle=hint;ctx.font='600 11px Onest,sans-serif';ctx.textAlign='center';ctx.fillText('–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö',W/2,H/2);return;
    }
    const ws=data.map(d=>d.weight);
    const mn=Math.min(...ws)-.3,mx=Math.max(...ws)+.3,rng=mx-mn||1;
    const pl={l:8,r:8,t:18,b:20};
    const xs=(W-pl.l-pl.r)/(data.length-1);
    const yf=w=>pl.t+(1-(w-mn)/rng)*(H-pl.t-pl.b);
    const pts=data.map((d,i)=>[pl.l+i*xs,yf(d.weight)]);
    // gradient area
    const grad=ctx.createLinearGradient(0,0,0,H);
    grad.addColorStop(0,'rgba(255,107,53,.16)');grad.addColorStop(1,'rgba(255,107,53,0)');
    ctx.beginPath();ctx.moveTo(pts[0][0],pts[0][1]);
    for(let i=0;i<pts.length-1;i++){const cx=(pts[i][0]+pts[i+1][0])/2;ctx.bezierCurveTo(cx,pts[i][1],cx,pts[i+1][1],pts[i+1][0],pts[i+1][1]);}
    ctx.lineTo(pts[pts.length-1][0],H);ctx.lineTo(pts[0][0],H);ctx.closePath();
    ctx.fillStyle=grad;ctx.fill();
    // line
    ctx.beginPath();ctx.moveTo(pts[0][0],pts[0][1]);
    for(let i=0;i<pts.length-1;i++){const cx=(pts[i][0]+pts[i+1][0])/2;ctx.bezierCurveTo(cx,pts[i][1],cx,pts[i+1][1],pts[i+1][0],pts[i+1][1]);}
    ctx.strokeStyle=sun;ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';ctx.stroke();
    // dots + labels
    pts.forEach((p,i)=>{
      ctx.beginPath();ctx.arc(p[0],p[1],4,0,Math.PI*2);ctx.fillStyle=sun;ctx.fill();
      ctx.beginPath();ctx.arc(p[0],p[1],2.5,0,Math.PI*2);ctx.fillStyle=bg;ctx.fill();
      ctx.fillStyle=sun;ctx.font='700 9px Onest,sans-serif';ctx.textAlign='center';ctx.fillText(data[i].weight,p[0],p[1]-8);
      ctx.fillStyle=hint;ctx.font='700 8px Onest,sans-serif';ctx.fillText(fmtMD(data[i].logged_at),p[0],H-2);
    });
  });
}

/* ‚ïê‚ïê‚ïê‚ïê RENDERS ‚ïê‚ïê‚ïê‚ïê */
function renderHome(){
  const u=gU(),wl=gWL(),sl=gSL(),wd=gWD();
  T('h-name',u.name||'‚Äî');
  const now=new Date();
  const days=['–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ','–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–≤—Ç–æ—Ä–Ω–∏–∫','—Å—Ä–µ–¥–∞','—á–µ—Ç–≤–µ—Ä–≥','–ø—è—Ç–Ω–∏—Ü–∞','—Å—É–±–±–æ—Ç–∞'];
  const mons=['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è','–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];
  T('h-date',days[now.getDay()]+', '+now.getDate()+' '+mons[now.getMonth()]);
  const dsl=dts();T('h-days',dsl);T('h-dunit',pD(dsl));T('h-ddays',dsl);
  const wt=wd.total||0,wg=u.water_goal||2000,wp=Math.min(1,wt/wg);
  T('arc-wpct',Math.round(wp*100)+'%');T('arc-wml',wt);
  requestAnimationFrame(()=>{const a=$('arc-w');if(a)a.setAttribute('stroke-dashoffset',163.4*(1-wp));});
  const ct=totalCal(),cg=u.cal_goal||2000,cp=Math.min(1,ct/cg);
  T('arc-cpct',Math.round(cp*100)+'%');T('arc-cval',ct);
  requestAnimationFrame(()=>{const a=$('arc-c');if(a)a.setAttribute('stroke-dashoffset',207.3*(1-cp));});
  if(sl.length){
    const last=sl[sl.length-1];
    const sqEl=$('arc-sq');if(sqEl)sqEl.innerHTML=Array.from({length:5},(_,i)=>`<div class="sqd${i<last.quality?' on':''}"></div>`).join('');
    const sp=Math.min(1,last.hours/9);
    requestAnimationFrame(()=>{const a=$('arc-s');if(a)a.setAttribute('stroke-dashoffset',163.4*(1-sp));});
    T('arc-sh',last.hours.toFixed(1));
  }
  if(wl.length){
    const cw=wl[wl.length-1].weight,sw=u.start_weight||wl[0].weight||cw,gw=u.goal_weight;
    T('h-wcur',cw.toFixed(1));T('h-wgoal',gw?gw.toFixed(1):'‚Äî');
    const tot=Math.abs(sw-gw)||1,lost=sw-cw;
    const pct=gw?Math.min(100,Math.max(0,Math.round(lost/tot*100))):0;
    T('h-wpct',pct+'%');
    requestAnimationFrame(()=>{const b=$('h-wbar');if(b)b.style.width=pct+'%';});
  }
  const streak=gStreak();
  const sw=$('h-streak-w');if(sw)sw.style.display=streak>=2?'':'none';
  T('h-sval',streak+' –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥');
  const acts=gActs();
  const ps=$('h-plan-sec'),pl=$('h-plan-list');
  if(ps&&pl){
    if(!acts.length){ps.style.display='none';}
    else{
      ps.style.display='';
      const nt=new Date();
      pl.innerHTML=acts.map(a=>{
        const ico=ACT_ICO[a.type]||'‚ú®',col=ACT_COL[a.type]||'#FF9800',done=a.completed;
        const[hh,mm]=(a.time||'00:00').split(':').map(Number);
        const at=new Date();at.setHours(hh,mm,0,0);
        const et=new Date(at.getTime()+(a.duration||30)*60000);
        const ts=`${a.time}‚Äì${String(et.getHours()).padStart(2,'0')}:${String(et.getMinutes()).padStart(2,'0')}`;
        const late=!done&&nt>et;
        const badge=done?`<span class="pill p-ok">‚úì</span>`:late?`<span class="pill p-late">–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>`:`<span class="pill p-soon">${a.time}</span>`;
        return`<div class="ac${done?' done':''}"><div class="ac-ico" style="background:${col}18">${done?'‚úÖ':ico}</div><div class="ac-body"><div class="ac-name">${a.name}</div><div class="ac-sub">${ts} ¬∑ ${a.duration} –º–∏–Ω</div></div>${badge}</div>`;
      }).join('');
    }
  }
}

function renderTrack(tab){if(tab==='water')renderWater();else if(tab==='cal')renderCal();}
function renderWater(){
  const u=gU(),wd=gWD();
  const wt=wd.total||0,wg=u.water_goal||2000,wp=Math.min(100,Math.round(wt/wg*100));
  T('w-total',wt);T('w-goal',wg);
  requestAnimationFrame(()=>{const b=$('w-bar');if(b)b.style.width=wp+'%';});
  const st=gStreak();
  H('w-streak',st>=2?`<div style="display:inline-flex;align-items:center;gap:4px;background:rgba(255,107,53,.1);color:var(--sun);padding:4px 12px;border-radius:99px;font-size:11px;font-weight:800">üî• ${st} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>`:'');
  const entries=wd.entries||[];
  H('w-entries',entries.length?[...entries].reverse().slice(0,8).map((e,i)=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--brd)${i===0?';border-bottom:none':''}"><span style="font-size:12px;font-weight:700;color:var(--water)">+${e} –º–ª</span><span class="t5" style="font-size:11px">—Å—Ç–∞–∫–∞–Ω ${entries.length-i}</span></div>`).join(''):'<div style="text-align:center;padding:12px;color:var(--hint);font-size:12px;font-weight:600">–ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ</div>');
}
function renderCal(){
  const u=gU(),cd=gCD();
  const ct=totalCal(),cg=u.cal_goal||2000,cp=Math.min(100,Math.round(ct/cg*100));
  T('c-total',ct);T('c-goal',cg);
  requestAnimationFrame(()=>{const b=$('c-bar');if(b)b.style.width=cp+'%';});
  const MEALS=[{k:'breakfast',i:'üåÖ',n:'–∑–∞–≤—Ç—Ä–∞–∫',col:'#FF9800'},{k:'lunch',i:'‚òÄÔ∏è',n:'–æ–±–µ–¥',col:'#FF6B35'},{k:'dinner',i:'üåô',n:'—É–∂–∏–Ω',col:'#8B7FD4'},{k:'snack',i:'üçë',n:'–ø–µ—Ä–µ–∫—É—Å',col:'#52C177'},{k:'other',i:'üåø',n:'–¥—Ä—É–≥–æ–µ',col:'#607D8B'}];
  H('c-meals',MEALS.map(m=>`<div class="mr"><div class="mr-ico" style="background:${m.col}18;color:${m.col}">${m.i}</div><div style="flex:1"><div class="mr-name">${m.n}</div>${!cd[m.k]?`<div class="t5" style="font-size:10px">–Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ</div>`:''}</div><div class="mr-kcal" style="${cd[m.k]?'color:var(--cal)':'color:var(--hint)'}">${cd[m.k]||'‚Äî'} ${cd[m.k]?'–∫–∫–∞–ª':''}</div></div>`).join(''));
}

function renderPlan(){
  const acts=gActs();
  const now=new Date();
  const mons=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];
  T('pl-date','—Å–µ–≥–æ–¥–Ω—è ¬∑ '+now.getDate()+' '+mons[now.getMonth()]);
  const done=acts.filter(a=>a.completed).length,total=acts.length;
  T('pl-cnt',total?`${done}/${total}`:'0/0');
  requestAnimationFrame(()=>{const r=$('pl-ring');if(r)r.setAttribute('stroke-dashoffset',125.7*(1-(total?done/total:0)));});
  const empty=$('pl-empty'),list=$('pl-list');
  if(!acts.length){if(empty)empty.style.display='';if(list){list.innerHTML='';list.style.display='none';}return;}
  if(empty)empty.style.display='none';if(list)list.style.display='';
  list.innerHTML=acts.map(a=>{
    const ico=ACT_ICO[a.type]||'‚ú®',col=ACT_COL[a.type]||'#FF9800';
    const st=actStatus(a);
    const pc={done:'p-ok',now:'p-now',soon:'p-soon',late:'p-late',later:'p-later'}[st.s]||'p-later';
    const pct=st.s==='now'?Math.round((st.p||0)*100):st.s==='done'?100:0;
    const bar=['done','now','soon'].includes(st.s);
    return`<div class="ac${a.completed?' done':''}">
      <div class="ac-ico" style="background:${col}18">${a.completed?'‚úÖ':ico}</div>
      <div class="ac-body">
        <div class="ac-name${a.completed?' done-text':''}">${a.name}</div>
        <div class="ac-sub">${fmtRange(a)} ¬∑ ${a.duration} –º–∏–Ω</div>
        <span class="pill ${pc}">${st.l}</span>
        ${bar?`<div class="ac-bar"><div class="ac-barf" style="width:${st.s==='soon'?80:pct}%;background:${st.s==='done'?'var(--green)':st.s==='now'?'var(--water)':'rgba(255,107,53,.35)'}"></div></div>`:''}
      </div>
      <div style="flex-shrink:0">
        <button class="btn btn-g" style="padding:7px 11px;font-size:12px;border-radius:9px" onclick="completeAct(${a.id})">${a.completed?'‚Ü©':'‚úì'}</button>
      </div>
    </div>`;
  }).join('');
}
setInterval(()=>{if(curTab==='plan')renderPlan();},30000);

function renderSleep(){
  const sl=gSL();
  if(sl.length){const last=sl[sl.length-1];T('sl-h',last.hours.toFixed(1));T('sl-qico',qIco(last.quality));H('sl-dots',Array.from({length:5},(_,i)=>`<div class="sqd${i<last.quality?' on':''}"></div>`).join(''));}
  else{T('sl-h','‚Äî');T('sl-qico','‚Äî');H('sl-dots','');}
  const l7=sl.slice(-7).reverse();
  H('sl-hist',l7.length?l7.map(e=>`<div class="hr"><div class="hr-d">${fmtD(e.logged_at)}</div><div style="display:flex;align-items:center;gap:7px;flex:1"><div class="hr-v">${e.hours.toFixed(1)} —á</div><div class="sq">${Array.from({length:5},(_,i)=>`<div class="sqd${i<e.quality?' on':''}"></div>`).join('')}</div></div><div style="font-size:16px">${qIco(e.quality)}</div></div>`).join(''):'<div style="text-align:center;padding:14px;color:var(--hint);font-size:12px;font-weight:600">–Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>');
  if(l7.length){
    const ah=+(l7.reduce((a,b)=>a+b.hours,0)/l7.length).toFixed(1);
    const aq=+(l7.reduce((a,b)=>a+(b.quality||3),0)/l7.length).toFixed(1);
    T('sl-avg-h',ah);T('sl-avg-q',qIco(Math.round(aq))+' '+aq);
  }
}

function renderProgress(){
  const u=gU(),wl=gWL(),sl=gSL(),wd=gWD(),acts=gActs();
  if(wl.length){
    const cw=wl[wl.length-1].weight,sw=u.start_weight||wl[0].weight||cw,gw=u.goal_weight;
    T('pr-wcur',cw.toFixed(1));T('pr-wgoal',gw?gw.toFixed(1)+' –∫–≥':'‚Äî');
    T('pr-wgoal2',gw?gw.toFixed(1):'‚Äî');T('pr-wstart',sw.toFixed(1));
    const tot=Math.abs(sw-(gw||sw))||1,lost=sw-cw;
    const pct=gw?Math.min(100,Math.max(0,Math.round(lost/tot*100))):0;
    T('pr-wpct',pct+'%');T('pr-winfo',`–ø–æ—Ç–µ—Ä—è–Ω–æ ${Math.abs(lost).toFixed(1)} –∫–≥ ¬∑ –æ—Å—Ç–∞–ª–æ—Å—å ${Math.max(0,cw-(gw||cw)).toFixed(1)} –∫–≥`);
    requestAnimationFrame(()=>{const b=$('pr-wbar');if(b)b.style.width=pct+'%';});
    if(wl.length>=2&&gw&&cw>gw){try{
      const d1=new Date(wl[0].logged_at+'T00:00:00'),d2=new Date(wl[wl.length-1].logged_at+'T00:00:00');
      const dd=Math.max(1,(d2-d1)/86400000),rate=(wl[0].weight-wl[wl.length-1].weight)/dd*7;
      if(rate>.01){const dl=Math.ceil((cw-gw)/rate*7),eta=new Date();eta.setDate(eta.getDate()+dl);const mons=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];T('pr-forecast','–ø—Ä–æ–≥–Ω–æ–∑: '+eta.getDate()+' '+mons[eta.getMonth()]+' ¬∑ —Ç–µ–º–ø '+rate.toFixed(2)+' –∫–≥/–Ω–µ–¥');}
    }catch{}}
  }
  // Show all weight data in chart with scroll
  const chartData=wl.length>14?wl.slice(-14):wl;
  setTimeout(()=>drawChart(chartData),50);
  T('pw-water',wd.total||0);T('pw-cal',totalCal());
  if(sl.length)T('pw-sleep',+(sl.slice(-7).reduce((a,b)=>a+b.hours,0)/Math.min(7,sl.length)).toFixed(1));
  else T('pw-sleep','‚Äî');
  const l6=wl.slice(-6).reverse();
  H('pr-whist',l6.length?l6.map((e,i)=>{const prev=l6[i+1];const diff=prev?+(e.weight-prev.weight).toFixed(1):0;return`<div class="hr"><div class="hr-d">${fmtD(e.logged_at)}</div><div class="hr-v">${e.weight.toFixed(1)} –∫–≥</div>${diff?`<div class="hr-diff ${diff<0?'d-neg':'d-pos'}">${diff>0?'+':''}${diff}</div>`:'<div></div>'}</div>`;}).join(''):'<div style="text-align:center;padding:12px;color:var(--hint);font-size:12px;font-weight:600">–Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>');
  T('at-t',acts.filter(a=>a.completed).length);
  T('at-w',+((wd.total||0)/1000).toFixed(1));
  T('at-s',gStreak());
}

function renderProfile(){
  const u=gU(),ss=gSS(),wl=gWL();
  const av=$('pf-av');if(av)av.textContent=(u.name||'?').charAt(0).toUpperCase();
  T('pf-name',u.name||'‚Äî');
  const meta=[];if(u.age)meta.push(u.age+' –ª–µ—Ç');if(u.height)meta.push(u.height+' —Å–º');if(u.gender)meta.push(u.gender==='male'?'‚ôÇ':'‚ôÄ');
  T('pf-meta',meta.join(' ¬∑ ')||'‚Äî');
  T('pf-gw',u.goal_weight?u.goal_weight+' –∫–≥':'‚Äî');
  T('pf-pname',u.name||'‚Äî');
  T('pf-height',u.height?u.height+' —Å–º':'‚Äî');
  T('pf-age',u.age?u.age+' –ª–µ—Ç':'‚Äî');
  T('pf-gwater',(u.water_goal||2000)+' –º–ª');
  const bmiRow=$('pf-bmi-row');
  if(u.height&&wl.length){
    const cw=wl[wl.length-1].weight,h2=u.height/100;
    const bmi=+(cw/h2/h2).toFixed(1);
    const ideal=+((u.height-100)*.9).toFixed(1);
    const bmr=Math.round(u.gender==='female'?10*cw+6.25*u.height-5*(u.age||25)-161:10*cw+6.25*u.height-5*(u.age||25)+5);
    if(bmiRow)bmiRow.style.display='';
    T('pf-bmi',bmi);T('pf-ideal',ideal);T('pf-bmr',bmr);
  }else if(bmiRow)bmiRow.style.display='none';
}

/* ‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('DOMContentLoaded',async()=>{
  const dark=tg?.colorScheme==='dark'||window.matchMedia?.('(prefers-color-scheme:dark)').matches;
  if(dark)document.body.classList.add('tg-dark');
  tg?.onEvent('themeChanged',()=>{document.body.classList.toggle('tg-dark',tg?.colorScheme==='dark');applyTheme();});
  await loadData();
  renderHome();
  setInterval(async()=>{if(curTab==='home'){await loadData();renderHome();}},30000);
});
</script>
</body>
</html>