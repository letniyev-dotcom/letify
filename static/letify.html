<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no">
<title>letify</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900;1000&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;
  -webkit-tap-highlight-color:transparent!important;
  -webkit-touch-callout:none;
  tap-highlight-color:transparent!important;
}
:root{
  /* Telegram theme tokens with warm fallbacks */
  --bg:        var(--tg-theme-bg-color,       #FAF7F2);
  --bg2:       var(--tg-theme-secondary-bg-color,#FFFFFF);
  --text:      var(--tg-theme-text-color,      #1C1608);
  --hint:      var(--tg-theme-hint-color,      #A89F90);
  --link:      var(--tg-theme-link-color,      #FF6B35);
  --btn:       var(--tg-theme-button_color,    #FF6B35);
  --btntxt:    var(--tg-theme-button_text_color,#FFFFFF);

  /* Brand */
  --sun:   #FF6B35;
  --sun2:  #FFAB40;
  --water: #4EAEE5;
  --cal:   #F4814A;
  --sleep: #8B7FD4;
  --green: #52C177;
  --red:   #F45C5C;

  --r: 20px;
  --r-sm: 12px;
  --r-lg: 28px;

  --nav-h: 76px;
  --st: max(env(safe-area-inset-top,0px), var(--tg-safe-area-inset-top,0px), 0px);
  --sb: max(env(safe-area-inset-bottom,0px), var(--tg-safe-area-inset-bottom,0px), 0px);

  --shadow: 0 2px 20px rgba(0,0,0,.06);
  --shadow-strong: 0 8px 32px rgba(255,107,53,.22);
}

html,body{
  height:100%;overflow:hidden;
  font-family:'Nunito',system-ui,sans-serif;
  background:var(--bg);color:var(--text);
  -webkit-font-smoothing:antialiased;
  overscroll-behavior:none;
  user-select:none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#root{
  position:fixed;inset:0;
  padding-top:var(--st);
  display:flex;flex-direction:column;
}

#pages{
  flex:1;overflow:hidden;position:relative;
}

.page{
  position:absolute;inset:0;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
  padding:0 0 calc(var(--nav-h) + var(--sb) + 16px);

  /* invisible by default */
  opacity:0;pointer-events:none;
  transform:translateY(24px) scale(.98);
  transform-origin:top center;
  transition:
    opacity .32s cubic-bezier(.4,0,.2,1),
    transform .36s cubic-bezier(.34,1.3,.64,1);
  will-change:transform,opacity;
}
.page::-webkit-scrollbar{display:none}
.page.active{
  opacity:1;pointer-events:all;
  transform:translateY(0) scale(1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FAB NAV BUTTON + RADIAL MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Backdrop overlay */
#nav-backdrop{
  position:fixed;inset:0;z-index:98;
  background:transparent;
  pointer-events:none;
  transition:background .3s ease;
}
#nav-backdrop.open{
  background:rgba(0,0,0,.5);
  pointer-events:all;
}

/* FAB wrapper */
#fab-wrap{
  position:fixed;
  bottom:calc(var(--sb) + 22px);
  left:50%;
  transform:translateX(-50%);
  z-index:100;
  display:flex;align-items:center;justify-content:center;
}

/* Main FAB button */
#fab{
  width:62px;height:62px;border-radius:22px;
  background:linear-gradient(145deg,var(--sun),var(--sun2));
  box-shadow:
    0 8px 28px rgba(255,107,53,.5),
    0 2px 0 rgba(255,255,255,.3) inset;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  position:relative;z-index:2;
  transition:
    transform .22s cubic-bezier(.34,1.56,.64,1),
    box-shadow .22s ease,
    border-radius .3s cubic-bezier(.34,1.2,.64,1);
  will-change:transform;
}
#fab:active{transform:scale(.84)}
#fab.open{
  border-radius:50%;
  transform:rotate(45deg) scale(1.08);
  box-shadow:0 12px 36px rgba(255,107,53,.6),0 2px 0 rgba(255,255,255,.3) inset;
}

/* FAB icon layers */
#fab-icon-nav{
  position:absolute;
  display:flex;align-items:center;justify-content:center;
  transition:opacity .2s ease, transform .25s cubic-bezier(.34,1.56,.64,1);
}
#fab-icon-close{
  position:absolute;
  display:flex;align-items:center;justify-content:center;
  opacity:0;
  transition:opacity .2s ease, transform .25s cubic-bezier(.34,1.56,.64,1);
  transform:scale(.5) rotate(-90deg);
}
#fab.open #fab-icon-nav{opacity:0;transform:scale(.4) rotate(90deg)}
#fab.open #fab-icon-close{opacity:1;transform:scale(1) rotate(0deg)}

/* Current tab label pill above FAB */
#fab-label{
  position:absolute;
  bottom:calc(100% + 10px);
  left:50%;transform:translateX(-50%);
  background:var(--bg2);
  color:var(--text);
  font-size:11px;font-weight:800;letter-spacing:.04em;
  padding:5px 12px;border-radius:99px;
  white-space:nowrap;
  box-shadow:0 2px 12px rgba(0,0,0,.1);
  opacity:1;
  transition:opacity .2s ease,transform .2s ease;
  pointer-events:none;
}
#fab-wrap.menu-open #fab-label{opacity:0;transform:translateX(-50%) translateY(6px)}

/* Radial menu items container */
#nav-fan{
  position:absolute;
  bottom:calc(100% + 16px);
  left:50%;
  width:0;height:0;
  pointer-events:none;
}

/* Each fan item */
.fan-item{
  position:absolute;
  display:flex;flex-direction:column;align-items:center;gap:6px;
  cursor:pointer;
  pointer-events:none;
  opacity:0;
  transform:translateX(-50%) translateY(14px);
  transition:opacity .18s ease, transform .22s ease;
  will-change:opacity,transform;
}
.fan-item.visible{
  opacity:1;
  transform:translateX(-50%) translateY(0);
  pointer-events:all;
}
.fan-item:active .fan-ico{transform:scale(.85)!important}

.fan-ico{
  width:54px;height:54px;border-radius:18px;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 6px 20px rgba(0,0,0,.18);
  transition:transform .2s cubic-bezier(.34,1.56,.64,1), box-shadow .2s ease;
  position:relative;
}
.fan-ico svg{width:24px;height:24px;color:#fff}
.fan-ico::after{
  content:'';
  position:absolute;inset:0;border-radius:18px;
  background:rgba(255,255,255,.2);
  border-top:1px solid rgba(255,255,255,.35);
}

.fan-lbl{
  font-size:11px;font-weight:800;letter-spacing:.03em;
  color:#fff;
  text-shadow:0 1px 6px rgba(0,0,0,.4);
  white-space:nowrap;
  background:rgba(0,0,0,.22);
  padding:3px 10px;border-radius:99px;
  backdrop-filter:blur(8px);
}

/* active item highlight ring */
.fan-item.cur-tab .fan-ico::before{
  content:'';position:absolute;inset:-3px;border-radius:21px;
  border:2.5px solid #fff;
  opacity:.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TYPOGRAPHY SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.t1{font-size:30px;font-weight:900;line-height:1.1;letter-spacing:-.02em}
.t2{font-size:22px;font-weight:900;letter-spacing:-.015em}
.t3{font-size:17px;font-weight:800}
.t4{font-size:14px;font-weight:700}
.t5{font-size:12px;font-weight:600;color:var(--hint)}
.tnum{font-size:44px;font-weight:900;line-height:1;letter-spacing:-.03em}
.tnum-sm{font-size:28px;font-weight:900;letter-spacing:-.02em}
.grad{background:linear-gradient(105deg,var(--sun),var(--sun2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{
  background:var(--bg2);
  border-radius:var(--r-lg);
  padding:20px;
  box-shadow:var(--shadow);
  position:relative;overflow:hidden;
}
.card + .card{margin-top:12px}
.pad{padding:0 16px}

/* section labels */
.sec-lbl{
  font-size:11px;font-weight:800;letter-spacing:.09em;
  text-transform:uppercase;color:var(--hint);
  padding:20px 20px 8px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS ARCS (SVG-based)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.arc-wrap{position:relative;display:inline-flex;align-items:center;justify-content:center}
.arc-inner{position:absolute;text-align:center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pbar{height:6px;background:rgba(0,0,0,.07);border-radius:99px;overflow:hidden;margin-top:12px}
.pbar-fill{height:100%;border-radius:99px;transition:width 1.2s cubic-bezier(.34,1.1,.64,1)}
.pbar-sun{background:linear-gradient(90deg,var(--sun),var(--sun2))}
.pbar-water{background:var(--water)}
.pbar-sleep{background:var(--sleep)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  border:none;cursor:pointer;font-family:inherit;font-weight:800;
  border-radius:var(--r-sm);
  transition:transform .15s cubic-bezier(.34,1.56,.64,1),opacity .15s ease,box-shadow .15s ease;
}
.btn:active{transform:scale(.88);opacity:.82}

.btn-primary{
  background:linear-gradient(135deg,var(--sun),var(--sun2));
  color:#fff;padding:15px 22px;font-size:15px;border-radius:var(--r);
  box-shadow:var(--shadow-strong);width:100%;
}
.btn-ghost{
  background:rgba(0,0,0,.055);color:var(--text);
  padding:11px 18px;font-size:13px;border-radius:var(--r-sm);
}
.btn-water{background:rgba(78,174,229,.14);color:var(--water);padding:13px 10px;font-size:14px;border-radius:var(--r-sm);flex:1}
.btn-icon{
  width:44px;height:44px;border-radius:13px;
  background:rgba(0,0,0,.055);color:var(--text);font-size:18px;
  flex-shrink:0;
}
.btn-row{display:flex;gap:8px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tog{
  width:50px;height:28px;border-radius:99px;
  position:relative;cursor:pointer;flex-shrink:0;
  transition:background .25s ease;
}
.tog::after{
  content:'';position:absolute;
  width:22px;height:22px;border-radius:50%;
  background:#fff;top:3px;
  transition:left .28s cubic-bezier(.34,1.5,.64,1);
  box-shadow:0 1px 6px rgba(0,0,0,.18);
}
.tog.on{background:var(--sun)}
.tog.off{background:rgba(0,0,0,.18)}
.tog.on::after{left:25px}
.tog.off::after{left:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVITY CARDS  (workout plan)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.act-card{
  background:var(--bg2);border-radius:var(--r);
  padding:15px 16px;
  display:flex;align-items:center;gap:14px;
  box-shadow:var(--shadow);
  transition:transform .2s ease,opacity .25s ease,box-shadow .2s ease;
}
.act-card + .act-card{margin-top:10px}
.act-card.done{opacity:.45}
.act-card.done .act-name{text-decoration:line-through}
.act-ico{
  width:50px;height:50px;border-radius:16px;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;flex-shrink:0;
}
.act-info{flex:1;min-width:0}
.act-name{font-size:15px;font-weight:800;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.act-time{font-size:12px;color:var(--hint);font-weight:600}

/* status dot */
.act-status{
  width:8px;height:8px;border-radius:50%;flex-shrink:0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PILL BADGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pill{
  display:inline-flex;align-items:center;gap:3px;
  padding:3px 10px;border-radius:99px;
  font-size:11px;font-weight:800;white-space:nowrap;
}
.pill-ok{background:rgba(82,193,119,.15);color:var(--green)}
.pill-late{background:rgba(244,92,92,.12);color:var(--red)}
.pill-up{background:rgba(255,107,53,.12);color:var(--sun)}
.pill-now{background:rgba(78,174,229,.14);color:var(--water)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SLEEP QUALITY DOTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sq{display:flex;gap:3px}
.sq-d{width:18px;height:5px;border-radius:99px;background:rgba(0,0,0,.08);transition:background .35s ease}
.sq-d.on{background:var(--sleep)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HISTORY LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hrow{
  display:flex;align-items:center;padding:12px 0;
  border-bottom:1px solid rgba(0,0,0,.05);
  gap:12px;
}
.hrow:last-child{border-bottom:none;padding-bottom:0}
.hrow-date{font-size:12px;color:var(--hint);font-weight:700;min-width:52px}
.hrow-val{font-size:16px;font-weight:900;flex:1}
.hrow-diff{font-size:12px;font-weight:800}
.diff-pos{color:var(--red)}
.diff-neg{color:var(--green)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE AVATAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pav{
  width:80px;height:80px;border-radius:26px;
  background:linear-gradient(135deg,var(--sun),var(--sun2));
  display:flex;align-items:center;justify-content:center;
  font-size:34px;font-weight:900;color:#fff;
  box-shadow:0 10px 36px rgba(255,107,53,.36);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STAT GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stat-row{display:flex;gap:10px}
.stat-box{
  flex:1;background:var(--bg2);border-radius:var(--r);
  padding:16px;box-shadow:var(--shadow);text-align:center;
}
.stat-v{font-size:22px;font-weight:900;margin-bottom:3px}
.stat-l{font-size:11px;font-weight:700;color:var(--hint);text-transform:uppercase;letter-spacing:.06em}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUMMER BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sbanner{
  background:linear-gradient(130deg,#FF6B35,#FFAB40);
  border-radius:var(--r-lg);padding:18px 20px;
  color:#fff;position:relative;overflow:hidden;
}
.sbanner::after{
  content:'â˜€ï¸';position:absolute;
  right:-10px;top:-14px;font-size:96px;opacity:.14;
  transform:rotate(15deg);pointer-events:none;
}
.sbanner::before{
  content:'ğŸŒŠ';position:absolute;
  right:48px;bottom:-18px;font-size:62px;opacity:.14;
  pointer-events:none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMER RING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#timer-ring-fill{
  stroke-dasharray:282.7;
  stroke-dashoffset:282.7;
  transition:stroke-dashoffset .6s cubic-bezier(.34,1.1,.64,1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WATER WAVE  (decorative svg overlay)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.water-card{background:linear-gradient(160deg,rgba(78,174,229,.08) 0%,var(--bg2) 80%)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MEAL ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.meal-row{
  display:flex;align-items:center;gap:12px;
  padding:12px 0;border-bottom:1px solid rgba(0,0,0,.05);
}
.meal-row:last-child{border-bottom:none;padding-bottom:0}
.meal-ico{width:38px;height:38px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0}
.meal-name{font-size:14px;font-weight:700;flex:1}
.meal-kcal{font-size:16px;font-weight:900}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATED NUMBER  (JS class .counting added/removed)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes numPop{0%{transform:scale(1.18)translateY(-3px)}100%{transform:scale(1)translateY(0)}}
.num-pop{animation:numPop .28s cubic-bezier(.34,1.56,.64,1)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVEAL ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}
.reveal > *{
  opacity:0;
  animation:fadeUp .42s cubic-bezier(.34,1.3,.64,1) both;
}
.reveal > *:nth-child(1){animation-delay:.04s}
.reveal > *:nth-child(2){animation-delay:.09s}
.reveal > *:nth-child(3){animation-delay:.14s}
.reveal > *:nth-child(4){animation-delay:.19s}
.reveal > *:nth-child(5){animation-delay:.24s}
.reveal > *:nth-child(6){animation-delay:.29s}
.reveal > *:nth-child(7){animation-delay:.34s}
.reveal > *:nth-child(8){animation-delay:.39s}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toast{
  position:fixed;
  bottom:calc(var(--nav-h) + var(--sb) + 16px);
  left:50%;
  transform:translateX(-50%) translateY(12px);
  background:rgba(28,22,8,.88);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  color:#fff;
  padding:11px 24px;border-radius:99px;
  font-size:13px;font-weight:800;white-space:nowrap;
  z-index:200;pointer-events:none;
  opacity:0;
  transition:opacity .26s ease,transform .26s cubic-bezier(.34,1.56,.64,1);
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INLINE ICON (SVG Solar-style inline)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ico{display:inline-flex;vertical-align:middle}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRODUCTS LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prod-row{
  display:flex;align-items:center;gap:10px;
  padding:10px 0;border-bottom:1px solid rgba(0,0,0,.05);
}
.prod-row:last-child{border-bottom:none;padding-bottom:0}
.prod-name{font-size:13px;font-weight:700;flex:1}
.prod-meta{font-size:11px;color:var(--hint);font-weight:600;margin-top:1px}
.prod-kcal{font-size:14px;font-weight:900;color:var(--cal)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.srow{
  display:flex;align-items:center;gap:12px;
  padding:13px 0;border-bottom:1px solid rgba(0,0,0,.05);
}
.srow:last-child{border-bottom:none;padding-bottom:0}
.srow-ico{font-size:18px;width:24px;text-align:center;flex-shrink:0}
.srow-lbl{font-size:14px;font-weight:700;flex:1}
.srow-val{font-size:13px;font-weight:600;color:var(--hint)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty{
  display:flex;flex-direction:column;align-items:center;
  padding:48px 24px;gap:10px;color:var(--hint);text-align:center;
}
.empty-ico{font-size:52px;opacity:.5}
.empty-t{font-size:16px;font-weight:800}
.empty-s{font-size:13px;font-weight:600;max-width:220px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#wchart{overflow:visible}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIVIDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.divider{height:1px;background:rgba(0,0,0,.05);margin:0 -20px}

/* â”€â”€ Modal sheet â”€â”€ */
.sheet-overlay{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,.55);
  opacity:0;pointer-events:none;
  transition:opacity .25s ease;
}
.sheet-overlay.open{opacity:1;pointer-events:all;}
.sheet{
  position:fixed;bottom:0;left:0;right:0;z-index:201;
  background:var(--bg2);
  border-radius:24px 24px 0 0;
  padding:0 0 calc(var(--sb) + 24px);
  transform:translateY(100%);
  transition:transform .3s cubic-bezier(.4,0,.2,1);
  max-height:88vh;overflow-y:auto;
}
.sheet.open{transform:translateY(0);}
.sheet-handle{
  width:40px;height:4px;border-radius:99px;
  background:rgba(0,0,0,.15);
  margin:14px auto 0;
}
.sheet-title{
  font-size:18px;font-weight:900;
  padding:16px 20px 8px;
}
.sheet-row{
  display:flex;align-items:center;
  padding:14px 20px;border-bottom:1px solid rgba(0,0,0,.05);
  gap:12px;
}
.sheet-row:last-child{border-bottom:none;}
.sheet-label{font-size:14px;font-weight:700;flex:1;}
.sheet-input{
  background:rgba(0,0,0,.055);border:none;outline:none;
  border-radius:10px;padding:9px 14px;
  font-family:inherit;font-size:15px;font-weight:700;
  color:var(--text);text-align:right;width:130px;
}
.sheet-seg{
  display:flex;gap:4px;background:rgba(0,0,0,.06);
  border-radius:10px;padding:3px;
}
.sheet-seg-btn{
  flex:1;padding:8px 6px;font-size:12px;font-weight:800;
  border:none;border-radius:8px;cursor:pointer;
  font-family:inherit;background:transparent;color:var(--hint);
  transition:background .15s,color .15s;
}
.sheet-seg-btn.on{background:var(--bg2);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,.1);}

/* â”€â”€ Plan card improved â”€â”€ */
.plan-card{
  background:var(--bg2);border-radius:var(--r);
  padding:14px 16px;
  box-shadow:var(--shadow);
  margin-bottom:10px;
  transition:opacity .2s;
}
.plan-card.done-card{opacity:.45;}
.plan-card-top{display:flex;align-items:flex-start;gap:12px;}
.plan-card-ico{
  width:48px;height:48px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;flex-shrink:0;
}
.plan-card-body{flex:1;min-width:0;}
.plan-card-name{font-size:15px;font-weight:800;margin-bottom:3px;}
.plan-card-name.done-text{text-decoration:line-through;opacity:.6;}
.plan-card-time{font-size:12px;font-weight:600;color:var(--hint);}
.plan-card-actions{display:flex;gap:6px;flex-shrink:0;}

.plan-status-bar{
  margin-top:10px;
  height:6px;background:rgba(0,0,0,.07);border-radius:99px;overflow:hidden;
}
.plan-status-fill{height:100%;border-radius:99px;transition:width .4s ease;}

.countdown-pill{
  display:inline-flex;align-items:center;gap:4px;
  padding:4px 10px;border-radius:99px;
  font-size:11px;font-weight:800;
  margin-top:6px;
}
.pill-soon{background:rgba(255,107,53,.12);color:var(--sun);}
.pill-now-active{background:rgba(78,174,229,.15);color:var(--water);}
.pill-done-g{background:rgba(82,193,119,.12);color:var(--green);}
.pill-later{background:rgba(0,0,0,.06);color:var(--hint);}
.pill-late2{background:rgba(244,92,92,.1);color:var(--red);}

/* page top padding fix */
.pt-safe{padding-top:max(20px, calc(var(--st) + 12px))!important;}

</style>
</head>
<body>
<div id="root">
<div id="pages">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="p-home">
<div class="reveal">

<!-- greeting -->
<div class="pad" class="pt-safe" style="padding-bottom:0;display:flex;align-items:flex-start;justify-content:space-between">
  <div>
    <div class="t1">ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, <span class="grad" id="h-name">...</span></div>
    <div class="t5" style="margin-top:4px" id="h-date">ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ...</div>
  </div>
  <div style="text-align:right;padding-top:6px">
    <div class="t5">Ğ´Ğ¾ Ğ»ĞµÑ‚Ğ°</div>
    <div style="font-size:26px;font-weight:900;color:var(--sun);line-height:1.1" id="h-days">â€”</div>
    <div class="t5" id="h-dunit">Ğ´Ğ½ĞµĞ¹</div>
  </div>
</div>

<!-- summer banner -->
<div class="pad" style="margin-top:14px">
<div class="sbanner">
  <div style="font-size:15px;font-weight:800;opacity:.9;margin-bottom:4px">Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ»ĞµÑ‚Ñƒ â˜€ï¸</div>
  <div style="font-size:32px;font-weight:900;line-height:1.1"><span id="h-ddays">â€”</span> Ğ´Ğ½ĞµĞ¹</div>
  <div style="font-size:12px;font-weight:600;opacity:.75;margin-top:4px">Ñ‚Ñ‹ Ğ´ĞµĞ»Ğ°ĞµÑˆÑŒ ÑÑ‚Ğ¾ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ!</div>
</div>
</div>

<!-- three arcs row -->
<div class="pad" style="margin-top:14px">
<div class="card" style="padding:22px 10px 18px">
  <div style="display:flex;align-items:center;justify-content:space-around">

    <!-- water arc -->
    <div style="text-align:center;cursor:pointer" onclick="goTab('track')">
      <div class="arc-wrap">
        <svg width="82" height="82" viewBox="0 0 82 82">
          <circle cx="41" cy="41" r="34" fill="none" stroke="rgba(78,174,229,.15)" stroke-width="7"/>
          <circle cx="41" cy="41" r="34" fill="none" stroke="var(--water)" stroke-width="7"
            stroke-linecap="round" stroke-dasharray="213.6"
            id="arc-w" stroke-dashoffset="213.6"
            transform="rotate(-90 41 41)"
            style="transition:stroke-dashoffset 1.1s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="arc-inner">
          <div style="font-size:18px;font-weight:900;color:var(--water)" id="arc-wpct">0%</div>
          <div style="font-size:9px;font-weight:800;color:var(--hint)">Ğ²Ğ¾Ğ´Ğ°</div>
        </div>
      </div>
      <div style="font-size:13px;font-weight:900;margin-top:6px" id="arc-wml">0</div>
      <div class="t5">Ğ¸Ğ· <span id="arc-wgoal">2000</span> Ğ¼Ğ»</div>
    </div>

    <!-- calories arc -->
    <div style="text-align:center;cursor:pointer" onclick="goTab('track')">
      <div class="arc-wrap">
        <svg width="100" height="100" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="42" fill="none" stroke="rgba(244,129,74,.15)" stroke-width="8"/>
          <circle cx="50" cy="50" r="42" fill="none" stroke="var(--cal)" stroke-width="8"
            stroke-linecap="round" stroke-dasharray="263.9"
            id="arc-c" stroke-dashoffset="263.9"
            transform="rotate(-90 50 50)"
            style="transition:stroke-dashoffset 1.1s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="arc-inner">
          <div style="font-size:20px;font-weight:900;color:var(--cal)" id="arc-cpct">0%</div>
          <div style="font-size:10px;font-weight:800;color:var(--hint)">ĞºĞºĞ°Ğ»</div>
        </div>
      </div>
      <div style="font-size:15px;font-weight:900;margin-top:6px" id="arc-cval">0</div>
      <div class="t5">Ğ¸Ğ· <span id="arc-cgoal">2000</span></div>
    </div>

    <!-- sleep arc -->
    <div style="text-align:center;cursor:pointer" onclick="goTab('sleep')">
      <div class="arc-wrap">
        <svg width="82" height="82" viewBox="0 0 82 82">
          <circle cx="41" cy="41" r="34" fill="none" stroke="rgba(139,127,212,.15)" stroke-width="7"/>
          <circle cx="41" cy="41" r="34" fill="none" stroke="var(--sleep)" stroke-width="7"
            stroke-linecap="round" stroke-dasharray="213.6"
            id="arc-s" stroke-dashoffset="213.6"
            transform="rotate(-90 41 41)"
            style="transition:stroke-dashoffset 1.1s cubic-bezier(.34,1.1,.64,1)"/>
        </svg>
        <div class="arc-inner">
          <div style="font-size:18px;font-weight:900;color:var(--sleep)" id="arc-sh">â€”</div>
          <div style="font-size:9px;font-weight:800;color:var(--hint)">ÑĞ¾Ğ½</div>
        </div>
      </div>
      <div style="font-size:13px;font-weight:900;margin-top:6px" id="arc-sq" class="sq" style="justify-content:center"></div>
      <div class="t5">Ñ‡Ğ°ÑĞ¾Ğ²</div>
    </div>

  </div>
</div>
</div>

<!-- weight card -->
<div class="pad" style="margin-top:12px">
<div class="card" style="cursor:pointer" onclick="goTab('progress')">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <div class="t5" style="margin-bottom:5px">âš–ï¸ Ğ²ĞµÑ</div>
      <div style="display:flex;align-items:baseline;gap:6px">
        <span class="tnum-sm" id="h-wcur">â€”</span>
        <span class="t5">â†’ <b style="color:var(--text)" id="h-wgoal">â€”</b> ĞºĞ³</span>
      </div>
    </div>
    <div style="text-align:right">
      <div style="font-size:28px;font-weight:900;color:var(--sun)" id="h-wpct">â€”%</div>
      <div class="t5">Ğº Ñ†ĞµĞ»Ğ¸</div>
    </div>
  </div>
  <div class="pbar"><div class="pbar-fill pbar-sun" id="h-wbar" style="width:0%"></div></div>
</div>
</div>

<!-- today plan preview -->
<div id="h-plan-sec">
<div class="sec-lbl">Ğ¿Ğ»Ğ°Ğ½ Ğ½Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
<div class="pad" id="h-plan-list"></div>
</div>

<!-- streak -->
<div class="pad" id="h-streak-wrap" style="margin-top:12px;display:none">
  <div style="background:linear-gradient(90deg,rgba(255,107,53,.1),rgba(255,171,64,.08));border-radius:var(--r);padding:14px 16px;display:flex;align-items:center;gap:12px">
    <span style="font-size:24px">ğŸ”¥</span>
    <div>
      <div style="font-size:15px;font-weight:900" id="h-sval">7 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´</div>
      <div class="t5">ÑĞµÑ€Ğ¸Ñ Ğ²Ğ¾Ğ´Ñ‹ Ğ½Ğµ Ğ¿Ñ€ĞµÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ!</div>
    </div>
  </div>
</div>

<div style="height:8px"></div>
</div><!-- /reveal -->
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: TRACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="p-track">

<!-- inner tabs -->
<div style="position:sticky;top:0;background:var(--bg);z-index:10;padding:14px 16px 0">
  <div style="display:flex;gap:6px;background:rgba(0,0,0,.06);border-radius:14px;padding:4px">
    <button class="btn" id="tt-water" onclick="setTrackTab('water')"
      style="flex:1;padding:9px 4px;font-size:13px;border-radius:10px;background:var(--bg2);color:var(--text);box-shadow:var(--shadow)">
      ğŸ’§ Ğ’Ğ¾Ğ´Ğ°
    </button>
    <button class="btn" id="tt-cal" onclick="setTrackTab('cal')"
      style="flex:1;padding:9px 4px;font-size:13px;border-radius:10px;background:transparent;color:var(--hint);box-shadow:none">
      ğŸ‹ ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸
    </button>
    <button class="btn" id="tt-prod" onclick="setTrackTab('prod')"
      style="flex:1;padding:9px 4px;font-size:13px;border-radius:10px;background:transparent;color:var(--hint);box-shadow:none">
      ğŸŒ¿ ĞšĞ‘Ğ–Ğ£
    </button>
  </div>
</div>

<!-- water tab -->
<div id="tt-water-body">
<div class="pad reveal">

<div class="card water-card" style="margin-top:14px;text-align:center;padding:28px 20px">
  <div class="t5">Ğ²Ñ‹Ğ¿Ğ¸Ñ‚Ğ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
  <div style="font-size:64px;font-weight:900;color:var(--water);line-height:1.1;margin:8px 0" id="w-total">0</div>
  <div class="t5">Ğ¸Ğ· <span id="w-goal">2000</span> Ğ¼Ğ»</div>
  <div class="pbar" style="margin-top:16px;height:8px"><div class="pbar-fill pbar-water" id="w-bar" style="width:0%"></div></div>
  <div id="w-streak" style="margin-top:12px"></div>
</div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px">
  <button class="btn btn-water" onclick="addW(150)">+150 Ğ¼Ğ»</button>
  <button class="btn btn-water" onclick="addW(200)">+200 Ğ¼Ğ»</button>
  <button class="btn btn-water" onclick="addW(250)">+250 Ğ¼Ğ»</button>
  <button class="btn btn-water" onclick="addW(500)">+500 Ğ¼Ğ» ğŸŒŠ</button>
</div>

<button class="btn btn-ghost btn-full" style="margin-top:8px;width:100%;padding:13px" onclick="undoW()">
  â†© Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ
</button>

<div style="margin-top:14px">
  <div class="t5" style="margin-bottom:8px;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.08em">Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
  <div class="card" id="w-entries" style="padding:14px 16px"></div>
</div>

</div>
</div>

<!-- calories tab -->
<div id="tt-cal-body" style="display:none">
<div class="pad reveal">

<div class="card" style="margin-top:14px;text-align:center;padding:26px 20px">
  <div class="t5">ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
  <div style="font-size:60px;font-weight:900;color:var(--cal);line-height:1.1;margin:8px 0" id="c-total">0</div>
  <div class="t5">Ğ¸Ğ· <span id="c-goal">2000</span> ĞºĞºĞ°Ğ»</div>
  <div class="pbar" style="margin-top:16px;height:8px">
    <div class="pbar-fill pbar-sun" id="c-bar" style="width:0%"></div>
  </div>
</div>

<div class="card" style="margin-top:12px">
  <div id="c-meals"></div>
</div>

<button class="btn btn-primary" style="margin-top:12px" onclick="openSheet('sheet-cal')">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
  Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµĞ´Ñƒ
</button>

</div>
</div>

<!-- products tab -->
<div id="tt-prod-body" style="display:none">
<div class="pad reveal">

<div class="card" style="margin-top:14px">
  <div id="prod-list"></div>
</div>

<button class="btn btn-primary" style="margin-top:12px" onclick="openSheet('sheet-cal')">
  ğŸ§® Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹
</button>
</div>
</div>

</div><!-- /p-track -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: PLAN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="p-plan">
<div class="reveal">

<!-- header + counter -->
<div class="pad" class="pt-safe">
  <div class="t2" style="margin-bottom:4px">ğŸ“‹ Ğ¿Ğ»Ğ°Ğ½</div>
  <div class="t5" id="pl-date">ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
</div>

<!-- progress card -->
<div class="pad" style="margin-top:12px">
<div class="card">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
    <div>
      <div style="font-size:38px;font-weight:900;line-height:1" id="pl-cnt">0/0</div>
      <div class="t5" style="margin-top:3px">Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾</div>
    </div>
    <div style="width:60px;height:60px">
      <svg viewBox="0 0 60 60" width="60" height="60">
        <circle cx="30" cy="30" r="24" fill="none" stroke="rgba(0,0,0,.07)" stroke-width="5"/>
        <circle cx="30" cy="30" r="24" fill="none" stroke="var(--sun)" stroke-width="5"
          stroke-linecap="round" stroke-dasharray="150.8"
          id="pl-ring" stroke-dashoffset="150.8"
          transform="rotate(-90 30 30)"
          style="transition:stroke-dashoffset .8s cubic-bezier(.34,1.1,.64,1)"/>
      </svg>
    </div>
  </div>
</div>
</div>

<!-- list -->
<div id="pl-empty" class="empty" style="display:none">
  <div class="empty-ico">ğŸŒ¿</div>
  <div class="empty-t">Ğ½ĞµÑ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ½Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
  <div class="empty-s">Ğ½Ğ°Ğ¶Ğ¼Ğ¸ + Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ</div>
</div>

<div class="pad" id="pl-list" style="margin-top:4px"></div>

<!-- timer -->
<div class="sec-lbl">â± Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€</div>
<div class="pad">
<div class="card" id="timer-card" style="text-align:center;padding:24px">
  <div id="tm-idle">
    <div style="font-size:42px;margin-bottom:8px;opacity:.4">â±</div>
    <div class="t5">Ğ½Ğ°Ğ¶Ğ¼Ğ¸ â–¶ï¸ Ñƒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ</div>
  </div>
  <div id="tm-active" style="display:none">
    <div class="t5" id="tm-name" style="margin-bottom:6px">â€”</div>
    <!-- ring timer -->
    <div style="display:flex;justify-content:center;margin-bottom:16px">
      <div style="position:relative;display:inline-flex;align-items:center;justify-content:center">
        <svg width="130" height="130" viewBox="0 0 130 130">
          <circle cx="65" cy="65" r="55" fill="none" stroke="rgba(0,0,0,.07)" stroke-width="7"/>
          <circle cx="65" cy="65" r="55" fill="none" stroke="var(--sun)" stroke-width="7"
            stroke-linecap="round" stroke-dasharray="345.6"
            id="timer-ring-fill"
            transform="rotate(-90 65 65)"/>
        </svg>
        <div style="position:absolute;text-align:center">
          <div style="font-size:30px;font-weight:900;font-variant-numeric:tabular-nums" id="timer-num">00:00</div>
          <div class="t5" id="timer-plan-s">0 Ğ¼Ğ¸Ğ½</div>
        </div>
      </div>
    </div>
    <div class="btn-row" style="justify-content:center;gap:10px">
      <button class="btn btn-ghost" onclick="cancelTimer()" style="padding:12px 20px;font-size:13px">âœ• Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°</button>
      <button class="btn btn-primary" onclick="finishTimer()" style="padding:12px 24px;font-size:14px;width:auto">âœ… Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ</button>
    </div>
  </div>
</div>
</div>

<div class="pad" style="margin-top:8px">
  <button class="btn btn-primary" onclick="openSheet('sheet-act')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
    Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ
  </button>
</div>

<div style="height:8px"></div>
</div>
</div><!-- /p-plan -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: SLEEP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="p-sleep">
<div class="reveal">

<div class="pad" class="pt-safe">
  <div class="t2" style="margin-bottom:4px">ğŸŒ™ ÑĞ¾Ğ½</div>
  <div class="t5">Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ ÑĞ¾Ğ½ â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ° Ğ²ÑĞµĞ³Ğ¾</div>
</div>

<!-- last night big card -->
<div class="pad" style="margin-top:14px">
<div class="card" id="sl-last">
  <div class="t5" style="margin-bottom:8px">Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ°Ñ Ğ½Ğ¾Ñ‡ÑŒ</div>
  <div style="display:flex;align-items:center;gap:20px">
    <div>
      <div style="font-size:56px;font-weight:900;line-height:1;color:var(--sleep)" id="sl-h">â€”</div>
      <div class="t5" style="margin-top:4px">Ñ‡Ğ°ÑĞ¾Ğ²</div>
    </div>
    <div>
      <div style="font-size:40px" id="sl-qico">â€”</div>
      <div class="sq" id="sl-dots" style="margin-top:6px"></div>
    </div>
  </div>
</div>
</div>

<button class="btn btn-primary" style="margin:12px 16px 0;width:calc(100% - 32px)" onclick="openSheet('sheet-sleep')">
  ğŸŒ™ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ¾Ğ½
</button>

<div class="sec-lbl">Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 7 Ğ½Ğ¾Ñ‡ĞµĞ¹</div>
<div class="pad">
<div class="card" id="sl-hist"></div>
</div>

<div class="sec-lbl">ÑÑ€ĞµĞ´Ğ½ĞµĞµ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ</div>
<div class="pad stat-row">
  <div class="stat-box"><div class="stat-v" id="sl-avg-h" style="color:var(--sleep)">â€”</div><div class="stat-l">Ñ‡Ğ°ÑĞ¾Ğ²</div></div>
  <div class="stat-box"><div class="stat-v" id="sl-avg-q">â€”</div><div class="stat-l">ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾</div></div>
</div>

<div style="height:8px"></div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: PROGRESS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="p-progress">
<div class="reveal">

<div class="pad" class="pt-safe">
  <div class="t2" style="margin-bottom:4px">ğŸ“Š Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ</div>
  <div class="t5">Ñ‚Ğ²Ğ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ»ĞµÑ‚Ñƒ</div>
</div>

<!-- weight block -->
<div class="pad" style="margin-top:14px">
<div class="card">
  <div class="t5" style="margin-bottom:8px">âš–ï¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ²ĞµÑĞ°</div>
  <div style="display:flex;align-items:flex-end;gap:8px;margin-bottom:4px">
    <span style="font-size:42px;font-weight:900;line-height:1" id="pr-wcur">â€”</span>
    <span class="t5" style="padding-bottom:6px">ĞºĞ³ Â· Ñ†ĞµĞ»ÑŒ <b style="color:var(--text)" id="pr-wgoal">â€”</b></span>
  </div>
  <div class="t5" id="pr-winfo" style="margin-bottom:12px"></div>
  <div class="pbar" style="height:10px"><div class="pbar-fill pbar-sun" id="pr-wbar" style="width:0%;height:100%"></div></div>
  <div style="display:flex;justify-content:space-between;margin-top:6px">
    <span class="t5" id="pr-wstart">â€”</span>
    <span style="font-size:13px;font-weight:900;color:var(--sun)" id="pr-wpct">0%</span>
    <span class="t5" id="pr-wgoal2">â€”</span>
  </div>
  <div id="pr-forecast" style="margin-top:10px;font-size:12px;font-weight:800;color:var(--green)"></div>
</div>
</div>

<!-- chart -->
<div class="pad" style="margin-top:12px">
<div class="card" style="padding:16px">
  <div class="t5" style="margin-bottom:12px">Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ° Â· Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</div>
  <svg id="wchart" height="110" style="width:100%;overflow:visible;display:block"></svg>
</div>
</div>

<!-- week stats -->
<div class="sec-lbl">ÑÑ‚Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ</div>
<div class="pad stat-row">
  <div class="stat-box"><div class="stat-v" style="color:var(--water)" id="pw-water">â€”</div><div class="stat-l">Ğ²Ğ¾Ğ´Ğ° Ğ¼Ğ»</div></div>
  <div class="stat-box"><div class="stat-v" style="color:var(--cal)" id="pw-cal">â€”</div><div class="stat-l">ĞºĞºĞ°Ğ»</div></div>
  <div class="stat-box"><div class="stat-v" style="color:var(--sleep)" id="pw-sleep">â€”</div><div class="stat-l">ÑĞ¾Ğ½ Ñ‡</div></div>
</div>

<button class="btn btn-primary" style="margin:12px 16px 0;width:calc(100% - 32px)" onclick="openSheet('sheet-weight')">
  âš–ï¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ²ĞµÑ
</button>

<!-- weight history -->
<div class="sec-lbl">Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²ĞµÑĞ°</div>
<div class="pad"><div class="card" id="pr-whist" style="padding:14px 16px"></div></div>

<!-- all time -->
<div class="sec-lbl">Ğ·Ğ° Ğ²ÑÑ‘ Ğ²Ñ€ĞµĞ¼Ñ</div>
<div class="pad stat-row">
  <div class="stat-box"><div class="stat-v grad" id="at-t">0</div><div class="stat-l">Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº</div></div>
  <div class="stat-box"><div class="stat-v grad" id="at-w">0</div><div class="stat-l">Ğ²Ğ¾Ğ´Ñ‹ Ğ»</div></div>
  <div class="stat-box"><div class="stat-v grad" id="at-s">0</div><div class="stat-l">ÑĞµÑ€Ğ¸Ñ Ğ´Ğ½</div></div>
</div>

<div style="height:8px"></div>
</div>
</div><!-- /p-progress -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: PROFILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="p-profile">
<div class="reveal">

<!-- avatar area -->
<div style="display:flex;align-items:center;gap:18px;padding:20px 16px 0">
  <div class="pav" id="pf-av">Ğ</div>
  <div>
    <div class="t2" id="pf-name">â€”</div>
    <div class="t5" id="pf-meta" style="margin-top:4px">â€”</div>
  </div>
</div>

<!-- bmi stats -->
<div id="pf-bmi-row" style="margin-top:14px;padding:0 16px;display:none">
<div class="stat-row">
  <div class="stat-box"><div class="stat-v" id="pf-bmi">â€”</div><div class="stat-l">Ğ˜ĞœĞ¢</div></div>
  <div class="stat-box"><div class="stat-v" id="pf-ideal">â€”</div><div class="stat-l">Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ³</div></div>
  <div class="stat-box"><div class="stat-v" id="pf-bmr">â€”</div><div class="stat-l">BMR ĞºĞºĞ°Ğ»</div></div>
</div>
</div>

<!-- goals -->
<div class="sec-lbl">Ñ†ĞµĞ»Ğ¸</div>
<div class="pad">
<div class="card">
  <div class="srow"><span class="srow-ico">âš–ï¸</span><span class="srow-lbl">Ñ†ĞµĞ»ÑŒ Ğ¿Ğ¾ Ğ²ĞµÑÑƒ</span><span class="srow-val" id="pf-gw">â€”</span></div>
  <div class="srow"><span class="srow-ico">ğŸ’§</span><span class="srow-lbl">Ğ½Ğ¾Ñ€Ğ¼Ğ° Ğ²Ğ¾Ğ´Ñ‹</span><span class="srow-val" id="pf-gwater">â€”</span></div>
  <div class="srow"><span class="srow-ico">ğŸ‹</span><span class="srow-lbl">Ğ½Ğ¾Ñ€Ğ¼Ğ° ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹</span><span class="srow-val" id="pf-gcal">â€”</span></div>
  <div style="margin-top:12px">
    <button class="btn btn-primary" onclick="openSheet('sheet-goals')">ğŸ¯ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¸</button>
  </div>
</div>
</div>

<!-- profile data -->
<div class="sec-lbl">Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ</div>
<div class="pad">
<div class="card">
  <div class="srow"><span class="srow-ico">ğŸ‘¤</span><span class="srow-lbl">Ğ¸Ğ¼Ñ</span><span class="srow-val" id="pf-pname">â€”</span></div>
  <div class="srow"><span class="srow-ico">ğŸ“</span><span class="srow-lbl">Ñ€Ğ¾ÑÑ‚</span><span class="srow-val" id="pf-height">â€”</span></div>
  <div class="srow"><span class="srow-ico">ğŸ‚</span><span class="srow-lbl">Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚</span><span class="srow-val" id="pf-age">â€”</span></div>
  <div style="margin-top:12px">
    <button class="btn btn-primary" onclick="openSheet('sheet-profile')">âœï¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</button>
  </div>
</div>
</div>

<!-- display toggles -->
<div class="sec-lbl">Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ°Ğ½</div>
<div class="pad">
<div class="card">
  <div class="srow"><span class="srow-ico">âš–ï¸</span><span class="srow-lbl">Ğ²ĞµÑ</span><div class="tog on" id="tog-w" onclick="toggleSett('w')"></div></div>
  <div class="srow"><span class="srow-ico">ğŸ’§</span><span class="srow-lbl">Ğ²Ğ¾Ğ´Ğ°</span><div class="tog on" id="tog-water" onclick="toggleSett('water')"></div></div>
  <div class="srow"><span class="srow-ico">ğŸ‹</span><span class="srow-lbl">ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸</span><div class="tog on" id="tog-cal" onclick="toggleSett('cal')"></div></div>
  <div class="srow"><span class="srow-ico">ğŸŒ™</span><span class="srow-lbl">ÑĞ¾Ğ½</span><div class="tog on" id="tog-sleep" onclick="toggleSett('sleep')"></div></div>
</div>
</div>

<!-- reminders info -->
<div class="sec-lbl">Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ</div>
<div class="pad">
<div class="card">
  <div class="srow"><span class="srow-ico">ğŸ’§</span><span class="srow-lbl">Ğ²Ğ¾Ğ´Ğ°</span><span class="srow-val" id="rem-w">Ğ²Ñ‹ĞºĞ»</span></div>
  <div class="srow"><span class="srow-ico">âš–ï¸</span><span class="srow-lbl">Ğ²Ğ·Ğ²ĞµÑĞ¸Ñ‚ÑŒÑÑ</span><span class="srow-val" id="rem-wg">Ğ²Ñ‹ĞºĞ»</span></div>
  <div class="srow"><span class="srow-ico">ğŸ“…</span><span class="srow-lbl">Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚</span><span class="srow-val" id="rem-rep">Ğ²Ñ‹ĞºĞ»</span></div>
  <div style="margin-top:12px">
    <button class="btn btn-primary" onclick="openSheet('sheet-remind')">ğŸ”” Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ</button>
  </div>
</div>
</div>

<!-- danger zone -->
<div class="sec-lbl">ÑĞ±Ñ€Ğ¾Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</div>
<div class="pad">
  <button class="btn btn-ghost btn-full" style="width:100%;padding:14px;color:var(--red);background:rgba(244,92,92,.09)" onclick="confirmReset()">
    ğŸ—‘ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  </button>
</div>

<div style="text-align:center;padding:20px 16px 8px">
  <div class="t5">letify â˜€ï¸ Â· ver 2.0</div>
</div>

</div>
</div><!-- /p-profile -->

</div><!-- /pages -->

<!-- â”€â”€ NAV BACKDROP â”€â”€ -->
<div id="nav-backdrop" onclick="closeNav()"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SHEETS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="sheet-overlay" id="overlay" onclick="closeSheet()"></div>

<!-- Sheet: Ğ’ĞµÑ -->
<div class="sheet" id="sheet-weight">
  <div class="sheet-handle"></div>
  <div class="sheet-title">âš–ï¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ²ĞµÑ</div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ’ĞµÑ, ĞºĞ³</span>
    <input class="sheet-input" id="inp-weight" type="number" step="0.1" min="30" max="250" placeholder="70.5">
  </div>
  <div style="padding:16px">
    <button class="btn btn-primary" onclick="submitWeight()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
  </div>
</div>

<!-- Sheet: Ğ¡Ğ¾Ğ½ -->
<div class="sheet" id="sheet-sleep">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ğŸŒ™ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ¾Ğ½</div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ§Ğ°ÑĞ¾Ğ² ÑĞ½Ğ°</span>
    <input class="sheet-input" id="inp-sleep-h" type="number" step="0.5" min="1" max="14" placeholder="8">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾</span>
    <div class="sheet-seg" id="seg-sleep-q">
      <button class="sheet-seg-btn" onclick="setSleepQ(1)" data-q="1">ğŸ˜«</button>
      <button class="sheet-seg-btn" onclick="setSleepQ(2)" data-q="2">ğŸ˜´</button>
      <button class="sheet-seg-btn on" onclick="setSleepQ(3)" data-q="3">ğŸ˜‘</button>
      <button class="sheet-seg-btn" onclick="setSleepQ(4)" data-q="4">ğŸ™‚</button>
      <button class="sheet-seg-btn" onclick="setSleepQ(5)" data-q="5">ğŸŒŸ</button>
    </div>
  </div>
  <div style="padding:16px">
    <button class="btn btn-primary" onclick="submitSleep()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
  </div>
</div>

<!-- Sheet: ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ -->
<div class="sheet" id="sheet-cal">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ğŸ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµĞ´Ñƒ</div>
  <div class="sheet-row">
    <span class="sheet-label">ĞŸÑ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸</span>
    <div class="sheet-seg" id="seg-meal">
      <button class="sheet-seg-btn on" onclick="setMeal('breakfast')" data-m="breakfast">Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº</button>
      <button class="sheet-seg-btn" onclick="setMeal('lunch')" data-m="lunch">ĞĞ±ĞµĞ´</button>
      <button class="sheet-seg-btn" onclick="setMeal('dinner')" data-m="dinner">Ğ£Ğ¶Ğ¸Ğ½</button>
      <button class="sheet-seg-btn" onclick="setMeal('snack')" data-m="snack">ĞŸĞµÑ€ĞµĞºÑƒÑ</button>
    </div>
  </div>
  <div class="sheet-row">
    <span class="sheet-label">ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹, ĞºĞºĞ°Ğ»</span>
    <input class="sheet-input" id="inp-cal" type="number" step="10" min="0" max="3000" placeholder="500">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span>
    <input class="sheet-input" id="inp-cal-desc" type="text" placeholder="Ğ³Ñ€ĞµÑ‡ĞºĞ°, ĞºÑƒÑ€Ğ¸Ñ†Ğ°â€¦" style="width:160px;text-align:left">
  </div>
  <div style="padding:16px">
    <button class="btn btn-primary" onclick="submitCal()">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
  </div>
</div>

<!-- Sheet: ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ -->
<div class="sheet" id="sheet-profile">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ğŸ‘¤ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ˜Ğ¼Ñ</span>
    <input class="sheet-input" id="inp-pname" type="text" placeholder="ĞĞ»ĞµĞºÑĞµĞ¹" style="text-align:left">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ Ğ¾ÑÑ‚, ÑĞ¼</span>
    <input class="sheet-input" id="inp-height" type="number" min="100" max="250" placeholder="175">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚</span>
    <input class="sheet-input" id="inp-age" type="number" min="10" max="100" placeholder="25">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">ĞŸĞ¾Ğ»</span>
    <div class="sheet-seg" id="seg-gender">
      <button class="sheet-seg-btn on" onclick="setGender('male')" data-g="male">â™‚ Ğ¼ÑƒĞ¶</button>
      <button class="sheet-seg-btn" onclick="setGender('female')" data-g="female">â™€ Ğ¶ĞµĞ½</button>
    </div>
  </div>
  <div style="padding:16px">
    <button class="btn btn-primary" onclick="submitProfile()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
  </div>
</div>

<!-- Sheet: Ğ¦ĞµĞ»Ğ¸ -->
<div class="sheet" id="sheet-goals">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ğŸ¯ Ñ†ĞµĞ»Ğ¸</div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ğ²ĞµÑ, ĞºĞ³</span>
    <input class="sheet-input" id="inp-gw" type="number" step="0.5" placeholder="70">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">ĞĞ¾Ñ€Ğ¼Ğ° Ğ²Ğ¾Ğ´Ñ‹, Ğ¼Ğ»</span>
    <input class="sheet-input" id="inp-gwat" type="number" step="100" placeholder="2000">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">ĞĞ¾Ñ€Ğ¼Ğ° ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹</span>
    <input class="sheet-input" id="inp-gcal" type="number" step="50" placeholder="2000">
  </div>
  <div style="padding:16px">
    <button class="btn btn-primary" onclick="submitGoals()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
  </div>
</div>

<!-- Sheet: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ -->
<div class="sheet" id="sheet-act">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ğŸ“‹ Ğ½Ğ¾Ğ²Ğ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°</div>
  <div class="sheet-row">
    <span class="sheet-label">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</span>
    <input class="sheet-input" id="inp-aname" type="text" placeholder="ĞŸÑ€Ğ¾Ğ±ĞµĞ¶ĞºĞ°" style="text-align:left;width:160px">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ¢Ğ¸Ğ¿</span>
    <div class="sheet-seg" id="seg-atype" style="flex-wrap:wrap;width:200px">
      <button class="sheet-seg-btn on" onclick="setActType('run')" data-t="run">ğŸƒ Ğ±ĞµĞ³</button>
      <button class="sheet-seg-btn" onclick="setActType('gym')" data-t="gym">ğŸ’ª Ğ·Ğ°Ğ»</button>
      <button class="sheet-seg-btn" onclick="setActType('yoga')" data-t="yoga">ğŸ§˜ Ğ¹Ğ¾Ğ³Ğ°</button>
      <button class="sheet-seg-btn" onclick="setActType('walk')" data-t="walk">ğŸš¶ Ñ…Ğ¾Ğ´ÑŒĞ±Ğ°</button>
    </div>
  </div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ’Ñ€ĞµĞ¼Ñ</span>
    <input class="sheet-input" id="inp-atime" type="time" value="08:00">
  </div>
  <div class="sheet-row">
    <span class="sheet-label">Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, Ğ¼Ğ¸Ğ½</span>
    <input class="sheet-input" id="inp-adur" type="number" min="5" max="300" step="5" value="30">
  </div>
  <div style="padding:16px">
    <button class="btn btn-primary" onclick="submitAct()">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
  </div>
</div>

<!-- Sheet: ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ (ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ğ¾) -->
<div class="sheet" id="sheet-remind">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ğŸ”” Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ</div>
  <div style="padding:20px;text-align:center;color:var(--hint);font-size:14px;font-weight:600">
    ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· Telegram-Ğ±Ğ¾Ñ‚Ğ°.<br>ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ñƒ /reminders
  </div>
  <div style="padding:0 16px 8px">
    <button class="btn btn-primary" onclick="closeSheet()">ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾</button>
  </div>
</div>

<!-- â”€â”€ FAB + RADIAL MENU â”€â”€ -->
<div id="fab-wrap">

  <!-- Fan menu items (positioned via JS) -->
  <div id="nav-fan">
    <div class="fan-item" id="fi-home" onclick="navTo('home')">
      <div class="fan-ico" style="background:linear-gradient(145deg,#FF6B35,#FFAB40)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      </div>
      <span class="fan-lbl">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ</span>
    </div>
    <div class="fan-item" id="fi-track" onclick="navTo('track')">
      <div class="fan-ico" style="background:linear-gradient(145deg,#F4814A,#FF6B35)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.5 3.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5zM19 19.09H5V4.91h14v14.18zM6 15h12v2H6zm0-4h12v2H6zm0-4h12v2H6z"/></svg>
      </div>
      <span class="fan-lbl">Ğ¢Ñ€ĞµĞºĞµÑ€Ñ‹</span>
    </div>
    <div class="fan-item" id="fi-plan" onclick="navTo('plan')">
      <div class="fan-ico" style="background:linear-gradient(145deg,#4EAEE5,#2196F3)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/></svg>
      </div>
      <span class="fan-lbl">ĞŸĞ»Ğ°Ğ½</span>
    </div>
    <div class="fan-item" id="fi-sleep" onclick="navTo('sleep')">
      <div class="fan-ico" style="background:linear-gradient(145deg,#8B7FD4,#6C63FF)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
      </div>
      <span class="fan-lbl">Ğ¡Ğ¾Ğ½</span>
    </div>
    <div class="fan-item" id="fi-progress" onclick="navTo('progress')">
      <div class="fan-ico" style="background:linear-gradient(145deg,#52C177,#00B09B)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4zm2.5 2.1h-15V5h15v14.1zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
      </div>
      <span class="fan-lbl">ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ</span>
    </div>
    <div class="fan-item" id="fi-profile" onclick="navTo('profile')">
      <div class="fan-ico" style="background:linear-gradient(145deg,#667EEA,#764BA2)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
      </div>
      <span class="fan-lbl">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</span>
    </div>
  </div>

  <!-- Current tab label -->
  <div id="fab-label">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ</div>

  <!-- The FAB itself -->
  <div id="fab" onclick="toggleNav()">
    <div id="fab-icon-nav">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="#fff"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    </div>
    <div id="fab-icon-close">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="#fff"><path d="M19 13H5v-2h14v2z"/><path d="M12 5v14" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>
    </div>
  </div>

</div>
</div><!-- /root -->

<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TELEGRAM INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const tg = window.Telegram?.WebApp;
if(tg){
  tg.ready();
  tg.expand();
  if(typeof tg.requestFullscreen === 'function') tg.requestFullscreen();
  if(typeof tg.disableVerticalSwipes === 'function') tg.disableVerticalSwipes();
  if(typeof tg.setHeaderColor === 'function') tg.setHeaderColor('bg_color');
  if(typeof tg.setBackgroundColor === 'function') tg.setBackgroundColor('bg_color');
  tg.onEvent('themeChanged', applyTheme);
  tg.onEvent('viewportChanged', _applySafeArea);
  tg.onEvent('safeAreaChanged', _applySafeArea);
  setTimeout(_applySafeArea, 100);
  setTimeout(_applySafeArea, 500);
}
function _applySafeArea(){
  const top = tg?.safeAreaInset?.top ?? tg?.contentSafeAreaInset?.top ?? 0;
  const bot = tg?.safeAreaInset?.bottom ?? tg?.contentSafeAreaInset?.bottom ?? 0;
  if(top > 0) document.documentElement.style.setProperty('--st', top + 'px');
  if(bot > 0) document.documentElement.style.setProperty('--sb', bot + 'px');
}
function applyTheme(){
  const p = tg?.themeParams || {};
  const m = {
    '--bg':   p.bg_color,
    '--bg2':  p.secondary_bg_color || p.bg_color,
    '--text': p.text_color,
    '--hint': p.hint_color,
    '--link': p.link_color,
  };
  for(const [k,v] of Object.entries(m)) if(v) document.documentElement.style.setProperty(k,v);
}
applyTheme();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   API â€” ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼
   Ğ•ÑĞ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾ Ğ½Ğµ Ğ¸Ğ· Telegram â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
   Ğ½Ğ° Ğ´ĞµĞ¼Ğ¾-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· localStorage
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// URL ÑĞµÑ€Ğ²ĞµÑ€Ğ° â€” Ğ¿Ğ¾Ğ´ÑÑ‚Ğ°Ğ²ÑŒ ÑĞ²Ğ¾Ğ¹ Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ¾Ñ‚ bothost!
// Ğ•ÑĞ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ Ñ Ñ‚Ğ¾Ğ³Ğ¾ Ğ¶Ğµ ÑĞµÑ€Ğ²ĞµÑ€Ğ° â€” Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼ ''
const API_BASE = 'https://letify-production.up.railway.app';

const tgUser = tg?.initDataUnsafe?.user;
const UID = tgUser?.id || null;   // null = demo Ñ€ĞµĞ¶Ğ¸Ğ¼

// Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºÑÑˆ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ)
let _cache = {
  user:       {name:'â€¦',height:0,age:0,start_weight:0,goal_weight:0,water_goal:2000,cal_goal:2000,gender:'male'},
  settings:   {show_weight:1,show_water:1,show_calories:1,show_sleep:1},
  water:      {total:0,entries:[],streak:0},
  calories:   {},
  weight_log: [],
  sleep_log:  [],
  acts_today: [],
  products:   [],
};
let _loaded = false;

// Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
async function loadData(){
  if(!UID){
    // Ğ”ĞµĞ¼Ğ¾-Ñ€ĞµĞ¶Ğ¸Ğ¼: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ localStorage
    _useDemoData();
    _loaded = true;
    return;
  }
  try{
    const r = await fetch(`${API_BASE}/api/data?uid=${UID}`);
    if(!r.ok) throw new Error('http '+r.status);
    const data = await r.json();
    _cache.user       = data.user       || _cache.user;
    _cache.settings   = data.settings   || _cache.settings;
    _cache.water      = data.water      || _cache.water;
    _cache.calories   = data.calories   || _cache.calories;
    _cache.weight_log = data.weight_log || _cache.weight_log;
    _cache.sleep_log  = data.sleep_log  || _cache.sleep_log;
    _cache.acts_today = data.acts_today || _cache.acts_today;
    _cache.products   = data.products   || _cache.products;
    _loaded = true;
  }catch(e){
    console.warn('API Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ´ĞµĞ¼Ğ¾-Ñ€ĞµĞ¶Ğ¸Ğ¼:', e);
    _useDemoData();
    _loaded = true;
  }
}

function _useDemoData(){
  const TODAY = new Date().toLocaleDateString('en-CA');
  const g = k => { try{ const r=localStorage.getItem('lf2_'+k); return r?JSON.parse(r):null; }catch{return null;} };
  const s = (k,v) => { try{ localStorage.setItem('lf2_'+k,JSON.stringify(v)); }catch{} };
  if(!g('demo_seeded')){
    s('user',{name:tgUser?.first_name||'ĞĞ»ĞµĞºÑ',height:175,age:27,start_weight:85,goal_weight:75,water_goal:2500,cal_goal:2000,gender:'male'});
    const wl=[]; const now=new Date();
    for(let i=13;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);wl.push({weight:+(85-((13-i)*0.25)+(Math.random()-.5)*.3).toFixed(1),logged_at:d.toLocaleDateString('en-CA')});}
    s('wlog',wl);
    const sl=[];
    for(let i=6;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);sl.push({hours:+(6.5+Math.random()*2).toFixed(1),quality:3+Math.floor(Math.random()*3),logged_at:d.toLocaleDateString('en-CA')});}
    s('slog',sl);
    s('wd_'+TODAY,{total:1350,entries:[250,200,150,250,200,150,150]});
    s('cd_'+TODAY,{breakfast:420,lunch:680,dinner:0,snack:185,other:0});
    s('streak',7);
    s('acts_'+TODAY,[{id:1,name:'ĞŸÑ€Ğ¾Ğ±ĞµĞ¶ĞºĞ°',type:'run',scheduled_at:'2024-01-01T07:00',duration:30,completed:1},{id:2,name:'Ğ—Ğ°Ğ»',type:'gym',scheduled_at:'2024-01-01T18:30',duration:60,completed:0},{id:3,name:'Ğ™Ğ¾Ğ³Ğ°',type:'yoga',scheduled_at:'2024-01-01T21:00',duration:25,completed:0}]);
    s('demo_seeded',true);
  }
  const u = g('user') || {};
  const wd = g('wd_'+TODAY) || {total:0,entries:[]};
  const cd = g('cd_'+TODAY) || {};
  _cache.user       = u;
  _cache.settings   = {show_weight:1,show_water:1,show_calories:1,show_sleep:1};
  _cache.water      = {total:wd.total||0,entries:wd.entries||[],streak:g('streak')||0};
  _cache.calories   = cd;
  _cache.weight_log = g('wlog')||[];
  _cache.sleep_log  = g('slog')||[];
  _cache.acts_today = g('acts_'+TODAY)||[];
  _cache.products   = [
    {id:1,name:'Ğ±Ğ°Ğ½Ğ°Ğ½',calories:89,protein:1.1,fat:0.3,carbs:23.0},
    {id:2,name:'ÑĞ±Ğ»Ğ¾ĞºĞ¾',calories:52,protein:0.3,fat:0.2,carbs:14.0},
    {id:3,name:'ĞºÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ°',calories:165,protein:31,fat:3.6,carbs:0},
    {id:4,name:'ÑĞ¹Ñ†Ğ¾',calories:155,protein:13,fat:11,carbs:1.1},
    {id:5,name:'Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ 5%',calories:121,protein:17,fat:5,carbs:3},
    {id:6,name:'Ğ³Ñ€ĞµÑ‡ĞºĞ° Ğ²Ğ°Ñ€Ñ‘Ğ½Ğ°Ñ',calories:92,protein:3.4,fat:1,carbs:20},
  ];
}

// Ğ“ĞµÑ‚Ñ‚ĞµÑ€Ñ‹ Ğ¸Ğ· ĞºÑÑˆĞ°
const getUser    = () => _cache.user;
const getSetts   = () => ({w:!!_cache.settings?.show_weight, water:!!_cache.settings?.show_water, cal:!!_cache.settings?.show_calories, sleep:!!_cache.settings?.show_sleep});
const getWLog    = () => _cache.weight_log.map(r=>({weight:r.weight,logged_at:(r.logged_at||'').slice(0,10)}));
const getSLog    = () => _cache.sleep_log.map(r=>({hours:r.hours,quality:r.quality,logged_at:(r.logged_at||'').slice(0,10)}));
const getWD      = () => _cache.water;
const getCD      = () => _cache.calories;
const getActs    = () => _cache.acts_today.map(a=>({...a, time:(a.scheduled_at||'').slice(11,16)||'00:00', completed:!!a.completed}));
const getProds   = () => _cache.products;
const getStreak  = () => _cache.water.streak || 0;

// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ UID)
async function apiPost(path, body){
  if(!UID) return; // demo mode â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ localStorage
  try{
    await fetch(`${API_BASE}${path}`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({uid:UID,...body})
    });
  }catch(e){ console.warn('API Ğ¾ÑˆĞ¸Ğ±ĞºĞ°:', path, e); }
}

// ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ¿ĞµÑ€ĞµÑ€Ğ¸ÑĞ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ
async function reload(){
  await loadData();
  const renders = {home:renderHome,track:()=>renderTrack(trackTab),plan:renderPlan,sleep:renderSleep,progress:renderProgress,profile:renderProfile};
  if(renders[curTab]) renders[curTab]();
}

const TODAY = new Date().toLocaleDateString('en-CA');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION â€” FAB + RADIAL MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TABS = ['home','track','plan','sleep','progress','profile'];
let curTab = 'home';
let trackTab = 'water';
let navOpen = false;

const tabPageMap = {
  home:'p-home', track:'p-track', plan:'p-plan',
  sleep:'p-sleep', progress:'p-progress', profile:'p-profile'
};

const TAB_LABELS = {
  home:'Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ', track:'Ğ¢Ñ€ĞµĞºĞµÑ€Ñ‹', plan:'ĞŸĞ»Ğ°Ğ½',
  sleep:'Ğ¡Ğ¾Ğ½', progress:'ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ', profile:'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'
};

// Fan positions: arc from left to right, above the FAB
// 6 items spread in a 180Â° arc
const FAN_ITEMS = ['home','track','plan','sleep','progress','profile'];
// Positions relative to fan center (px): x offset, y offset (negative = up)
const FAN_POS = [
  {x:-145, y:-50},
  {x:-92,  y:-118},
  {x:-30,  y:-148},
  {x: 34,  y:-148},
  {x: 96,  y:-118},
  {x: 149, y:-50},
];

function positionFanItems(){
  FAN_ITEMS.forEach((tab, i) => {
    const el = document.getElementById('fi-'+tab);
    if(!el) return;
    el.style.left = FAN_POS[i].x + 'px';
    el.style.top  = FAN_POS[i].y + 'px';
  });
}

function toggleNav(){
  navOpen ? closeNav() : openNav();
}

function openNav(){
  navOpen = true;
  const fab = document.getElementById('fab');
  const wrap = document.getElementById('fab-wrap');
  const bd = document.getElementById('nav-backdrop');
  fab.classList.add('open');
  wrap.classList.add('menu-open');
  bd.classList.add('open');
  tg?.HapticFeedback?.impactOccurred('medium');

  // update current tab marker
  FAN_ITEMS.forEach(tab => {
    const el = document.getElementById('fi-'+tab);
    if(el) el.classList.toggle('cur-tab', tab === curTab);
  });

  // stagger in items
  FAN_ITEMS.forEach((tab, i) => {
    const el = document.getElementById('fi-'+tab);
    if(!el) return;
    el.style.transitionDelay = (i * 36) + 'ms';
    requestAnimationFrame(()=> el.classList.add('visible'));
  });
}

function closeNav(){
  if(!navOpen) return;
  navOpen = false;
  const fab = document.getElementById('fab');
  const wrap = document.getElementById('fab-wrap');
  const bd = document.getElementById('nav-backdrop');
  fab.classList.remove('open');
  wrap.classList.remove('menu-open');
  bd.classList.remove('open');

  FAN_ITEMS.forEach((tab, i) => {
    const el = document.getElementById('fi-'+tab);
    if(!el) return;
    const rev = FAN_ITEMS.length - 1 - i;
    el.style.transitionDelay = (rev * 22) + 'ms';
    el.classList.remove('visible');
  });
}

function navTo(tab){
  closeNav();
  setTimeout(()=> goTab(tab), 60);
}

function goTab(tab){
  if(tab === curTab && !navOpen) return;
  curTab = tab;

  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

  const pg = document.getElementById(tabPageMap[tab]);
  if(pg){
    pg.scrollTop = 0;
    const rev = pg.querySelector('.reveal');
    if(rev){ rev.classList.remove('reveal'); void rev.offsetWidth; rev.classList.add('reveal'); }
    pg.classList.add('active');
  }

  // Update FAB icon and label to match current tab
  updateFabIcon(tab);

  const renders = {
    home:renderHome, track:()=>renderTrack(trackTab), plan:renderPlan,
    sleep:renderSleep, progress:renderProgress, profile:renderProfile
  };
  if(renders[tab]) renders[tab]();
  tg?.HapticFeedback?.selectionChanged();
}

const TAB_ICONS_SVG = {
  home:`<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>`,
  track:`<path d="M19.5 3.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5zM19 19.09H5V4.91h14v14.18zM6 15h12v2H6zm0-4h12v2H6zm0-4h12v2H6z"/>`,
  plan:`<path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>`,
  sleep:`<path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>`,
  progress:`<path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4zm2.5 2.1h-15V5h15v14.1zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>`,
  profile:`<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>`
};
const TAB_GRADS = {
  home:'linear-gradient(145deg,#FF6B35,#FFAB40)',
  track:'linear-gradient(145deg,#F4814A,#FF6B35)',
  plan:'linear-gradient(145deg,#4EAEE5,#2196F3)',
  sleep:'linear-gradient(145deg,#8B7FD4,#6C63FF)',
  progress:'linear-gradient(145deg,#52C177,#00B09B)',
  profile:'linear-gradient(145deg,#667EEA,#764BA2)'
};

function updateFabIcon(tab){
  const navIco = document.getElementById('fab-icon-nav');
  const lbl = document.getElementById('fab-label');
  const fab = document.getElementById('fab');
  if(navIco) navIco.innerHTML = `<svg width="26" height="26" viewBox="0 0 24 24" fill="#fff">${TAB_ICONS_SVG[tab]||TAB_ICONS_SVG.home}</svg>`;
  if(lbl) lbl.textContent = TAB_LABELS[tab] || '';
  if(fab) fab.style.background = TAB_GRADS[tab] || TAB_GRADS.home;
  // Update FAB shadow color
  const shadowColors = {
    home:'rgba(255,107,53,.5)', track:'rgba(244,129,74,.5)',
    plan:'rgba(78,174,229,.5)', sleep:'rgba(139,127,212,.5)',
    progress:'rgba(82,193,119,.5)', profile:'rgba(102,126,234,.5)'
  };
  if(fab) fab.style.boxShadow = `0 8px 28px ${shadowColors[tab]||shadowColors.home}, 0 2px 0 rgba(255,255,255,.3) inset`;
}

function setTrackTab(t){
  trackTab = t;
  ['water','cal','prod'].forEach(k=>{
    const btn = document.getElementById('tt-'+k);
    const body = document.getElementById('tt-'+k+'-body');
    const isAct = k === t;
    if(btn){
      btn.style.background = isAct ? 'var(--bg2)' : 'transparent';
      btn.style.color = isAct ? 'var(--text)' : 'var(--hint)';
      btn.style.boxShadow = isAct ? 'var(--shadow)' : 'none';
    }
    if(body) body.style.display = isAct ? '' : 'none';
  });
  renderTrack(t);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const $ = id => document.getElementById(id);
const t = (id,v) => { const e=$(id); if(e) e.textContent=v; };
const h = (id,v) => { const e=$(id); if(e) e.innerHTML=v; };

function daysToSummer(){
  const n=new Date(), y=n.getMonth()>=5?n.getFullYear()+1:n.getFullYear();
  return Math.ceil((new Date(y,5,1)-n)/86400000);
}
function plurD(n){const a=Math.abs(n)%100;if(a>=11&&a<=19)return'Ğ´Ğ½ĞµĞ¹';if(a%10===1)return'Ğ´ĞµĞ½ÑŒ';if(a%10>=2&&a%10<=4)return'Ğ´Ğ½Ñ';return'Ğ´Ğ½ĞµĞ¹';}
function fmtDate(s){
  if(!s)return'â€”'; try{
    const d=new Date(s+'T00:00:00');
    const m=['ÑĞ½Ğ²','Ñ„ĞµĞ²','Ğ¼Ğ°Ñ€','Ğ°Ğ¿Ñ€','Ğ¼Ğ°Ğ¹','Ğ¸ÑĞ½','Ğ¸ÑĞ»','Ğ°Ğ²Ğ³','ÑĞµĞ½','Ğ¾ĞºÑ‚','Ğ½Ğ¾Ñ','Ğ´ĞµĞº'];
    return d.getDate()+' '+m[d.getMonth()];
  }catch{return s;}
}
function fmtDateMD(s){try{const d=new Date(s+'T00:00:00');return (d.getMonth()+1)+'/'+(d.getDate());}catch{return '';}}
function qIco(q){return['','ğŸ˜«','ğŸ˜´','ğŸ˜‘','ğŸ™‚','ğŸŒŸ'][q]||'ğŸ˜‘';}
function totalCal(){return Object.values(getCD()).reduce((a,b)=>a+b,0);}

const ACT_ICO = {run:'ğŸƒ',walk:'ğŸš¶',bike:'ğŸš´',gym:'ğŸ’ª',yoga:'ğŸ§˜',swim:'ğŸŠ',other:'â˜€ï¸'};
const ACT_COL = {run:'#FF6B35',walk:'#52C177',bike:'#4EAEE5',gym:'#E91E63',yoga:'#8B7FD4',swim:'#00BCD4',other:'#FFAB40'};

function numPop(id){
  const e=$(id); if(!e)return;
  e.classList.remove('num-pop'); void e.offsetWidth; e.classList.add('num-pop');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIONS â€” Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function addW(ml){
  // ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑÑˆĞ°
  _cache.water.total = (_cache.water.total||0) + ml;
  _cache.water.entries = [...(_cache.water.entries||[]), ml];
  renderTrack('water'); renderHome();
  toast(`+${ml} Ğ¼Ğ» ğŸ’§`);
  tg?.HapticFeedback?.impactOccurred('light');
  // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼
  await apiPost('/api/water', {amount: ml});
  await reload();
}

async function undoW(){
  if(!_cache.water.entries?.length){ toast('Ğ½ĞµÑ‡ĞµĞ³Ğ¾ Ğ¾Ñ‚Ğ¼ĞµĞ½ÑÑ‚ÑŒ'); return; }
  const last = _cache.water.entries.pop();
  _cache.water.total = Math.max(0, (_cache.water.total||0) - last);
  renderTrack('water'); renderHome();
  toast(`â†© âˆ’${last} Ğ¼Ğ»`);
  await apiPost('/api/water/undo', {});
  await reload();
}

async function completeAct(id){
  const acts = getActs();
  const a = acts.find(x => x.id === id);
  if(!a) return;
  const newState = !a.completed;
  // ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾
  _cache.acts_today = _cache.acts_today.map(x => x.id===id ? {...x, completed: newState?1:0} : x);
  if(newState && timerSt.id===id) cancelTimer();
  renderPlan(); renderHome();
  toast(newState ? 'âœ… Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾!' : 'â†© Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾');
  tg?.HapticFeedback?.notificationOccurred(newState ? 'success' : 'warning');
  const endpoint = newState ? '/api/activity/complete' : '/api/activity/uncomplete';
  await apiPost(endpoint, {act_id: id});
  await reload();
}

function botAct(action){
  const msgs={add_weight:'Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ²ĞµÑ',food_add:'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµĞ´Ñƒ',goals:'Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¸',
    reminders:'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ',plan_add:'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ',
    add_sleep:'Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ¾Ğ½',reset:'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ',kbzhu:'ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ĞšĞ‘Ğ–Ğ£',profile_edit:'Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'};
  if(tg?.sendData) tg.sendData(JSON.stringify({action, msg:msgs[action]||action}));
  else toast('ğŸ“± Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ±Ğ¾Ñ‚Ñƒ');
}

function toggleSett(key){
  const ss = getSetts();
  const newVal = !ss[key];
  const fieldMap = {w:'show_weight', water:'show_water', cal:'show_calories', sleep:'show_sleep'};
  if(fieldMap[key]) _cache.settings[fieldMap[key]] = newVal ? 1 : 0;
  const tog = $('tog-'+key);
  if(tog){ tog.classList.toggle('on', newVal); tog.classList.toggle('off', !newVal); }
  toast(newVal ? 'ğŸ‘ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ÑÑ' : 'ğŸ™ˆ ÑĞºÑ€Ñ‹Ñ‚Ğ¾');
  apiPost('/api/settings', {[fieldMap[key]]: newVal ? 1 : 0});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const timerSt={id:null,name:null,start:null,dur:0,iv:null};
function startTimer(id,name,dur){
  if(timerSt.iv)clearInterval(timerSt.iv);
  Object.assign(timerSt,{id,name,dur,start:Date.now()});
  t('tm-name',name); t('timer-plan-s',dur+' Ğ¼Ğ¸Ğ½');
  $('tm-idle').style.display='none'; $('tm-active').style.display='';
  timerSt.iv=setInterval(tickTimer,1000); tickTimer();
  toast('â–¶ï¸ Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½');
  tg?.HapticFeedback?.impactOccurred('medium');
}
function tickTimer(){
  const el=$('timer-num'); if(!el)return;
  const sec=Math.floor((Date.now()-timerSt.start)/1000);
  el.textContent=String(Math.floor(sec/60)).padStart(2,'0')+':'+String(sec%60).padStart(2,'0');
  const ring=$('timer-ring-fill');
  if(ring){
    const pct=Math.min(1,sec/(timerSt.dur*60));
    ring.setAttribute('stroke-dashoffset',345.6*(1-pct));
    ring.style.stroke=pct>=1?'var(--green)':'var(--sun)';
  }
}
function finishTimer(){
  if(timerSt.id!==null)completeAct(timerSt.id);
  cancelTimer(); toast('ğŸ‰ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!');
}
function cancelTimer(){
  if(timerSt.iv)clearInterval(timerSt.iv);
  timerSt.id=null;
  $('tm-idle').style.display=''; $('tm-active').style.display='none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHEET LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _currentSheet = null;
let _sleepQ = 3, _mealType = 'breakfast', _actType = 'run', _gender = 'male';

function openSheet(id){
  closeNav();
  const u = getUser();
  if(id === 'sheet-profile'){
    const ni = $('inp-pname'); if(ni) ni.value = u.name||'';
    const hi = $('inp-height'); if(hi) hi.value = u.height||'';
    const ai = $('inp-age'); if(ai) ai.value = u.age||'';
    _gender = u.gender||'male';
    document.querySelectorAll('#seg-gender .sheet-seg-btn').forEach(b=>b.classList.toggle('on', b.dataset.g===_gender));
  }
  if(id === 'sheet-goals'){
    const gwi=$('inp-gw'); if(gwi) gwi.value=u.goal_weight||'';
    const gwati=$('inp-gwat'); if(gwati) gwati.value=u.water_goal||2000;
    const gcali=$('inp-gcal'); if(gcali) gcali.value=u.cal_goal||2000;
  }
  if(id === 'sheet-weight'){
    const wl=getWLog();
    const wi=$('inp-weight'); if(wi&&wl.length) wi.value=wl[wl.length-1].weight||'';
  }
  _currentSheet = id;
  const ov = $('overlay'), sh = $(id);
  if(ov) ov.classList.add('open');
  if(sh) sh.classList.add('open');
  tg?.HapticFeedback?.impactOccurred('light');
  setTimeout(()=>{ const inp = sh?.querySelector('input'); if(inp) inp.focus(); }, 300);
}

function closeSheet(){
  const ov = $('overlay'), sh = _currentSheet ? $(_currentSheet) : null;
  if(ov) ov.classList.remove('open');
  if(sh) sh.classList.remove('open');
  _currentSheet = null;
}

function setSleepQ(q){
  _sleepQ = q;
  document.querySelectorAll('#seg-sleep-q .sheet-seg-btn').forEach(b=>b.classList.toggle('on', +b.dataset.q===q));
}
function setMeal(m){
  _mealType = m;
  document.querySelectorAll('#seg-meal .sheet-seg-btn').forEach(b=>b.classList.toggle('on', b.dataset.m===m));
}
function setGender(g){
  _gender = g;
  document.querySelectorAll('#seg-gender .sheet-seg-btn').forEach(b=>b.classList.toggle('on', b.dataset.g===g));
}
function setActType(at){
  _actType = at;
  document.querySelectorAll('#seg-atype .sheet-seg-btn').forEach(b=>b.classList.toggle('on', b.dataset.t===at));
}

async function submitWeight(){
  const v = parseFloat($('inp-weight')?.value);
  if(!v||v<30||v>300){ toast('âš ï¸ Ğ²Ğ²ĞµĞ´Ğ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ'); return; }
  closeSheet();
  _cache.weight_log = [...(_cache.weight_log||[]), {weight:v, logged_at: TODAY}];
  if(!_cache.user.start_weight) _cache.user.start_weight = v;
  renderProgress(); renderHome();
  toast(`âš–ï¸ Ğ²ĞµÑ ${v} ĞºĞ³ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½!`);
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/weight', {weight:v});
  await reload();
}

async function submitSleep(){
  const hrs = parseFloat($('inp-sleep-h')?.value);
  if(!hrs||hrs<0.5||hrs>20){ toast('âš ï¸ Ğ²Ğ²ĞµĞ´Ğ¸ Ñ‡Ğ°ÑÑ‹ ÑĞ½Ğ°'); return; }
  closeSheet();
  _cache.sleep_log = [...(_cache.sleep_log||[]), {hours:hrs, quality:_sleepQ, logged_at: TODAY}];
  renderSleep(); renderHome();
  toast(`ğŸŒ™ ÑĞ¾Ğ½ ${hrs} Ñ‡ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½!`);
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/sleep', {hours:hrs, quality:_sleepQ});
  await reload();
}

async function submitCal(){
  const cal = parseInt($('inp-cal')?.value);
  const desc = $('inp-cal-desc')?.value || '';
  if(!cal||cal<1){ toast('âš ï¸ Ğ²Ğ²ĞµĞ´Ğ¸ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸'); return; }
  closeSheet();
  if(!_cache.calories) _cache.calories = {};
  _cache.calories[_mealType] = (_cache.calories[_mealType]||0) + cal;
  renderTrack('cal'); renderHome();
  toast(`ğŸ‹ +${cal} ĞºĞºĞ°Ğ» Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾!`);
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/calories', {amount:cal, meal_type:_mealType, description:desc});
  await reload();
}

async function submitProfile(){
  const name = $('inp-pname')?.value?.trim();
  const height = parseInt($('inp-height')?.value);
  const age = parseInt($('inp-age')?.value);
  if(!name){ toast('âš ï¸ Ğ²Ğ²ĞµĞ´Ğ¸ Ğ¸Ğ¼Ñ'); return; }
  closeSheet();
  _cache.user = {..._cache.user, name, height:height||0, age:age||0, gender:_gender};
  renderProfile(); renderHome();
  toast('ğŸ‘¤ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½!');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/profile', {name, height:height||0, age:age||0, gender:_gender});
  await reload();
}

async function submitGoals(){
  const gw = parseFloat($('inp-gw')?.value)||0;
  const gwat = parseInt($('inp-gwat')?.value)||2000;
  const gcal = parseInt($('inp-gcal')?.value)||2000;
  closeSheet();
  _cache.user = {..._cache.user, goal_weight:gw, water_goal:gwat, cal_goal:gcal};
  renderProfile(); renderHome();
  toast('ğŸ¯ Ñ†ĞµĞ»Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹!');
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/goals', {goal_weight:gw, water_goal:gwat, cal_goal:gcal});
  await reload();
}

async function submitAct(){
  const name = $('inp-aname')?.value?.trim();
  const time = $('inp-atime')?.value || '08:00';
  const dur = parseInt($('inp-adur')?.value)||30;
  if(!name){ toast('âš ï¸ Ğ²Ğ²ĞµĞ´Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'); return; }
  closeSheet();
  const fakeId = Date.now();
  _cache.acts_today = [...(_cache.acts_today||[]), {
    id:fakeId, name, type:_actType,
    scheduled_at:`${TODAY}T${time}:00`,
    duration:dur, completed:0, days_of_week:''
  }];
  renderPlan(); renderHome();
  toast(`ğŸ“‹ ${name} Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾!`);
  tg?.HapticFeedback?.notificationOccurred('success');
  await apiPost('/api/activity/create', {name, type:_actType, time, duration:dur});
  await reload();
}

function confirmReset(){
  if(!confirm('Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ? Ğ­Ñ‚Ğ¾ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.')) return;
  localStorage.clear();
  _cache = {user:{name:'â€¦',water_goal:2000,cal_goal:2000},settings:{show_weight:1,show_water:1,show_calories:1,show_sleep:1},water:{total:0,entries:[],streak:0},calories:{},weight_log:[],sleep_log:[],acts_today:[],products:[]};
  renderHome(); renderProfile();
  toast('ğŸ—‘ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½Ñ‹');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COUNTDOWN HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getActivityStatus(a){
  const now = new Date();
  const [hh,mm] = (a.time||'00:00').split(':').map(Number);
  const start = new Date(); start.setHours(hh,mm,0,0);
  const end = new Date(start.getTime() + (a.duration||30)*60000);
  if(a.completed) return {state:'done', label:'âœ“ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾'};
  if(now > end) return {state:'late', label:'Ğ¿Ñ€Ğ¾ÑÑ€Ğ¾Ñ‡ĞµĞ½Ğ¾'};
  if(now >= start && now <= end){
    const elapsed = Math.round((now-start)/60000);
    const remain = Math.round((end-now)/60000);
    return {state:'active', label:`â–¶ Ğ¸Ğ´Ñ‘Ñ‚ Â· Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ ${remain} Ğ¼Ğ¸Ğ½`, progress:(now-start)/(end-start)};
  }
  const diffStart = Math.round((start-now)/60000);
  if(diffStart <= 30) return {state:'soon', label:`â° Ñ‡ĞµÑ€ĞµĞ· ${diffStart} Ğ¼Ğ¸Ğ½`};
  if(diffStart <= 120) return {state:'later', label:`Ğ² ${a.time}`};
  return {state:'later', label:`Ğ² ${a.time}`};
}

function formatTimeRange(a){
  const [hh,mm] = (a.time||'00:00').split(':').map(Number);
  const endH = hh + Math.floor((mm+(a.duration||30))/60);
  const endM = (mm+(a.duration||30))%60;
  return `${a.time} â€“ ${String(endH%24).padStart(2,'0')}:${String(endM).padStart(2,'0')}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTm;
function toast(msg){
  const el=$('toast'); el.textContent=msg; el.classList.add('show');
  clearTimeout(toastTm); toastTm=setTimeout(()=>el.classList.remove('show'),2200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawChart(data){
  const svg=$('wchart'); if(!svg)return;
  const W=svg.parentElement?.offsetWidth||270, H=110;
  svg.setAttribute('width',W); svg.setAttribute('height',H); svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
  if(data.length<2){svg.innerHTML=`<text x="${W/2}" y="55" text-anchor="middle" fill="var(--hint)" font-size="12" font-family="Nunito" font-weight="700">Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</text>`;return;}
  const ws=data.map(d=>d.weight);
  const mn=Math.min(...ws)-.6, mx=Math.max(...ws)+.6, rng=mx-mn||1;
  const pl={l:8,r:8,t:20,b:24};
  const xs=(W-pl.l-pl.r)/(data.length-1);
  const yf=w=>pl.t+(1-(w-mn)/rng)*(H-pl.t-pl.b);
  const pts=data.map((d,i)=>[pl.l+i*xs,yf(d.weight)]);
  let lp=`M${pts[0][0]},${pts[0][1]}`;
  for(let i=0;i<pts.length-1;i++){
    const cx=(pts[i][0]+pts[i+1][0])/2;
    lp+=` C${cx},${pts[i][1]} ${cx},${pts[i+1][1]} ${pts[i+1][0]},${pts[i+1][1]}`;
  }
  const ap=lp+` L${pts[pts.length-1][0]},${H} L${pts[0][0]},${H} Z`;
  svg.innerHTML=`<defs>
    <linearGradient id="cg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="var(--sun)" stop-opacity=".22"/>
      <stop offset="100%" stop-color="var(--sun)" stop-opacity="0"/>
    </linearGradient>
  </defs>
  <path d="${ap}" fill="url(#cg)"/>
  <path d="${lp}" fill="none" stroke="var(--sun)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
  ${pts.map((p,i)=>`
    <circle cx="${p[0]}" cy="${p[1]}" r="4.5" fill="var(--sun)" stroke="var(--bg2)" stroke-width="2"/>
    <text x="${p[0]}" y="${H-4}" text-anchor="middle" font-size="9" fill="var(--hint)" font-family="Nunito" font-weight="700">${fmtDateMD(data[i].logged_at)}</text>
    <text x="${p[0]}" y="${p[1]-10}" text-anchor="middle" font-size="10" fill="var(--sun)" font-weight="900" font-family="Nunito">${data[i].weight}</text>
  `).join('')}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER: HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHome(){
  const u=getUser(), ss=getSetts(), wl=getWLog(), sl=getSLog();
  const wd=getWD(), cal=getCD(), acts=getActs();

  // greeting
  t('h-name', u.name||'â€”');
  const now=new Date();
  const days=['Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ','Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº','Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº','ÑÑ€ĞµĞ´Ğ°','Ñ‡ĞµÑ‚Ğ²ĞµÑ€Ğ³','Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ğ°','ÑÑƒĞ±Ğ±Ğ¾Ñ‚Ğ°'];
  const mons=['ÑĞ½Ğ²Ğ°Ñ€Ñ','Ñ„ĞµĞ²Ñ€Ğ°Ğ»Ñ','Ğ¼Ğ°Ñ€Ñ‚Ğ°','Ğ°Ğ¿Ñ€ĞµĞ»Ñ','Ğ¼Ğ°Ñ','Ğ¸ÑĞ½Ñ','Ğ¸ÑĞ»Ñ','Ğ°Ğ²Ğ³ÑƒÑÑ‚Ğ°','ÑĞµĞ½Ñ‚ÑĞ±Ñ€Ñ','Ğ¾ĞºÑ‚ÑĞ±Ñ€Ñ','Ğ½Ğ¾ÑĞ±Ñ€Ñ','Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ'];
  t('h-date', days[now.getDay()]+', '+now.getDate()+' '+mons[now.getMonth()]);
  const dsl=daysToSummer();
  t('h-days',dsl); t('h-dunit',plurD(dsl));
  t('h-ddays',dsl);

  // water arc
  const wt=wd.total||0, wg=u.water_goal||2000, wp=Math.min(1,wt/wg);
  t('arc-wpct',Math.round(wp*100)+'%');
  t('arc-wml',wt); t('arc-wgoal',wg);
  setTimeout(()=>{
    const arc=$('arc-w'); if(arc) arc.setAttribute('stroke-dashoffset',213.6*(1-wp));
  },80);

  // cal arc
  const ct=totalCal(), cg=u.cal_goal||2000, cp=Math.min(1,ct/cg);
  t('arc-cpct',Math.round(cp*100)+'%');
  t('arc-cval',ct); t('arc-cgoal',cg);
  setTimeout(()=>{ const arc=$('arc-c'); if(arc) arc.setAttribute('stroke-dashoffset',263.9*(1-cp)); },80);

  // sleep arc
  const streak=getStreak();
  const sws=$('h-streak-wrap');
  if(sws){ sws.style.display=streak>=2?'':'none'; }
  t('h-sval',streak+' Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´');
  if(sl.length>0){
    const last=sl[sl.length-1];
    const sq=document.getElementById('arc-sq');
    if(sq){ sq.className='sq'; sq.style.justifyContent='center';
      sq.innerHTML=Array.from({length:5},(_,i)=>`<div class="sq-d${i<last.quality?' on':''}"></div>`).join(''); }
    const sp=Math.min(1,last.hours/9);
    setTimeout(()=>{ const arc=$('arc-s'); if(arc) arc.setAttribute('stroke-dashoffset',213.6*(1-sp)); },80);
    t('arc-sh',last.hours.toFixed(1));
  }

  // weight
  if(wl.length>0){
    const cw=wl[wl.length-1].weight, sw=u.start_weight||wl[0].weight||cw, gw=u.goal_weight;
    t('h-wcur',cw.toFixed(1)); t('h-wgoal',gw?gw.toFixed(1):'â€”');
    const tot=Math.abs(sw-gw||1), lost=sw-cw;
    const pct=gw?Math.min(100,Math.max(0,Math.round(lost/tot*100))):0;
    t('h-wpct',pct+'%');
    setTimeout(()=>{ const b=$('h-wbar'); if(b) b.style.width=pct+'%'; },80);
  }

  // plan preview
  const plSec=$('h-plan-sec'), plList=$('h-plan-list');
  if(plSec&&plList){
    if(!acts.length){ plSec.style.display='none'; }
    else{
      plSec.style.display='';
      const nowT=new Date();
      plList.innerHTML=acts.map(a=>{
        const ico=ACT_ICO[a.type]||'â˜€ï¸', col=ACT_COL[a.type]||'#FF9800';
        const done=a.completed;
        const [hh,mm]=(a.time||'00:00').split(':').map(Number);
        const at=new Date(); at.setHours(hh,mm,0,0);
        const et=new Date(at.getTime()+(a.duration||30)*60000);
        const ts=`${a.time}â€“${String(et.getHours()).padStart(2,'0')}:${String(et.getMinutes()).padStart(2,'0')}`;
        const late=!done&&nowT>et;
        const badge=done?`<span class="pill pill-ok">âœ“</span>`
          :late?`<span class="pill pill-late">âš ï¸</span>`
          :`<span class="pill pill-up">${a.time}</span>`;
        return `<div class="act-card${done?' done':''}">
          <div class="act-ico" style="background:${col}18">${done?'âœ…':ico}</div>
          <div class="act-info">
            <div class="act-name">${a.name}</div>
            <div class="act-time">${ts} Â· ${a.duration} Ğ¼Ğ¸Ğ½</div>
          </div>
          <div>${badge}</div>
        </div>`;
      }).join('');
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER: TRACK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderTrack(tab){
  if(tab==='water') renderWater();
  else if(tab==='cal') renderCal();
  else renderProds();
}

function renderWater(){
  const u=getUser(), wd=getWD();
  const wt=wd.total||0, wg=u.water_goal||2000, wp=Math.min(100,Math.round(wt/wg*100));
  t('w-total',wt); t('w-goal',wg);
  setTimeout(()=>{ const b=$('w-bar'); if(b) b.style.width=wp+'%'; },80);
  const st=getStreak();
  h('w-streak', st>=2?`<div style="display:inline-flex;align-items:center;gap:5px;background:rgba(255,107,53,.12);color:var(--sun);padding:5px 14px;border-radius:99px;font-size:12px;font-weight:800;">ğŸ”¥ ${st} Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´</div>`:'');
  const entries=wd.entries||[];
  h('w-entries', entries.length
    ? [...entries].reverse().slice(0,8).map((e,i)=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid rgba(0,0,0,.05)${i===0?';border-bottom:none':''}">
        <span style="font-size:13px;font-weight:700;color:var(--water)">+${e} Ğ¼Ğ»</span>
        <span style="font-size:12px;color:var(--hint);font-weight:600">ÑÑ‚Ğ°ĞºĞ°Ğ½ ${entries.length-i}</span>
      </div>`).join('')
    : '<div style="text-align:center;padding:16px;color:var(--hint);font-size:13px;font-weight:600">ĞµÑ‰Ñ‘ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾</div>');
}

function renderCal(){
  const u=getUser(), cd=getCD();
  const ct=totalCal(), cg=u.cal_goal||2000, cp=Math.min(100,Math.round(ct/cg*100));
  t('c-total',ct); t('c-goal',cg);
  setTimeout(()=>{ const b=$('c-bar'); if(b) b.style.width=cp+'%'; },80);
  const MEALS=[
    {k:'breakfast',i:'ğŸŒ…',n:'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº',col:'#FF9800'},
    {k:'lunch',i:'â˜€ï¸',n:'ĞĞ±ĞµĞ´',col:'#FF6B35'},
    {k:'dinner',i:'ğŸŒ™',n:'Ğ£Ğ¶Ğ¸Ğ½',col:'#8B7FD4'},
    {k:'snack',i:'ğŸ‘',n:'ĞŸĞµÑ€ĞµĞºÑƒÑ',col:'#52C177'},
    {k:'other',i:'ğŸŒ¿',n:'Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ',col:'#607D8B'},
  ];
  h('c-meals', MEALS.map(m=>`
    <div class="meal-row">
      <div class="meal-ico" style="background:${m.col}18;color:${m.col}">${m.i}</div>
      <div style="flex:1"><div class="meal-name">${m.n}</div>${!cd[m.k]?`<div style="font-size:11px;color:var(--hint);font-weight:600">Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾</div>`:''}</div>
      <div class="meal-kcal" style="${cd[m.k]?'color:var(--cal)':'color:var(--hint)'}">${cd[m.k]||'â€”'} ${cd[m.k]?'ĞºĞºĞ°Ğ»':''}</div>
    </div>`).join(''));
}

function renderProds(){
  h('prod-list', getProds().slice(0,10).map(p=>`
    <div class="prod-row">
      <div>
        <div class="prod-name">${p.name}</div>
        <div class="prod-meta">Ğ‘${p.protein} Â· Ğ–${p.fat} Â· Ğ£${p.carbs}</div>
      </div>
      <div class="prod-kcal">${p.calories}</div>
    </div>`).join(''));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER: PLAN â€” Ñ Ğ¾Ñ‚ÑÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderPlan(){
  const acts=getActs();
  const now=new Date();
  const mons=['ÑĞ½Ğ²','Ñ„ĞµĞ²','Ğ¼Ğ°Ñ€','Ğ°Ğ¿Ñ€','Ğ¼Ğ°Ğ¹','Ğ¸ÑĞ½','Ğ¸ÑĞ»','Ğ°Ğ²Ğ³','ÑĞµĞ½','Ğ¾ĞºÑ‚','Ğ½Ğ¾Ñ','Ğ´ĞµĞº'];
  t('pl-date','ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Â· '+now.getDate()+' '+mons[now.getMonth()]);

  const doneCnt=acts.filter(a=>a.completed).length, total=acts.length;
  t('pl-cnt',total?`${doneCnt}/${total}`:'0/0');
  setTimeout(()=>{
    const ring=$('pl-ring');
    if(ring) ring.setAttribute('stroke-dashoffset',150.8*(1-(total?doneCnt/total:0)));
  },80);

  const empty=$('pl-empty'), list=$('pl-list');
  if(!acts.length){ if(empty)empty.style.display=''; if(list){list.innerHTML='';list.style.display='none';} return; }
  if(empty)empty.style.display='none'; if(list)list.style.display='';

  list.innerHTML = acts.map(a=>{
    const ico = ACT_ICO[a.type]||'â˜€ï¸';
    const col = ACT_COL[a.type]||'#FF9800';
    const st = getActivityStatus(a);
    const timeRange = formatTimeRange(a);
    const isTiming = timerSt.id === a.id;
    const pillClass = {done:'pill-done-g',active:'pill-now-active',soon:'pill-soon',late:'pill-late2',later:'pill-later'}[st.state]||'pill-later';
    const progressPct = st.state==='active' ? Math.round((st.progress||0)*100) : st.state==='done' ? 100 : 0;
    const barColor = st.state==='done' ? 'var(--green)' : st.state==='active' ? 'var(--water)' : 'rgba(255,107,53,.3)';
    const showBar = ['done','active','soon'].includes(st.state);
    const barWidth = st.state==='soon' ? 80 : progressPct;
    const escapedName = a.name.replace(/'/g,"\\'");
    return `<div class="plan-card ${a.completed?'done-card':''}">
      <div class="plan-card-top">
        <div class="plan-card-ico" style="background:${col}18">${a.completed?'âœ…':ico}</div>
        <div class="plan-card-body">
          <div class="plan-card-name ${a.completed?'done-text':''}">${a.name}</div>
          <div class="plan-card-time">${timeRange} Â· ${a.duration} Ğ¼Ğ¸Ğ½${isTiming?' Â· <span style="color:var(--sun)">â±</span>':''}</div>
          <span class="countdown-pill ${pillClass}">${st.label}</span>
        </div>
        <div class="plan-card-actions">
          <button class="btn btn-ghost" style="padding:8px 12px;font-size:12px;border-radius:10px" onclick="completeAct(${a.id})">${a.completed?'â†©':'âœ“'}</button>
          ${!a.completed?`<button class="btn btn-primary" style="padding:8px 12px;font-size:12px;border-radius:10px;width:auto" onclick="startTimer(${a.id},'${escapedName}',${a.duration})">â–¶</button>`:''}
        </div>
      </div>
      ${showBar?`<div class="plan-status-bar"><div class="plan-status-fill" style="width:${barWidth}%;background:${barColor}"></div></div>`:''}
    </div>`;
  }).join('');
}
// ĞĞ²Ñ‚Ğ¾-Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 30 ÑĞµĞº Ğ´Ğ»Ñ Ğ¶Ğ¸Ğ²Ñ‹Ñ… ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
setInterval(()=>{ if(curTab==='plan') renderPlan(); }, 30000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER: SLEEP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSleep(){
  const sl=getSLog();
  if(sl.length){
    const last=sl[sl.length-1];
    t('sl-h',last.hours.toFixed(1));
    t('sl-qico',qIco(last.quality));
    h('sl-dots',Array.from({length:5},(_,i)=>`<div class="sq-d${i<last.quality?' on':''}"></div>`).join(''));
  } else { t('sl-h','â€”'); t('sl-qico','â€”'); h('sl-dots',''); }

  const last7=sl.slice(-7).reverse();
  h('sl-hist', last7.length?last7.map(e=>`
    <div class="hrow">
      <div class="hrow-date">${fmtDate(e.logged_at)}</div>
      <div style="display:flex;align-items:center;gap:8px;flex:1">
        <div class="hrow-val">${e.hours.toFixed(1)} Ñ‡</div>
        <div class="sq">${Array.from({length:5},(_,i)=>`<div class="sq-d${i<e.quality?' on':''}"></div>`).join('')}</div>
      </div>
      <div style="font-size:18px">${qIco(e.quality)}</div>
    </div>`).join('')
    :'<div style="text-align:center;padding:20px;color:var(--hint);font-size:13px;font-weight:600">Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹</div>');

  if(last7.length){
    const ah=+(last7.reduce((a,b)=>a+b.hours,0)/last7.length).toFixed(1);
    const aq=+(last7.reduce((a,b)=>a+(b.quality||3),0)/last7.length).toFixed(1);
    t('sl-avg-h',ah); t('sl-avg-q',qIco(Math.round(aq))+' '+aq);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER: PROGRESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderProgress(){
  const u=getUser(), wl=getWLog(), sl=getSLog(), wd=getWD();
  const acts=getActs();

  if(wl.length){
    const cw=wl[wl.length-1].weight, sw=u.start_weight||wl[0].weight||cw, gw=u.goal_weight;
    t('pr-wcur',cw.toFixed(1)); t('pr-wgoal',gw?gw.toFixed(1)+' ĞºĞ³':'â€”');
    t('pr-wgoal2',gw?gw.toFixed(1):'â€”'); t('pr-wstart',sw.toFixed(1));
    const tot=Math.abs(sw-(gw||sw))||1, lost=sw-cw;
    const pct=gw?Math.min(100,Math.max(0,Math.round(lost/tot*100))):0;
    t('pr-wpct',pct+'%'); t('pr-winfo',`Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ½Ğ¾ ${Math.abs(lost).toFixed(1)} ĞºĞ³ Â· Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ ${Math.max(0,cw-(gw||cw)).toFixed(1)} ĞºĞ³`);
    setTimeout(()=>{ const b=$('pr-wbar'); if(b) b.style.width=pct+'%'; },80);
    if(wl.length>=2&&gw&&cw>gw){
      try{
        const d1=new Date(wl[0].logged_at+'T00:00:00'), d2=new Date(wl[wl.length-1].logged_at+'T00:00:00');
        const ddays=Math.max(1,(d2-d1)/86400000);
        const rate=(wl[0].weight-wl[wl.length-1].weight)/ddays*7;
        if(rate>0.01){
          const dl=Math.ceil((cw-gw)/rate*7), eta=new Date(); eta.setDate(eta.getDate()+dl);
          const mons=['ÑĞ½Ğ²','Ñ„ĞµĞ²','Ğ¼Ğ°Ñ€','Ğ°Ğ¿Ñ€','Ğ¼Ğ°Ğ¹','Ğ¸ÑĞ½','Ğ¸ÑĞ»','Ğ°Ğ²Ğ³','ÑĞµĞ½','Ğ¾ĞºÑ‚','Ğ½Ğ¾Ñ','Ğ´ĞµĞº'];
          t('pr-forecast',`â˜€ï¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·: ${eta.getDate()} ${mons[eta.getMonth()]} Â· Ñ‚ĞµĞ¼Ğ¿ ${rate.toFixed(2)} ĞºĞ³/Ğ½ĞµĞ´`);
        }
      }catch{}
    }
  }

  drawChart(wl.slice(-7));

  t('pw-water',wd.total||0);
  t('pw-cal',totalCal());
  if(sl.length){ t('pw-sleep',+(sl.slice(-7).reduce((a,b)=>a+b.hours,0)/Math.min(7,sl.length)).toFixed(1)); }
  else t('pw-sleep','â€”');

  const last6=wl.slice(-6).reverse();
  h('pr-whist', last6.length?last6.map((e,i)=>{
    const prev=last6[i+1];
    const diff=prev?+(e.weight-prev.weight).toFixed(1):0;
    return `<div class="hrow">
      <div class="hrow-date">${fmtDate(e.logged_at)}</div>
      <div class="hrow-val">${e.weight.toFixed(1)} ĞºĞ³</div>
      ${diff?`<div class="hrow-diff ${diff<0?'diff-neg':'diff-pos'}">${diff>0?'+':''}${diff}</div>`:'<div></div>'}
    </div>`;}).join('')
    :'<div style="text-align:center;padding:16px;color:var(--hint);font-size:13px;font-weight:600">Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹</div>');

  t('at-t',acts.filter(a=>a.completed).length);
  t('at-w',+((wd.total||0)/1000).toFixed(1));
  t('at-s',getStreak());
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER: PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderProfile(){
  const u=getUser(), ss=getSetts(), wl=getWLog();
  const av=$('pf-av'); if(av) av.textContent=(u.name||'?').charAt(0).toUpperCase();
  t('pf-name',u.name||'â€”');
  const meta=[]; if(u.age)meta.push(u.age+' Ğ»ĞµÑ‚'); if(u.height)meta.push(u.height+' ÑĞ¼');
  if(u.gender)meta.push(u.gender==='male'?'â™‚ Ğ¼ÑƒĞ¶ÑĞºĞ¾Ğ¹':'â™€ Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹');
  t('pf-meta',meta.join(' Â· ')||'â€”');

  t('pf-gw',u.goal_weight?u.goal_weight+' ĞºĞ³':'â€”');
  t('pf-gwater',(u.water_goal||2000)+' Ğ¼Ğ»');
  t('pf-gcal',(u.cal_goal||2000)+' ĞºĞºĞ°Ğ»');
  t('pf-pname',u.name||'â€”');
  t('pf-height',u.height?u.height+' ÑĞ¼':'â€”');
  t('pf-age',u.age?u.age+' Ğ»ĞµÑ‚':'â€”');

  const bmiRow=$('pf-bmi-row');
  if(u.height&&wl.length){
    const cw=wl[wl.length-1].weight, h2=u.height/100;
    const bmi=+(cw/h2/h2).toFixed(1);
    const ideal=+((u.height-100)*.9).toFixed(1);
    const bmr=Math.round(u.gender==='female'?10*cw+6.25*u.height-5*(u.age||25)-161:10*cw+6.25*u.height-5*(u.age||25)+5);
    if(bmiRow) bmiRow.style.display='';
    t('pf-bmi',bmi); t('pf-ideal',ideal); t('pf-bmr',bmr);
  } else if(bmiRow) bmiRow.style.display='none';

  [['w'],['water'],['cal'],['sleep']].forEach(([k])=>{
    const tog=$('tog-'+k), on=ss[k]!==false;
    if(tog){tog.classList.toggle('on',on);tog.classList.toggle('off',!on);}
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', async ()=>{
  positionFanItems();
  updateFabIcon('home');

  // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ skeleton Ğ¿Ğ¾ĞºĞ° Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑÑ
  const isDark = tg?.colorScheme === 'dark' ||
    (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches);
  if(isDark) document.body.classList.add('tg-dark');
  tg?.onEvent('themeChanged', ()=>{
    document.body.classList.toggle('tg-dark', tg?.colorScheme === 'dark');
  });

  // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
  await loadData();
  renderHome();
  setTimeout(()=>renderHome(), 150);

  setInterval(async ()=>{
    if(curTab==='home'){
      await loadData();
      renderHome();
    }
  }, 30000);
});
</script>
</body>
</html>